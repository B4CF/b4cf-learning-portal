<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bridge4Change Learning Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
/* â”€â”€ RESET & VARIABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  /* Brand Colors from Logo */
  --navy:#1E2D3D;
  --navy-mid:#2C4158;
  --navy-light:#3D5A73;
  --gold:#E8A020;
  --gold-light:#F5C842;
  --gold-pale:#FFF4D6;
  --snow:#F9F7F4;
  --white:#FFFFFF;
  --text:#1E2D3D;
  --muted:#6B7B8E;
  --border:#DDE3EB;
  --red:#C53030;
  --red-bg:#FEF2F2;
  --green:#1A7A4A;
  --green-bg:#F0FDF4;
  /* Shadows */
  --shadow:0 2px 16px rgba(30,45,61,.08);
  --shadow-lg:0 8px 40px rgba(30,45,61,.15);
  --shadow-card:0 1px 4px rgba(30,45,61,.06), 0 4px 20px rgba(30,45,61,.08);
  /* Radii */
  --r:16px;
  --r-sm:10px;
}
html{font-family:'DM Sans',sans-serif;font-size:16px;color:var(--text);background:var(--snow);scroll-behavior:smooth}
body{min-height:100vh;-webkit-font-smoothing:antialiased}
input,textarea,select,button{font-family:inherit;font-size:1rem}
input,textarea,select{
  width:100%;padding:.75rem 1.1rem;
  border:1.5px solid var(--border);
  border-radius:var(--r-sm);
  background:#fff;outline:none;
  transition:.2s;color:var(--text);
}
input:focus,textarea:focus,select:focus{
  border-color:var(--gold);
  box-shadow:0 0 0 3px rgba(232,160,32,.15);
}
label{
  display:block;font-size:.78rem;font-weight:700;
  color:var(--muted);margin-bottom:.35rem;
  text-transform:uppercase;letter-spacing:.06em;
}
.fg{margin-bottom:1rem}
button{cursor:pointer;border:none;border-radius:var(--r-sm);font-weight:600;transition:.2s;font-family:'DM Sans',sans-serif}
.btn{padding:.7rem 1.5rem;font-size:.9rem}
.btn-primary{
  background:linear-gradient(135deg,var(--gold) 0%,var(--gold-light) 100%);
  color:var(--navy);font-weight:700;
  box-shadow:0 4px 14px rgba(232,160,32,.35);
}
.btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(232,160,32,.45)}
.btn-primary:active{transform:translateY(0)}
.btn-secondary{background:transparent;border:1.5px solid var(--border);color:var(--navy)}
.btn-secondary:hover{border-color:var(--gold);background:var(--gold-pale)}
.btn-dark{background:var(--navy);color:#fff}
.btn-dark:hover{background:var(--navy-mid)}
.btn-danger{background:transparent;border:1.5px solid #FCA5A5;color:var(--red)}
.btn-danger:hover{background:var(--red-bg)}
.btn-sm{padding:.4rem .9rem;font-size:.8rem}
.btn:disabled{opacity:.45;cursor:not-allowed;transform:none!important;box-shadow:none!important}
h1,h2,h3{font-family:'Source Serif 4',serif;line-height:1.2;font-weight:700}
h4,h5{font-family:'DM Sans',sans-serif;font-weight:700}
a{color:var(--gold);text-decoration:none}
.hidden{display:none!important}
/* Utility */
.alert{padding:.75rem 1rem;border-radius:var(--r-sm);font-size:.875rem;margin:.5rem 0}
.alert-err{background:var(--red-bg);color:#9B1C1C;border:1px solid #FCA5A5}
.alert-ok{background:var(--green-bg);color:#166534;border:1px solid #86EFAC}
.alert-info{background:#EFF6FF;color:#1D4ED8;border:1px solid #93C5FD}
.chip{display:inline-block;padding:.2rem .6rem;border-radius:20px;font-size:.7rem;font-weight:700}
.chip-green{background:#DCFCE7;color:#166534}
.chip-red{background:var(--red-bg);color:#9B1C1C}
.chip-blue{background:#EFF6FF;color:#1D4ED8}
.chip-gold{background:var(--gold-pale);color:#92400E}
/* Spinner */
.spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin .7s linear infinite;margin:2.5rem auto;display:block}
@keyframes spin{to{transform:rotate(360deg)}}
/* Empty state */
.empty{text-align:center;padding:3rem 1rem;color:var(--muted)}
.empty-icon{font-size:3rem;margin-bottom:.8rem;display:block}
/* Toast */
.toast{
  position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);
  background:var(--navy);color:#fff;
  padding:.7rem 1.6rem;border-radius:40px;
  font-weight:600;font-size:.875rem;
  z-index:9000;white-space:nowrap;
  box-shadow:var(--shadow-lg);
  animation:toastIn .3s ease,toastOut .35s ease 2.5s forwards;
}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(8px)}}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#hdr{
  position:sticky;top:0;z-index:200;
  background:var(--navy);
  display:flex;align-items:center;gap:.8rem;
  padding:.75rem 1.5rem;
  box-shadow:0 2px 16px rgba(0,0,0,.22);
}
.hdr-logo-wrap{
  display:flex;align-items:center;gap:.75rem;flex:1;min-width:0;
}
#hdr-logo{height:38px;width:38px;border-radius:8px;object-fit:contain;background:rgba(255,255,255,.1);flex-shrink:0}
.hdr-brand{font-family:'Bebas Neue',sans-serif;font-size:1.25rem;letter-spacing:.06em;color:#fff;line-height:1}
.hdr-brand small{display:block;font-family:'DM Sans',sans-serif;font-size:.68rem;font-weight:400;letter-spacing:.03em;opacity:.6;text-transform:uppercase}
.hdr-right{display:flex;align-items:center;gap:.6rem}
#hdr-av{
  width:36px;height:36px;border-radius:50%;
  background:var(--gold);color:var(--navy);
  display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:.95rem;flex-shrink:0;
}
#hdr-nm{font-size:.82rem;font-weight:600;color:#fff;max-width:110px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.hdr-pts-pill{
  background:rgba(232,160,32,.2);
  border:1px solid rgba(232,160,32,.4);
  color:var(--gold-light);
  padding:.2rem .75rem;border-radius:20px;
  font-size:.75rem;font-weight:700;
}
#hdr-out{
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.2);
  color:rgba(255,255,255,.85);
  padding:.35rem .85rem;font-size:.78rem;border-radius:8px;
}
#hdr-out:hover{background:rgba(255,255,255,.15)}

/* â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#nav{
  display:flex;background:var(--white);
  border-bottom:1px solid var(--border);
  overflow-x:auto;-webkit-overflow-scrolling:touch;
  position:sticky;top:62px;z-index:190;
  scrollbar-width:none;
  box-shadow:0 1px 4px rgba(30,45,61,.05);
}
#nav::-webkit-scrollbar{display:none}
.nav-i{
  flex-shrink:0;padding:.8rem 1.1rem;
  font-size:.82rem;font-weight:600;
  color:var(--muted);border-bottom:3px solid transparent;
  cursor:pointer;white-space:nowrap;transition:.18s;
  background:none;border-left:none;border-right:none;border-top:none;
}
.nav-i:hover{color:var(--navy)}
.nav-i.on{color:var(--navy);border-bottom-color:var(--gold)}

/* â”€â”€ PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pg{display:none}
.pg.on{display:block}
.pw{max-width:980px;margin:0 auto;padding:1.5rem}

/* â”€â”€ WELCOME / AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#pg-welcome{
  min-height:100vh;
  display:flex;align-items:center;justify-content:center;
  background:var(--navy);
  position:relative;overflow:hidden;
}
#pg-welcome::before{
  content:'';position:absolute;inset:0;
  background:
    radial-gradient(ellipse at 20% 50%,rgba(232,160,32,.12) 0%,transparent 60%),
    radial-gradient(ellipse at 80% 20%,rgba(61,90,115,.5) 0%,transparent 50%);
  pointer-events:none;
}
/* Mountain silhouette decorative lines */
#pg-welcome::after{
  content:'';position:absolute;bottom:0;left:0;right:0;height:300px;
  background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 300'%3E%3Cpath fill='rgba(255,255,255,0.03)' d='M0,300 L0,180 L120,120 L240,160 L360,80 L480,140 L600,40 L720,100 L840,60 L960,120 L1080,70 L1200,130 L1320,90 L1440,150 L1440,300 Z'/%3E%3Cpath fill='rgba(255,255,255,0.02)' d='M0,300 L0,220 L180,160 L360,200 L540,130 L720,180 L900,140 L1080,190 L1260,150 L1440,200 L1440,300 Z'/%3E%3C/svg%3E") bottom/cover no-repeat;
  pointer-events:none;
}
.auth-container{
  position:relative;z-index:1;
  display:flex;gap:2rem;align-items:center;
  width:100%;max-width:960px;
  padding:2rem;
}
.auth-brand-panel{
  flex:1;padding:2rem;
  color:#fff;
}
.auth-brand-panel img{
  height:80px;margin-bottom:1.5rem;
  filter:drop-shadow(0 4px 12px rgba(0,0,0,.3));
}
.auth-headline{
  font-family:'Bebas Neue',sans-serif;
  font-size:3.5rem;letter-spacing:.04em;
  color:#fff;line-height:.95;margin-bottom:1rem;
}
.auth-headline span{color:var(--gold)}
.auth-tagline{
  color:rgba(255,255,255,.65);
  font-size:1rem;line-height:1.6;
  max-width:340px;
}
.auth-stats{
  display:flex;gap:1.5rem;margin-top:2rem;
}
.auth-stat-n{
  font-family:'Bebas Neue',sans-serif;
  font-size:2rem;color:var(--gold);letter-spacing:.04em;
}
.auth-stat-l{font-size:.72rem;color:rgba(255,255,255,.5);font-weight:600;text-transform:uppercase;letter-spacing:.06em}
/* Auth card */
.auth-card{
  background:#fff;border-radius:20px;
  padding:2rem;min-width:360px;max-width:400px;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  flex-shrink:0;
}
.auth-card-header{margin-bottom:1.8rem;text-align:center}
.auth-card-header h2{font-size:1.6rem;color:var(--navy);margin-bottom:.3rem}
.auth-card-header p{color:var(--muted);font-size:.875rem}
.auth-tabs{
  display:flex;background:var(--snow);
  border-radius:var(--r-sm);padding:3px;
  margin-bottom:1.5rem;gap:2px;
}
.auth-tab{
  flex:1;padding:.5rem;font-size:.82rem;font-weight:600;
  color:var(--muted);border-radius:8px;background:none;border:none;
  transition:.2s;
}
.auth-tab.on{background:#fff;color:var(--navy);box-shadow:0 1px 4px rgba(30,45,61,.1)}
.auth-form{display:none}
.auth-form.on{display:block}
.auth-card .btn-primary{width:100%;padding:.85rem;font-size:.95rem;margin-top:.5rem}
.auth-divider{
  text-align:center;color:var(--muted);
  font-size:.78rem;margin:.8rem 0;
  position:relative;
}
.auth-divider::before,.auth-divider::after{
  content:'';position:absolute;top:50%;
  width:40%;height:1px;background:var(--border);
}
.auth-divider::before{left:0}
.auth-divider::after{right:0}
.admin-link{
  text-align:center;margin-top:1rem;
}
.admin-link button{background:none;border:none;color:var(--muted);font-size:.78rem;text-decoration:underline}

/* â”€â”€ ADMIN LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#pg-adm-login{
  min-height:100vh;display:flex;align-items:center;justify-content:center;
  background:var(--navy);
}
.adm-login-card{
  background:#fff;border-radius:20px;
  box-shadow:var(--shadow-lg);padding:2rem;
  max-width:380px;width:100%;margin:1rem;
}
.adm-login-card h2{font-size:1.4rem;color:var(--navy);margin-bottom:.3rem;text-align:center}
.adm-login-card p{text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:1.4rem}

/* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash-hero{
  background:linear-gradient(135deg,var(--navy) 0%,var(--navy-mid) 100%);
  border-radius:var(--r);padding:1.8rem;color:#fff;
  margin-bottom:1.5rem;position:relative;overflow:hidden;
}
.dash-hero::before{
  content:'';position:absolute;right:-40px;top:-40px;
  width:200px;height:200px;
  background:radial-gradient(circle,rgba(232,160,32,.2) 0%,transparent 70%);
  border-radius:50%;
}
.dash-hero::after{
  content:'';position:absolute;left:-20px;bottom:-30px;
  width:150px;height:150px;
  background:rgba(255,255,255,.03);
  border-radius:50%;
}
.dash-hero h2{font-size:1.5rem;margin-bottom:.25rem;position:relative}
.dash-hero p{opacity:.7;font-size:.9rem;position:relative}
.dash-pts-row{
  display:flex;align-items:baseline;gap:.5rem;
  margin-top:.75rem;position:relative;
}
.dash-pts-big{
  font-family:'Bebas Neue',sans-serif;
  font-size:3rem;color:var(--gold);letter-spacing:.05em;
}
.dash-pts-label{color:rgba(255,255,255,.6);font-size:.85rem}
.dash-rank-pill{
  margin-left:auto;
  background:rgba(232,160,32,.2);border:1px solid rgba(232,160,32,.4);
  color:var(--gold-light);padding:.3rem .9rem;border-radius:20px;
  font-size:.82rem;font-weight:700;
}
.stat-row{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:.9rem;margin-bottom:1.5rem;
}
.stat-card{
  background:#fff;border-radius:var(--r);padding:1.1rem 1rem;
  text-align:center;box-shadow:var(--shadow-card);
  border-top:3px solid var(--border);transition:.2s;
}
.stat-card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
.stat-card.vid{border-top-color:var(--gold)}
.stat-card.art{border-top-color:var(--navy-light)}
.stat-card.qz{border-top-color:var(--green)}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:.04em;color:var(--navy);line-height:1}
.stat-lbl{font-size:.7rem;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.06em;margin-top:.2rem}
.prog-bar{background:var(--border);border-radius:8px;height:8px;overflow:hidden;margin:.4rem 0}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--navy-light),var(--gold));border-radius:8px;transition:width .7s ease}
.section-hd{
  display:flex;align-items:center;gap:.6rem;
  font-family:'Source Serif 4',serif;font-size:1.1rem;
  color:var(--navy);margin-bottom:1rem;
  padding-bottom:.5rem;border-bottom:2px solid var(--border);
  font-weight:700;
}

/* â”€â”€ CONTENT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:1.1rem}
.card{
  background:#fff;border-radius:var(--r);
  box-shadow:var(--shadow-card);overflow:hidden;
  transition:.22s;cursor:pointer;
}
.card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}
.card-thumb{
  height:140px;
  background:linear-gradient(135deg,var(--navy) 0%,var(--navy-mid) 100%);
  display:flex;align-items:center;justify-content:center;
  font-size:2.8rem;position:relative;
}
.card-thumb.vid-thumb{background:linear-gradient(135deg,#1E2D3D 0%,#2C4158 100%)}
.card-thumb.art-thumb{background:linear-gradient(135deg,#2C4158 0%,#3D5A73 100%)}
.card-done-badge{
  position:absolute;top:.6rem;right:.6rem;
  background:var(--gold);color:var(--navy);
  width:26px;height:26px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:.8rem;font-weight:900;box-shadow:0 2px 6px rgba(0,0,0,.2);
}
.card-pts-badge{
  position:absolute;top:.6rem;left:.6rem;
  background:rgba(30,45,61,.7);
  color:var(--gold-light);
  padding:.15rem .5rem;border-radius:20px;
  font-size:.7rem;font-weight:700;
}
.card-body{padding:1rem 1.1rem 1.1rem}
.card-tag{
  font-size:.68rem;font-weight:700;
  padding:.15rem .55rem;border-radius:20px;
  background:var(--gold-pale);color:#92400E;
  display:inline-block;margin-bottom:.4rem;
}
.card-title{font-size:.95rem;font-weight:700;margin-bottom:.3rem;line-height:1.35;color:var(--navy)}
.card-meta{font-size:.75rem;color:var(--muted);margin-bottom:.8rem}
.card-actions{display:flex;gap:.5rem;flex-wrap:wrap}

/* â”€â”€ QUIZ OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#qov{
  position:fixed;inset:0;
  background:rgba(10,18,28,.6);backdrop-filter:blur(4px);
  z-index:500;display:flex;align-items:center;justify-content:center;
  padding:1rem;
}
#qov.hidden{display:none!important}
.quiz-modal{
  background:#fff;border-radius:20px;
  max-width:620px;width:100%;
  max-height:92vh;overflow-y:auto;
  padding:1.6rem;
  box-shadow:0 24px 80px rgba(0,0,0,.4);
}
.quiz-modal-hdr{
  display:flex;justify-content:space-between;align-items:flex-start;
  margin-bottom:1rem;gap:.5rem;
}
.quiz-modal-hdr h3{font-size:1.05rem;font-family:'Source Serif 4',serif}
.quiz-close{
  background:none;border:1.5px solid var(--border);
  color:var(--muted);width:32px;height:32px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:1.1rem;flex-shrink:0;
}
.quiz-close:hover{background:var(--snow)}
.q-num-badge{
  width:30px;height:30px;background:var(--navy);color:#fff;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  font-size:.72rem;font-weight:900;flex-shrink:0;
}
.q-type-badge{font-size:.68rem;padding:.2rem .5rem;border-radius:20px;font-weight:700}
.qt-mcq{background:#DCFCE7;color:#166534}
.qt-multi{background:#FFF7ED;color:#C2410C}
.qt-long{background:#EFF6FF;color:#1D4ED8}
.qt-tf{background:#FDF4FF;color:#7E22CE}
.q-text{
  font-size:1rem;font-weight:600;line-height:1.55;
  margin-bottom:1rem;padding:.85rem;
  background:var(--snow);border-radius:var(--r-sm);
}
.q-opts{display:flex;flex-direction:column;gap:.55rem}
.q-opt{
  background:#fff;border:2px solid var(--border);
  border-radius:var(--r-sm);padding:.75rem 1rem;
  text-align:left;font-size:.9rem;cursor:pointer;transition:.15s;
}
.q-opt:hover{border-color:var(--gold);background:var(--gold-pale)}
.q-opt.sel{border-color:var(--navy);background:rgba(30,45,61,.05)}
.q-opt.cor{border-color:var(--green);background:var(--green-bg)!important;font-weight:700}
.q-opt.wrong{border-color:var(--red);background:var(--red-bg)!important}
.long-ans{
  width:100%;min-height:110px;
  border:2px solid var(--border);border-radius:var(--r-sm);
  padding:.85rem;resize:vertical;font-size:.9rem;
}
.q-feedback{
  padding:.8rem 1rem;border-radius:var(--r-sm);
  font-weight:600;font-size:.875rem;margin-top:.75rem;
}
.q-feedback.cor{background:var(--green-bg);color:#166534;border:1px solid #86EFAC}
.q-feedback.wrong{background:var(--red-bg);color:#9B1C1C;border:1px solid #FCA5A5}
.q-feedback.info{background:#EFF6FF;color:#1D4ED8;border:1px solid #93C5FD}
.q-info-row{display:flex;justify-content:space-between;font-size:.75rem;color:var(--muted);margin-bottom:.4rem}
.q-prog-bar{background:var(--border);border-radius:6px;height:5px;overflow:hidden;margin-bottom:.9rem}
.q-prog-fill{height:100%;background:linear-gradient(90deg,var(--navy-light),var(--gold));border-radius:6px;transition:width .4s ease}
.q-nav{display:flex;gap:.5rem;margin-top:1rem;justify-content:flex-end;flex-wrap:wrap}
.q-score-box{text-align:center;padding:1.6rem;background:var(--snow);border-radius:var(--r)}
.q-score-big{
  font-family:'Bebas Neue',sans-serif;font-size:4rem;
  color:var(--navy);letter-spacing:.05em;line-height:1;
}
.q-score-grade{font-size:1.1rem;font-weight:700;margin:.4rem 0;color:var(--gold)}
.q-score-pts{
  display:inline-block;margin-top:.5rem;
  background:var(--gold-pale);color:#92400E;
  padding:.3rem 1rem;border-radius:20px;
  font-size:.875rem;font-weight:700;
}

/* â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lb-table{width:100%;border-collapse:collapse;font-size:.875rem}
.lb-table th{
  background:var(--navy);color:rgba(255,255,255,.8);
  padding:.65rem .9rem;text-align:left;
  font-size:.72rem;text-transform:uppercase;letter-spacing:.06em;font-weight:700;
}
.lb-table th:first-child{border-radius:var(--r-sm) 0 0 0}
.lb-table th:last-child{border-radius:0 var(--r-sm) 0 0}
.lb-table td{padding:.65rem .9rem;border-bottom:1px solid var(--border)}
.lb-table tr:last-child td{border:none}
.lb-table tr.lb-me{background:var(--gold-pale)}
.lb-table tr:hover td{background:var(--snow)}
.lb-rank{font-weight:900;color:var(--muted)}
.lb-rank-1{color:var(--gold);font-size:1.1rem}
.lb-rank-2{color:#9BA3AF}
.lb-rank-3{color:#B45309}

/* â”€â”€ PROGRESS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prog-item{
  display:flex;align-items:center;gap:.8rem;
  padding:.9rem 0;border-bottom:1px solid var(--border);
}
.prog-item:last-child{border:none}
.prog-icon{font-size:1.4rem;flex-shrink:0}
.prog-info{flex:1}
.prog-label{font-size:.875rem;font-weight:700;margin-bottom:.15rem}
.prog-status{font-size:.75rem;color:var(--muted)}

/* â”€â”€ CERTIFICATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cert-milestones{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:.75rem;margin-bottom:1.5rem}
.cm{
  background:#fff;border-radius:var(--r);padding:1.1rem;
  text-align:center;border:2px solid var(--border);transition:.2s;
}
.cm.cm-earned{border-color:var(--gold);background:linear-gradient(135deg,#FFFBEB,#fff);box-shadow:0 4px 16px rgba(232,160,32,.15)}
.cm.cm-locked{opacity:.55}
.cm:hover{transform:translateY(-2px)}
.cm-badge{font-size:2rem}
.cm-tier{font-weight:700;font-size:.875rem;margin:.3rem 0;color:var(--navy)}
.cm-pts{font-size:.72rem;color:var(--muted)}
.cm-status{font-size:.7rem;font-weight:700;display:block;margin-top:.4rem}
.cm.cm-earned .cm-status{color:var(--green)}

/* â”€â”€ CERT OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#cert-ov{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:600;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(4px)}
#cert-ov.hidden{display:none!important}
.cert-ov-acts{display:flex;gap:.75rem;margin-top:1.2rem;flex-wrap:wrap;justify-content:center}
.certificate{background:#fff;width:720px;max-width:100%;font-family:'DM Sans',sans-serif;overflow:hidden;border-radius:4px}
.cert-strip{height:8px;width:100%}
.cert-strip.bronze{background:#CD7F32}
.cert-strip.silver{background:#A8A9AD}
.cert-strip.gold{background:linear-gradient(90deg,var(--gold),var(--gold-light))}
.cert-strip.plat{background:linear-gradient(90deg,#5C6BC0,#9C27B0)}
.cert-hdr{display:flex;align-items:center;gap:1rem;padding:1.2rem 2rem;border-bottom:1px solid #F0F0F0}
.cert-hdr-logo{height:52px;width:52px;border-radius:8px;object-fit:contain}
.cert-hdr-org{font-weight:800;font-size:1rem;color:var(--navy)}
.cert-hdr-sub{font-size:.72rem;color:var(--muted)}
.cert-body{padding:1.5rem 2rem;text-align:center}
.cert-title-txt{font-family:'Source Serif 4',serif;font-size:1.6rem;color:var(--navy);margin:.5rem 0;font-weight:700}
.cert-name{font-family:'Source Serif 4',serif;font-size:2rem;color:var(--navy);margin:.4rem 0;font-weight:700}
.cert-ftr{padding:1rem 2rem;border-top:1px solid #F0F0F0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
.cert-ftr-issued{font-size:.7rem;color:#999;line-height:1.5}
.cert-id-pill{font-size:.65rem;background:#F5F5F5;padding:.2rem .6rem;border-radius:20px;color:#999;font-family:monospace}

/* â”€â”€ ABOUT PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.about-hero{
  background:linear-gradient(135deg,var(--navy),var(--navy-mid));
  border-radius:var(--r);padding:2rem;color:#fff;
  margin-bottom:1.5rem;text-align:center;
}
.about-hero img{height:72px;margin-bottom:1rem;filter:drop-shadow(0 4px 12px rgba(0,0,0,.3))}
.about-hero h2{font-size:1.8rem;margin-bottom:.4rem}
.about-hero p{opacity:.7;max-width:500px;margin:0 auto;line-height:1.6}

/* â”€â”€ ADMIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#pg-adm-login{display:none}
#pg-admin{display:none}
#pg-admin.on{display:flex}
.adm-wrap{display:flex;min-height:calc(100vh - 62px);width:100%}
.adm-sb{
  width:230px;background:var(--navy);
  padding:1rem 0;flex-shrink:0;
  position:sticky;top:62px;
  height:calc(100vh - 62px);overflow-y:auto;
}
.sb-sect{
  font-size:.65rem;font-weight:700;
  text-transform:uppercase;letter-spacing:.1em;
  color:rgba(255,255,255,.3);
  padding:.8rem 1.3rem .3rem;
}
.sb-item{
  display:flex;align-items:center;gap:.65rem;
  padding:.65rem 1.3rem;
  color:rgba(255,255,255,.65);
  font-size:.82rem;font-weight:600;
  cursor:pointer;transition:.15s;
  border-left:3px solid transparent;
  background:none;border-right:none;border-top:none;border-bottom:none;
  width:100%;text-align:left;
}
.sb-item:hover{background:rgba(255,255,255,.07);color:#fff}
.sb-item.on{color:#fff;border-left-color:var(--gold);background:rgba(255,255,255,.1)}
.adm-main{flex:1;overflow-y:auto;padding:1.5rem;background:var(--snow)}
.as{display:none}
.as.on{display:block}
.adm-card{
  background:#fff;border-radius:var(--r);
  padding:1.3rem;box-shadow:var(--shadow-card);
  margin-bottom:1.2rem;
}
.adm-card h3{
  font-size:.82rem;color:var(--navy);
  margin-bottom:1rem;padding-bottom:.5rem;
  border-bottom:1px solid var(--border);
  font-weight:700;text-transform:uppercase;letter-spacing:.07em;
  font-family:'DM Sans',sans-serif;
}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
.adm-table{width:100%;border-collapse:collapse;font-size:.82rem}
.adm-table th{
  background:var(--snow);color:var(--muted);
  padding:.55rem .75rem;text-align:left;
  font-size:.72rem;text-transform:uppercase;letter-spacing:.05em;font-weight:700;
}
.adm-table td{padding:.55rem .75rem;border-bottom:1px solid var(--border)}
.adm-table tr:last-child td{border:none}
.adm-table tr:hover td{background:var(--snow)}
.tacts{display:flex;gap:.4rem}
.inline-tabs{display:flex;gap:.3rem;flex-wrap:wrap;margin-bottom:1rem}
.itab{
  padding:.35rem .8rem;background:var(--snow);
  border-radius:8px;font-size:.78rem;font-weight:600;
  color:var(--muted);cursor:pointer;border:none;transition:.15s;
}
.itab.on{background:var(--navy);color:#fff}
.itab-section{display:none}
.itab-section.on{display:block}

/* â”€â”€ CONFIRM OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#cov{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:700;display:flex;align-items:center;justify-content:center;padding:1rem;backdrop-filter:blur(3px)}
#cov.hidden{display:none!important}
.co-box{background:#fff;border-radius:18px;padding:1.6rem;max-width:380px;width:100%;box-shadow:var(--shadow-lg)}
.co-box h3{margin-bottom:.5rem;font-size:1.1rem}
.co-box p{color:var(--muted);font-size:.875rem;margin-bottom:1.3rem;line-height:1.5}
.co-acts{display:flex;gap:.75rem;justify-content:flex-end}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#app-footer{
  background:var(--navy);color:rgba(255,255,255,.5);
  text-align:center;padding:1.5rem;
  font-size:.78rem;margin-top:auto;
  line-height:1.8;
}
#app-footer a{color:var(--gold);opacity:.8}
#app-footer strong{color:rgba(255,255,255,.8)}

/* â”€â”€ LOADING OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#global-loader{
  position:fixed;inset:0;
  background:rgba(30,45,61,.9);
  z-index:9999;display:flex;flex-direction:column;
  align-items:center;justify-content:center;gap:1rem;
}
#global-loader.hidden{display:none!important}
.loader-logo{height:64px;filter:drop-shadow(0 4px 16px rgba(0,0,0,.5))}
.loader-text{color:rgba(255,255,255,.7);font-size:.875rem}
.loader-spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,.15);border-top-color:var(--gold);border-radius:50%;animation:spin .7s linear infinite}

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:768px){
  .auth-container{flex-direction:column;align-items:stretch}
  .auth-brand-panel{text-align:center;padding:1rem 0}
  .auth-brand-panel img{display:none}
  .auth-headline{font-size:2.5rem}
  .auth-stats{justify-content:center}
  .auth-card{min-width:unset;max-width:100%}
  .stat-row{grid-template-columns:1fr 1fr}
  .form-row{grid-template-columns:1fr}
  .adm-sb{width:190px}
}
@media(max-width:520px){
  .pw{padding:1rem}
  .adm-wrap{flex-direction:column}
  .adm-sb{width:100%;height:auto;position:static;display:flex;flex-wrap:wrap;padding:.4rem}
  .sb-item{padding:.4rem .7rem;border-left:none;border-bottom:2px solid transparent;font-size:.75rem;flex-direction:column;gap:.15rem}
  .sb-item.on{border-bottom-color:var(--gold);border-left:none}
  .sb-sect{display:none}
  .adm-main{padding:.9rem}
  #pg-admin.on{flex-direction:column}
  .auth-headline{font-size:2rem}
  .stat-row{grid-template-columns:repeat(3,1fr)}
  .stat-val{font-size:1.5rem}
}
@media print{
  #hdr,#nav,.cert-ov-acts{display:none!important}
  #cert-ov{position:static;background:none;padding:0}
  .certificate{width:100%;box-shadow:none}
}
</style>
</head>
<body>

<!-- GLOBAL LOADER -->
<div id="global-loader">
  <div class="loader-spinner"></div>
  <img class="loader-logo" src="bridge4change-logo.png" alt="Bridge4Change" onerror="this.style.display='none'">
  <span class="loader-text">Loading your learning portalâ€¦</span>
</div>

<!-- HEADER -->
<header id="hdr" style="display:none">
  <div class="hdr-logo-wrap">
    <img id="hdr-logo" src="bridge4change-logo.png" alt="B4C" onerror="this.style.display='none'">
    <div>
      <div class="hdr-brand">Bridge4Change<small>Learning Portal</small></div>
    </div>
  </div>
  <div class="hdr-right" id="hdr-r" style="display:none">
    <div id="hdr-av">?</div>
    <span id="hdr-nm"></span>
    <span class="hdr-pts-pill" id="hdr-pts" style="display:none"></span>
    <button id="hdr-out" onclick="logout()">Logout</button>
  </div>
</header>

<!-- NAV (shown when logged in) -->
<nav id="nav" style="display:none">
  <button class="nav-i on" data-pg="pg-dash" onclick="goNav(this,'pg-dash')">ğŸ  Home</button>
  <button class="nav-i" data-pg="pg-vids" onclick="goNav(this,'pg-vids')">ğŸ¬ Videos</button>
  <button class="nav-i" data-pg="pg-arts" onclick="goNav(this,'pg-arts')">ğŸ“š Articles</button>
  <button class="nav-i" data-pg="pg-quizzes" onclick="goNav(this,'pg-quizzes')">ğŸ§  Quizzes</button>
  <button class="nav-i" data-pg="pg-prog" onclick="goNav(this,'pg-prog')">ğŸ“Š Progress</button>
  <button class="nav-i" data-pg="pg-lb" onclick="goNav(this,'pg-lb')">ğŸ† Leaderboard</button>
  <button class="nav-i" data-pg="pg-certs" onclick="goNav(this,'pg-certs')">ğŸ“ Certificates</button>
  <button class="nav-i" data-pg="pg-about" onclick="goNav(this,'pg-about')">â„¹ï¸ About</button>
</nav>

<!-- â”€â”€ WELCOME / AUTH â”€â”€ -->
<div id="pg-welcome" class="pg on">
  <div id="pg-welcome-inner">
    <!-- Inner replaced by JS -->
  </div>
</div>

<!-- â”€â”€ ADMIN LOGIN â”€â”€ -->
<div id="pg-adm-login" class="pg">
  <div class="adm-login-card">
    <h2>ğŸ›¡ Admin Panel</h2>
    <p>Manage content, quizzes, and learners</p>
    <div class="fg"><label>Admin Password</label><input id="ap" type="password" placeholder="Enter password"></div>
    <div id="adm-err" class="alert alert-err hidden"></div>
    <button class="btn btn-dark" style="width:100%;padding:.85rem" onclick="doAdminLogin()">Login to Admin â†’</button>
    <div style="margin-top:.8rem;text-align:center">
      <button class="btn btn-secondary btn-sm" onclick="showPg('pg-welcome')">â† Back</button>
    </div>
  </div>
</div>

<!-- â”€â”€ STUDENT DASHBOARD â”€â”€ -->
<div id="pg-dash" class="pg" style="display:none">
  <div class="pw">
    <div class="dash-hero">
      <h2 id="dash-hi">Welcome back! ğŸ‘‹</h2>
      <p id="dash-sub">Continue your learning journey</p>
      <div class="dash-pts-row">
        <span class="dash-pts-big" id="dash-pts">0</span>
        <span class="dash-pts-label">points earned</span>
        <span class="dash-rank-pill" id="dash-rank"># â€“ Rank</span>
      </div>
    </div>
    <div class="stat-row">
      <div class="stat-card vid"><div class="stat-val" id="ds-v">0</div><div class="stat-lbl">Videos Done</div></div>
      <div class="stat-card art"><div class="stat-val" id="ds-a">0</div><div class="stat-lbl">Articles Read</div></div>
      <div class="stat-card qz"><div class="stat-val" id="ds-q">0</div><div class="stat-lbl">Quizzes Taken</div></div>
    </div>
    <div style="margin-bottom:1.5rem">
      <div style="display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted);margin-bottom:.35rem">
        <span>Overall completion</span><span id="ds-pct" style="font-weight:700;color:var(--navy)">0%</span>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="ds-bar" style="width:0%"></div></div>
    </div>
    <div class="section-hd">ğŸ“Œ Recently Added</div>
    <div id="dash-recent" class="cards"><div class="spinner"></div></div>
  </div>
</div>

<!-- â”€â”€ VIDEOS â”€â”€ -->
<div id="pg-vids" class="pg" style="display:none">
  <div class="pw">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem;flex-wrap:wrap;gap:.8rem">
      <div class="section-hd" style="margin:0;border:none;padding:0">ğŸ¬ Videos</div>
      <input style="max-width:220px;font-size:.85rem;padding:.5rem .85rem" type="text" placeholder="ğŸ” Search videosâ€¦" oninput="filterCards('vid-cards',this.value)">
    </div>
    <div id="vid-cards" class="cards"><div class="spinner"></div></div>
  </div>
</div>

<!-- â”€â”€ ARTICLES â”€â”€ -->
<div id="pg-arts" class="pg" style="display:none">
  <div class="pw">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.2rem;flex-wrap:wrap;gap:.8rem">
      <div class="section-hd" style="margin:0;border:none;padding:0">ğŸ“š Articles</div>
      <input style="max-width:220px;font-size:.85rem;padding:.5rem .85rem" type="text" placeholder="ğŸ” Search articlesâ€¦" oninput="filterCards('art-cards',this.value)">
    </div>
    <div id="art-cards" class="cards"><div class="spinner"></div></div>
  </div>
</div>

<!-- â”€â”€ QUIZZES â”€â”€ -->
<div id="pg-quizzes" class="pg" style="display:none">
  <div class="pw">
    <div class="section-hd">ğŸ§  Available Quizzes</div>
    <div id="quiz-cards" class="cards"><div class="spinner"></div></div>
  </div>
</div>

<!-- â”€â”€ PROGRESS â”€â”€ -->
<div id="pg-prog" class="pg" style="display:none">
  <div class="pw">
    <div class="section-hd">ğŸ“Š My Progress</div>
    <div id="prog-list"><div class="spinner"></div></div>
  </div>
</div>

<!-- â”€â”€ LEADERBOARD â”€â”€ -->
<div id="pg-lb" class="pg" style="display:none">
  <div class="pw">
    <div class="section-hd">ğŸ† Leaderboard</div>
    <div class="adm-card" style="padding:0;overflow:hidden">
      <div id="lb-body"><div class="spinner"></div></div>
    </div>
  </div>
</div>

<!-- â”€â”€ CERTIFICATES â”€â”€ -->
<div id="pg-certs" class="pg" style="display:none">
  <div class="pw">
    <div class="section-hd">ğŸ“ My Certificates</div>
    <div class="cert-milestones" id="cert-milestones"></div>
    <div class="section-hd">ğŸ“œ My Earned Certificates</div>
    <div id="cert-list" class="cards"></div>
  </div>
</div>

<!-- â”€â”€ ABOUT â”€â”€ -->
<div id="pg-about" class="pg" style="display:none">
  <div class="pw">
    <div class="about-hero">
      <img src="bridge4change-logo.png" alt="Bridge4Change" onerror="this.style.display='none'">
      <h2 id="about-title">Bridge4Change</h2>
      <p id="about-tagline">Empowering learners with knowledge</p>
    </div>
    <div class="adm-card">
      <h3>About This Programme</h3>
      <p id="about-text" style="line-height:1.7;color:var(--text)">Loadingâ€¦</p>
    </div>
    <div class="adm-card" style="margin-top:1rem">
      <h3>Contact</h3>
      <p id="about-contact" style="color:var(--muted)"></p>
    </div>
  </div>
</div>

<!-- â”€â”€ ADMIN â”€â”€ -->
<div id="pg-admin">
  <div class="adm-wrap">
    <aside class="adm-sb">
      <div class="sb-sect">Overview</div>
      <button class="sb-item on" data-s="as-dash" onclick="admNav(this,'as-dash')">ğŸ“Š Dashboard</button>
      <button class="sb-item" data-s="as-users" onclick="admNav(this,'as-users')">ğŸ‘¥ Users</button>
      <div class="sb-sect">Content</div>
      <button class="sb-item" data-s="as-vids" onclick="admNav(this,'as-vids')">ğŸ¬ Videos</button>
      <button class="sb-item" data-s="as-arts" onclick="admNav(this,'as-arts')">ğŸ“š Articles</button>
      <button class="sb-item" data-s="as-qz" onclick="admNav(this,'as-qz')">ğŸ§  Quizzes</button>
      <div class="sb-sect">Settings</div>
      <button class="sb-item" data-s="as-portal" onclick="admNav(this,'as-portal')">ğŸŒ Portal Info</button>
      <button class="sb-item" data-s="as-certs-cfg" onclick="admNav(this,'as-certs-cfg')">ğŸ“ Certificates</button>
      <button class="sb-item" data-s="as-settings" onclick="admNav(this,'as-settings')">âš™ï¸ Settings</button>
      <div style="padding:1.2rem">
        <button class="btn btn-sm" style="width:100%;background:rgba(255,255,255,.1);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.15)" onclick="admLogout()">â† Exit Admin</button>
      </div>
    </aside>
    <main class="adm-main">
      <!-- ADMIN DASH -->
      <div id="as-dash" class="as on">
        <div class="adm-card">
          <h3>âš¡ System Overview</h3>
          <div class="stat-row" style="grid-template-columns:repeat(4,1fr)">
            <div class="stat-card"><div class="stat-val" id="adm-stat-users">â€“</div><div class="stat-lbl">Users</div></div>
            <div class="stat-card"><div class="stat-val" id="adm-stat-vids">â€“</div><div class="stat-lbl">Videos</div></div>
            <div class="stat-card"><div class="stat-val" id="adm-stat-arts">â€“</div><div class="stat-lbl">Articles</div></div>
            <div class="stat-card"><div class="stat-val" id="adm-stat-qzs">â€“</div><div class="stat-lbl">Quizzes</div></div>
          </div>
        </div>
        <div class="adm-card">
          <h3>ğŸ“¡ Backend Status</h3>
          <div id="backend-status-info">
            <p style="color:var(--muted);font-size:.875rem">Checking connection to Google Sheets backendâ€¦</p>
          </div>
          <div style="margin-top:1rem">
            <label>Apps Script URL</label>
            <div style="display:flex;gap:.5rem">
              <input id="adm-api-url" type="url" placeholder="https://script.google.com/macros/s/â€¦/exec" value="">
              <button class="btn btn-dark btn-sm" onclick="saveApiUrl()" style="white-space:nowrap;flex-shrink:0">Save & Test</button>
            </div>
            <p style="font-size:.75rem;color:var(--muted);margin-top:.4rem">Paste your deployed Google Apps Script URL here. This is stored locally.</p>
          </div>
        </div>
      </div>

      <!-- ADMIN USERS -->
      <div id="as-users" class="as">
        <div class="adm-card">
          <h3>ğŸ‘¥ Registered Users</h3>
          <div id="adm-users-loading"><div class="spinner"></div></div>
          <div style="overflow-x:auto">
            <table class="adm-table" id="adm-user-table" style="display:none">
              <thead><tr><th>Name</th><th>Email</th><th>Institution</th><th>Cohort</th><th>Points</th><th>Joined</th><th>Actions</th></tr></thead>
              <tbody id="adm-user-tbody"></tbody>
            </table>
          </div>
          <button class="btn btn-secondary btn-sm" style="margin-top:.8rem" onclick="loadAdmUsers()">ğŸ”„ Refresh</button>
        </div>
      </div>

      <!-- ADMIN VIDEOS -->
      <div id="as-vids" class="as">
        <div class="adm-card" id="vid-form-card">
          <h3 id="vf-title">â• Add New Video</h3>
          <input type="hidden" id="vf-id">
          <div class="form-row">
            <div class="fg"><label>Title *</label><input id="vf-nm" placeholder="Video title" maxlength="120"></div>
            <div class="fg"><label>Category / Tag</label><input id="vf-tag" placeholder="e.g. Leadership"></div>
          </div>
          <div class="fg"><label>YouTube URL *</label><input id="vf-url" type="url" placeholder="https://youtube.com/watch?v=â€¦"></div>
          <div class="form-row">
            <div class="fg"><label>Duration (e.g. 12 min)</label><input id="vf-dur" placeholder="12 min" maxlength="20"></div>
            <div class="fg"><label>Points for Watching</label><input id="vf-pts" type="number" value="5" min="0"></div>
          </div>
          <div class="fg"><label>Description (optional)</label><textarea id="vf-desc" rows="2" placeholder="Brief descriptionâ€¦"></textarea></div>
          <div class="fg" style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" id="vf-active" checked style="width:auto;margin:0">
            <label style="margin:0;font-size:.85rem;text-transform:none;letter-spacing:0;color:var(--text)">Active (visible to students)</label>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn btn-primary" onclick="saveVideo()">ğŸ’¾ Save Video</button>
            <button class="btn btn-secondary btn-sm" onclick="clrVid()">âœ• Clear</button>
          </div>
        </div>
        <div class="adm-card">
          <h3>ğŸ¬ All Videos</h3>
          <div style="overflow-x:auto">
            <table class="adm-table">
              <thead><tr><th>Title</th><th>Category</th><th>Duration</th><th>Points</th><th>Active</th><th>Actions</th></tr></thead>
              <tbody id="vf-tb"></tbody>
            </table>
          </div>
          <button class="btn btn-secondary btn-sm" style="margin-top:.8rem" onclick="loadAdmVids()">ğŸ”„ Refresh</button>
        </div>
      </div>

      <!-- ADMIN ARTICLES -->
      <div id="as-arts" class="as">
        <div class="adm-card">
          <h3 id="af-title">â• Add New Article</h3>
          <input type="hidden" id="af-id">
          <div class="form-row">
            <div class="fg"><label>Title *</label><input id="af-nm" placeholder="Article title" maxlength="150"></div>
            <div class="fg"><label>Category / Tag</label><input id="af-tag" placeholder="e.g. Sustainability"></div>
          </div>
          <div class="fg"><label>Article URL *</label><input id="af-url" type="url" placeholder="https://â€¦"></div>
          <div class="form-row">
            <div class="fg"><label>Read Time (e.g. 5 min)</label><input id="af-dur" placeholder="5 min read" maxlength="20"></div>
            <div class="fg"><label>Points for Reading</label><input id="af-pts" type="number" value="3" min="0"></div>
          </div>
          <div class="fg"><label>Description (optional)</label><textarea id="af-desc" rows="2" placeholder="Brief descriptionâ€¦"></textarea></div>
          <div class="fg" style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" id="af-active" checked style="width:auto;margin:0">
            <label style="margin:0;font-size:.85rem;text-transform:none;letter-spacing:0;color:var(--text)">Active (visible to students)</label>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn btn-primary" onclick="saveArticle()">ğŸ’¾ Save Article</button>
            <button class="btn btn-secondary btn-sm" onclick="clrArt()">âœ• Clear</button>
          </div>
        </div>
        <div class="adm-card">
          <h3>ğŸ“š All Articles</h3>
          <div style="overflow-x:auto">
            <table class="adm-table">
              <thead><tr><th>Title</th><th>Category</th><th>Read Time</th><th>Points</th><th>Active</th><th>Actions</th></tr></thead>
              <tbody id="af-tb"></tbody>
            </table>
          </div>
          <button class="btn btn-secondary btn-sm" style="margin-top:.8rem" onclick="loadAdmArts()">ğŸ”„ Refresh</button>
        </div>
      </div>

      <!-- ADMIN QUIZZES -->
      <div id="as-qz" class="as">
        <div class="adm-card">
          <h3 id="qf-t">â• Create New Quiz</h3>
          <input type="hidden" id="qf-id">
          <div class="form-row">
            <div class="fg"><label>Quiz Title *</label><input id="qf-nm" placeholder="Quiz title" maxlength="120"></div>
            <div class="fg"><label>Points Awarded</label><input id="qf-pt" type="number" value="10" min="0"></div>
          </div>
          <div class="form-row">
            <div class="fg">
              <label>Link To</label>
              <select id="qf-ct">
                <option value="standalone">Standalone Quiz</option>
                <option value="video">A Video</option>
                <option value="article">An Article</option>
              </select>
            </div>
            <div class="fg">
              <label>Content Item</label>
              <select id="qf-ci"><option value="">â€” Select above first â€”</option></select>
            </div>
          </div>
          <div class="fg" style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" id="qf-re" style="width:auto;margin:0">
            <label style="margin:0;font-size:.85rem;text-transform:none;letter-spacing:0;color:var(--text)">Allow retry</label>
          </div>
          <div class="fg" style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" id="qf-active" checked style="width:auto;margin:0">
            <label style="margin:0;font-size:.85rem;text-transform:none;letter-spacing:0;color:var(--text)">Active (visible to students)</label>
          </div>
          <!-- Question builder -->
          <div class="adm-card" style="background:var(--snow);box-shadow:none;border:1.5px solid var(--border)">
            <h3>Questions</h3>
            <div class="inline-tabs">
              <button class="itab on" onclick="addQ('mcq',this)">+ MCQ</button>
              <button class="itab" onclick="addQ('multi',this)">+ Multi-Select</button>
              <button class="itab" onclick="addQ('tf',this)">+ True/False</button>
              <button class="itab" onclick="addQ('long',this)">+ Long Answer</button>
            </div>
            <div id="qf-qw"><p style="color:var(--muted);font-size:.85rem">Click a button above to add a question.</p></div>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn btn-primary" onclick="saveQuiz()">ğŸ’¾ Save Quiz</button>
            <button class="btn btn-secondary btn-sm" onclick="clrQz()">âœ• Clear</button>
          </div>
        </div>
        <div class="adm-card">
          <h3>ğŸ§  All Quizzes</h3>
          <div style="overflow-x:auto">
            <table class="adm-table">
              <thead><tr><th>Title</th><th>Linked To</th><th>Questions</th><th>Points</th><th>Retry</th><th>Active</th><th>Actions</th></tr></thead>
              <tbody id="qf-tb"></tbody>
            </table>
          </div>
          <button class="btn btn-secondary btn-sm" style="margin-top:.8rem" onclick="loadAdmQzs()">ğŸ”„ Refresh</button>
        </div>
      </div>

      <!-- ADMIN PORTAL INFO -->
      <div id="as-portal" class="as">
        <div class="adm-card">
          <h3>ğŸŒ Portal Info</h3>
          <div class="fg"><label>Portal Title</label><input id="pi-title" value="Bridge4Change Learning Portal"></div>
          <div class="fg"><label>Tagline</label><input id="pi-tagline" value="Empowering learners with knowledge"></div>
          <div class="fg"><label>About Text</label><textarea id="pi-about" rows="4"></textarea></div>
          <div class="fg"><label>Contact Info</label><input id="pi-contact" placeholder="e.g. info@bridge4change.org"></div>
          <button class="btn btn-primary" onclick="savePortalInfo()">ğŸ’¾ Save Info</button>
        </div>
        <div class="adm-card">
          <h3>ğŸ“Š Dynamic Stats (shown on login screen)</h3>
          <p style="color:var(--muted);font-size:.85rem;margin-bottom:.75rem">These numbers are displayed on the portal welcome screen to inspire new learners.</p>
          <div class="form-row">
            <div class="fg"><label>Total Learners Stat</label><input id="pi-stat-learners" type="number" value="500" placeholder="500"></div>
            <div class="fg"><label>Videos Stat</label><input id="pi-stat-vids" type="number" value="30" placeholder="30"></div>
            <div class="fg"><label>Articles Stat</label><input id="pi-stat-arts" type="number" value="50" placeholder="50"></div>
          </div>
          <button class="btn btn-primary" onclick="savePortalStats()">ğŸ’¾ Save Stats</button>
        </div>
      </div>

      <!-- ADMIN CERTS CFG -->
      <div id="as-certs-cfg" class="as">
        <div class="adm-card">
          <h3>ğŸ“ Certificate Milestones</h3>
          <p style="color:var(--muted);font-size:.85rem;margin-bottom:1rem">Set how many points are needed for each certificate tier.</p>
          <div class="form-row">
            <div class="fg"><label>ğŸ¥‰ Bronze (pts)</label><input id="cert-br" type="number" value="100"></div>
            <div class="fg"><label>ğŸ¥ˆ Silver (pts)</label><input id="cert-si" type="number" value="300"></div>
            <div class="fg"><label>ğŸ¥‡ Gold (pts)</label><input id="cert-go" type="number" value="500"></div>
            <div class="fg"><label>ğŸ’ Platinum (pts)</label><input id="cert-pl" type="number" value="1000"></div>
          </div>
          <div class="fg"><label>Issuing Organisation Name</label><input id="cert-org" value="Bridge4Change Foundation"></div>
          <div class="form-row">
            <div class="fg"><label>Signatory Name</label><input id="cert-sn" placeholder="e.g. Dr. Jane Smith"></div>
            <div class="fg"><label>Signatory Title</label><input id="cert-st" placeholder="Programme Director"></div>
          </div>
          <button class="btn btn-primary" onclick="saveCertCfg()">ğŸ’¾ Save Settings</button>
        </div>
      </div>

      <!-- ADMIN SETTINGS -->
      <div id="as-settings" class="as">
        <div class="adm-card">
          <h3>ğŸ”‘ Change Admin Password</h3>
          <p style="color:var(--muted);font-size:.85rem;margin-bottom:1rem">The admin password is stored securely in Google Sheets Settings tab.</p>
          <div class="form-row">
            <div class="fg"><label>New Password</label><input id="st-np" type="password" placeholder="New password"></div>
            <div class="fg"><label>Confirm Password</label><input id="st-cp" type="password" placeholder="Confirm password"></div>
          </div>
          <button class="btn btn-primary" onclick="changeAdmPass()">Update Password</button>
        </div>
        <div class="adm-card">
          <h3>ğŸ“¤ Data Management</h3>
          <div style="display:flex;gap:.75rem;flex-wrap:wrap">
            <button class="btn btn-secondary" onclick="exportAllData()">ğŸ“¥ Export Backup JSON</button>
          </div>
          <div style="margin-top:1.2rem;padding:1rem;background:var(--red-bg);border-radius:var(--r-sm);border:1px solid #FCA5A5">
            <h4 style="color:var(--red);margin-bottom:.5rem;font-size:.875rem">âš ï¸ Danger Zone</h4>
            <p style="font-size:.8rem;color:var(--red);margin-bottom:.75rem">This will clear all local session data. Backend data in Google Sheets is NOT affected.</p>
            <button class="btn btn-danger btn-sm" onclick="confirmResetLocal()">Clear Local Session</button>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- â”€â”€ QUIZ OVERLAY â”€â”€ -->
<div id="qov" class="hidden">
  <div class="quiz-modal" id="qm-body">
    <!-- Populated by JS -->
  </div>
</div>

<!-- â”€â”€ CERTIFICATE OVERLAY â”€â”€ -->
<div id="cert-ov" class="hidden">
  <div class="certificate" id="cert-print">
    <div class="cert-strip bronze" id="cert-strip"></div>
    <div class="cert-hdr">
      <img class="cert-hdr-logo" id="cert-logo" src="bridge4change-logo.png" alt="B4C" onerror="this.style.display='none'">
      <div>
        <div class="cert-hdr-org" id="cert-org">Bridge4Change Foundation</div>
        <div class="cert-hdr-sub">Certificate of Achievement</div>
      </div>
    </div>
    <div class="cert-body">
      <div style="font-size:.75rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--muted);margin-bottom:.3rem">This is to certify that</div>
      <div class="cert-name" id="cert-uname">Student Name</div>
      <div class="cert-title-txt" id="cert-tier-txt">has earned the Bronze Certificate</div>
      <div style="font-size:.85rem;color:var(--muted);margin:.5rem 0">by achieving <strong id="cert-pts-n">100</strong> points in the Bridge4Change Learning Programme</div>
      <div style="display:flex;justify-content:center;align-items:center;gap:2rem;margin-top:1rem">
        <div style="text-align:center">
          <div style="width:120px;height:1.5px;background:var(--navy);margin-bottom:.3rem"></div>
          <div style="font-size:.75rem;color:var(--muted)" id="cert-sn">Programme Director</div>
          <div style="font-size:.7rem;color:var(--muted)" id="cert-st">Bridge4Change</div>
        </div>
      </div>
    </div>
    <div class="cert-ftr">
      <div class="cert-ftr-issued">Issued by <strong id="cert-issuer">Bridge4Change Foundation</strong><br><span id="cert-date"></span></div>
      <div class="cert-id-pill" id="cert-id">CRT-0000</div>
    </div>
  </div>
  <div class="cert-ov-acts">
    <button class="btn btn-primary" onclick="downloadCert()">ğŸ“¥ Download</button>
    <button class="btn btn-secondary" onclick="closeCertOv()">Close</button>
  </div>
</div>

<!-- â”€â”€ CONFIRM OVERLAY â”€â”€ -->
<div id="cov" class="hidden">
  <div class="co-box">
    <h3 id="co-t">Confirm</h3>
    <p id="co-m">Are you sure?</p>
    <div class="co-acts">
      <button class="btn btn-secondary btn-sm" onclick="closeCo()">Cancel</button>
      <button class="btn btn-primary btn-sm" id="co-ok">Confirm</button>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer id="app-footer" style="display:none">
  <strong>Bridge4Change Learning Portal</strong><br>
  Empowering learners to create positive change.<br>
  <span style="font-size:.7rem;opacity:.5">Â© 2025 Bridge4Change Foundation Â· All rights reserved</span>
</footer>

<!-- ============================================================
  JAVASCRIPT - BACKEND API LAYER
  All data operations go through API calls to Google Apps Script
  No sensitive data is stored in localStorage except session token
============================================================ -->
<script>
'use strict';

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONFIG â€” only thing stored locally: API URL + session token
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const LS_TOKEN = 'b4c_token';
const LS_USER  = 'b4c_user';   // cached display info only
const LS_API   = 'b4c_api_url';

// Cache for content (refreshed from API)
let CONTENT = { videos:[], articles:[], quizzes:[], settings:{} };
let CURRENT_USER = null;
let IS_ADMIN = false;

// Quiz overlay state
let QZ_STATE = { quiz:null, qIdx:0, answers:{}, shown:false };

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// UTILITIES
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const g = id => document.getElementById(id);
const esc = s => String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
function toast(msg, type='ok') {
  const t = document.createElement('div');
  t.className = 'toast';
  if(type==='err') t.style.background = 'var(--red)';
  t.textContent = msg;
  document.body.appendChild(t);
  setTimeout(()=>{if(t.parentNode)t.remove();}, 3200);
}
function showErr(elId, msg){
  const el = g(elId);
  if(!el) return;
  el.textContent = msg;
  el.classList.remove('hidden');
  setTimeout(()=>el.classList.add('hidden'), 6000);
}
function showPg(id) {
  document.querySelectorAll('.pg').forEach(p => { p.style.display='none'; p.classList.remove('on'); });
  const pg = g(id);
  if(pg){ pg.style.display='block'; pg.classList.add('on'); }
}
function goNav(btn, pgId) {
  document.querySelectorAll('.nav-i').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  showPg(pgId);
  if(pgId==='pg-dash') renderDash();
  if(pgId==='pg-vids') renderVids();
  if(pgId==='pg-arts') renderArts();
  if(pgId==='pg-quizzes') renderQuizList();
  if(pgId==='pg-prog') renderProg();
  if(pgId==='pg-lb') renderLB();
  if(pgId==='pg-certs') renderCerts();
  if(pgId==='pg-about') renderAbout();
}
function admNav(btn, secId) {
  document.querySelectorAll('.sb-item').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  document.querySelectorAll('.as').forEach(s=>{s.style.display='none';s.classList.remove('on');});
  const sec = g(secId);
  if(sec){ sec.style.display='block'; sec.classList.add('on'); }
  if(secId==='as-users') loadAdmUsers();
  if(secId==='as-vids') loadAdmVids();
  if(secId==='as-arts') loadAdmArts();
  if(secId==='as-qz') { loadAdmQzs(); refDrop(); }
  if(secId==='as-dash') checkBackendStatus();
  if(secId==='as-portal') loadPortalInfoForm();
  if(secId==='as-certs-cfg') loadCertCfgForm();
}
function showLoader(show) {
  g('global-loader').classList.toggle('hidden', !show);
}
function filterCards(containerId, query) {
  const q = query.toLowerCase().trim();
  document.querySelectorAll(`#${containerId} .card`).forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = (!q || text.includes(q)) ? '' : 'none';
  });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// API LAYER
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getApiUrl() {
  return localStorage.getItem(LS_API) || '';
}
async function apiCall(action, payload={}) {
  const apiUrl = getApiUrl();
  if(!apiUrl) throw new Error('API URL not configured. Please set it in Admin â†’ Dashboard.');
  const token = localStorage.getItem(LS_TOKEN);
  const body = { action, token, ...payload };
  const resp = await fetch(apiUrl, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(body)
  });
  if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
  const data = await resp.json();
  if(data.error) throw new Error(data.error);
  return data;
}
async function apiGet(action, params={}) {
  const apiUrl = getApiUrl();
  if(!apiUrl) throw new Error('API URL not configured.');
  const token = localStorage.getItem(LS_TOKEN);
  const qs = new URLSearchParams({ action, token, ...params }).toString();
  const resp = await fetch(`${apiUrl}?${qs}`);
  if(!resp.ok) throw new Error(`HTTP ${resp.status}`);
  const data = await resp.json();
  if(data.error) throw new Error(data.error);
  return data;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AUTH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWelcomePage() {
  const cfg = CONTENT.settings || {};
  const learners = cfg.stat_learners || '500+';
  const videos   = cfg.stat_videos   || '30+';
  const articles = cfg.stat_articles || '50+';
  g('pg-welcome-inner').innerHTML = `
    <div class="auth-container">
      <div class="auth-brand-panel">
        <img src="bridge4change-logo.png" alt="Bridge4Change" onerror="this.style.display='none'">
        <div class="auth-headline">BUILD YOUR <span>BRIDGE</span> TO CHANGE</div>
        <div class="auth-tagline">${esc(cfg.tagline||'Unlock knowledge, earn recognition, and join a community of changemakers.')}</div>
        <div class="auth-stats">
          <div><div class="auth-stat-n">${esc(String(learners))}</div><div class="auth-stat-l">Learners</div></div>
          <div><div class="auth-stat-n">${esc(String(videos))}</div><div class="auth-stat-l">Videos</div></div>
          <div><div class="auth-stat-n">${esc(String(articles))}</div><div class="auth-stat-l">Articles</div></div>
        </div>
      </div>
      <div class="auth-card">
        <div class="auth-card-header">
          <h2>Welcome Back</h2>
          <p>Sign in or create your account</p>
        </div>
        <div class="auth-tabs">
          <button class="auth-tab on" onclick="switchAuthTab('login',this)">Login</button>
          <button class="auth-tab" onclick="switchAuthTab('signup',this)">Sign Up</button>
        </div>
        <!-- LOGIN FORM -->
        <div id="auth-form-login" class="auth-form on">
          <div class="fg"><label>Email Address</label><input id="li-email" type="email" placeholder="you@example.com" autocomplete="email"></div>
          <div class="fg"><label>Password</label><input id="li-pass" type="password" placeholder="Your password" autocomplete="current-password"></div>
          <div id="li-err" class="alert alert-err hidden"></div>
          <button class="btn btn-primary" id="li-btn" onclick="doLogin()">Sign In â†’</button>
        </div>
        <!-- SIGNUP FORM -->
        <div id="auth-form-signup" class="auth-form">
          <div class="fg"><label>Full Name *</label><input id="su-name" placeholder="Your full name" maxlength="80" autocomplete="name"></div>
          <div class="fg"><label>Email Address *</label><input id="su-email" type="email" placeholder="you@example.com" autocomplete="email"></div>
          <div class="fg"><label>Password *</label><input id="su-pass" type="password" placeholder="At least 8 characters" autocomplete="new-password"></div>
          <div class="fg"><label>Institution / Organisation</label><input id="su-inst" placeholder="e.g. IIT Delhi" maxlength="100"></div>
          <div class="fg"><label>Cohort / Batch (optional)</label><input id="su-cohort" placeholder="e.g. Batch 2025" maxlength="60"></div>
          <div id="su-err" class="alert alert-err hidden"></div>
          <button class="btn btn-primary" id="su-btn" onclick="doSignup()">Create Account â†’</button>
        </div>
        <div class="admin-link"><button onclick="goAdminLogin()">ğŸ›¡ Admin Login</button></div>
      </div>
    </div>`;
}
function switchAuthTab(tab, btn) {
  document.querySelectorAll('.auth-tab').forEach(b=>b.classList.remove('on'));
  btn.classList.add('on');
  document.querySelectorAll('.auth-form').forEach(f=>f.classList.remove('on'));
  g(`auth-form-${tab}`).classList.add('on');
}
async function doLogin() {
  const email = g('li-email').value.trim();
  const pass  = g('li-pass').value;
  if(!email||!pass){ showErr('li-err','Please enter email and password.'); return; }
  g('li-btn').disabled = true; g('li-btn').textContent = 'Signing inâ€¦';
  try {
    const res = await apiCall('login', {email, password:pass});
    localStorage.setItem(LS_TOKEN, res.token);
    localStorage.setItem(LS_USER, JSON.stringify(res.user));
    await enterPortal(res.user);
  } catch(e) {
    showErr('li-err', e.message||'Login failed. Check your credentials.');
  } finally {
    g('li-btn').disabled=false; g('li-btn').textContent='Sign In â†’';
  }
}
async function doSignup() {
  const name   = g('su-name').value.trim();
  const email  = g('su-email').value.trim();
  const pass   = g('su-pass').value;
  const inst   = g('su-inst').value.trim();
  const cohort = g('su-cohort').value.trim();
  if(!name||!email||!pass){ showErr('su-err','Name, email, and password are required.'); return; }
  if(pass.length<8){ showErr('su-err','Password must be at least 8 characters.'); return; }
  g('su-btn').disabled=true; g('su-btn').textContent='Creating accountâ€¦';
  try {
    const res = await apiCall('signup', {name, email, password:pass, institution:inst, cohort});
    localStorage.setItem(LS_TOKEN, res.token);
    localStorage.setItem(LS_USER, JSON.stringify(res.user));
    await enterPortal(res.user);
    toast('ğŸ‰ Welcome to Bridge4Change!');
  } catch(e) {
    showErr('su-err', e.message||'Sign-up failed. Please try again.');
  } finally {
    g('su-btn').disabled=false; g('su-btn').textContent='Create Account â†’';
  }
}
async function enterPortal(user) {
  CURRENT_USER = user;
  // Load all content
  showLoader(true);
  try {
    const [contentRes, settingsRes] = await Promise.all([
      apiGet('content'),
      apiGet('settings')
    ]);
    CONTENT.videos   = contentRes.videos   || [];
    CONTENT.articles = contentRes.articles || [];
    CONTENT.quizzes  = contentRes.quizzes  || [];
    CONTENT.settings = settingsRes.settings|| {};
  } catch(e) {
    toast('Warning: Could not load some content. Check connection.', 'err');
  }
  showLoader(false);
  // Show header + nav
  g('hdr').style.display='flex';
  g('nav').style.display='flex';
  g('app-footer').style.display='block';
  g('hdr-av').textContent = user.name.charAt(0).toUpperCase();
  g('hdr-nm').textContent = user.name.split(' ')[0];
  g('hdr-pts').style.display='inline';
  g('hdr-pts').textContent = (user.points||0)+' pts';
  g('hdr-r').style.display='flex';
  showPg('pg-dash');
  renderDash();
}
async function logout() {
  try { await apiCall('logout'); } catch(_){}
  localStorage.removeItem(LS_TOKEN);
  localStorage.removeItem(LS_USER);
  CURRENT_USER = null;
  IS_ADMIN = false;
  CONTENT = { videos:[], articles:[], quizzes:[], settings:{} };
  g('hdr').style.display='none';
  g('nav').style.display='none';
  g('app-footer').style.display='none';
  showPg('pg-welcome');
  renderWelcomePage();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN AUTH
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goAdminLogin(){
  g('hdr').style.display='none';
  g('nav').style.display='none';
  g('app-footer').style.display='none';
  document.querySelectorAll('.pg').forEach(p=>{p.style.display='none';p.classList.remove('on');});
  g('pg-adm-login').style.display='flex';
  g('pg-adm-login').classList.add('on');
}
async function doAdminLogin() {
  const pass = g('ap').value.trim();
  if(!pass){ showErr('adm-err','Enter password.'); return; }
  try {
    const res = await apiCall('adminLogin', {password: pass});
    if(res.success) {
      IS_ADMIN = true;
      localStorage.setItem(LS_TOKEN, res.token);
      // show admin panel
      document.querySelectorAll('.pg').forEach(p=>{p.style.display='none';p.classList.remove('on');});
      g('pg-admin').style.display='flex';
      g('pg-admin').classList.add('on');
      g('hdr').style.display='flex';
      g('hdr-r').style.display='none';
      g('adm-api-url').value = getApiUrl();
      checkBackendStatus();
      loadAdmStats();
    }
  } catch(e){
    showErr('adm-err', e.message||'Invalid password.');
  }
}
function admLogout() {
  IS_ADMIN = false;
  localStorage.removeItem(LS_TOKEN);
  g('pg-admin').style.display='none';
  g('pg-admin').classList.remove('on');
  g('hdr').style.display='none';
  renderWelcomePage();
  showPg('pg-welcome');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DASHBOARD
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function renderDash() {
  if(!CURRENT_USER) return;
  // Refresh user data
  try {
    const res = await apiGet('me');
    CURRENT_USER = res.user;
    localStorage.setItem(LS_USER, JSON.stringify(res.user));
  } catch(_) {}
  const u = CURRENT_USER;
  g('dash-hi').textContent = `Hello, ${u.name.split(' ')[0]}! ğŸ‘‹`;
  g('dash-sub').textContent = 'Keep learning and earning points!';
  g('dash-pts').textContent = u.points||0;
  // Rank
  try {
    const lb = await apiGet('leaderboard', {limit:100});
    const rank = (lb.entries||[]).findIndex(e=>e.userId===u.id)+1;
    g('dash-rank').textContent = rank>0 ? `#${rank} Rank` : 'â€”';
    g('hdr-pts').textContent = (u.points||0)+' pts';
  } catch(_){}
  // Progress stats
  const prog = u.progress||{};
  const vDone = (prog.videos||[]).length;
  const aDone = (prog.articles||[]).length;
  const qDone = (prog.quizzes||[]).length;
  const total = Math.max(1, CONTENT.videos.length+CONTENT.articles.length+CONTENT.quizzes.length);
  const done  = vDone+aDone+qDone;
  const pct   = Math.round((done/total)*100);
  g('ds-v').textContent = vDone;
  g('ds-a').textContent = aDone;
  g('ds-q').textContent = qDone;
  g('ds-pct').textContent = pct+'%';
  g('ds-bar').style.width = pct+'%';
  // Recent content
  const recent = [...CONTENT.videos.slice(-3).map(v=>({...v,_type:'video'})),
                  ...CONTENT.articles.slice(-3).map(a=>({...a,_type:'article'}))].slice(-4);
  g('dash-recent').innerHTML = recent.length
    ? recent.map(item=>renderContentCard(item, prog)).join('')
    : `<div class="empty"><span class="empty-icon">ğŸ“­</span><p>No content yet. Check back soon!</p></div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CONTENT RENDERING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderContentCard(item, prog={}) {
  const prog_ = CURRENT_USER?.progress||{};
  const type = item._type||item.type||'video';
  const doneArr = type==='video' ? (prog_.videos||[]) : (prog_.articles||[]);
  const done = doneArr.includes(item.id);
  const isVid = type==='video';
  const thumbClass = isVid ? 'vid-thumb' : 'art-thumb';
  const icon = isVid ? 'ğŸ¬' : 'ğŸ“–';
  return `
    <div class="card" onclick="openContent('${esc(item.id)}','${esc(type)}')">
      <div class="card-thumb ${thumbClass}">
        ${icon}
        ${done?'<div class="card-done-badge">âœ“</div>':''}
        ${item.points?`<div class="card-pts-badge">+${item.points} pts</div>`:''}
      </div>
      <div class="card-body">
        ${item.category?`<span class="card-tag">${esc(item.category)}</span>`:''}
        <div class="card-title">${esc(item.title)}</div>
        <div class="card-meta">${esc(item.duration||item.readTime||'')}${item.description?` Â· ${esc(item.description.substring(0,60))}â€¦`:''}</div>
        <div class="card-actions">
          <button class="btn btn-primary btn-sm">${done?'Review':'Start'}</button>
          ${done?'<span class="chip chip-green">âœ“ Done</span>':''}
        </div>
      </div>
    </div>`;
}
function renderVids() {
  const prog = CURRENT_USER?.progress||{};
  const active = CONTENT.videos.filter(v=>v.active!==false);
  g('vid-cards').innerHTML = active.length
    ? active.map(v=>renderContentCard({...v,_type:'video'}, prog)).join('')
    : `<div class="empty"><span class="empty-icon">ğŸ¬</span><p>No videos available yet.</p></div>`;
}
function renderArts() {
  const prog = CURRENT_USER?.progress||{};
  const active = CONTENT.articles.filter(a=>a.active!==false);
  g('art-cards').innerHTML = active.length
    ? active.map(a=>renderContentCard({...a,_type:'article'}, prog)).join('')
    : `<div class="empty"><span class="empty-icon">ğŸ“š</span><p>No articles available yet.</p></div>`;
}
function renderQuizList() {
  const prog = CURRENT_USER?.progress||{};
  const qDone = prog.quizzes||[];
  const active = CONTENT.quizzes.filter(q=>q.active!==false);
  g('quiz-cards').innerHTML = active.length
    ? active.map(q=>{
        const done = qDone.includes(q.id);
        return `
          <div class="card" onclick="openQuiz('${esc(q.id)}')">
            <div class="card-thumb" style="background:linear-gradient(135deg,#1A7A4A,#2D9A5A)">
              ğŸ§ 
              ${done?'<div class="card-done-badge">âœ“</div>':''}
              ${q.points?`<div class="card-pts-badge">+${q.points} pts</div>`:''}
            </div>
            <div class="card-body">
              <span class="card-tag">Quiz</span>
              <div class="card-title">${esc(q.title)}</div>
              <div class="card-meta">${(q.questions||[]).length} questions${q.allowRetry?' Â· Retryable':''}</div>
              <div class="card-actions">
                <button class="btn btn-primary btn-sm">${done&&!q.allowRetry?'Review':'Take Quiz'}</button>
                ${done?'<span class="chip chip-green">âœ“ Taken</span>':''}
              </div>
            </div>
          </div>`;
      }).join('')
    : `<div class="empty"><span class="empty-icon">ğŸ§ </span><p>No quizzes available yet.</p></div>`;
}
async function openContent(id, type) {
  const items = type==='video' ? CONTENT.videos : CONTENT.articles;
  const item  = items.find(i=>i.id===id);
  if(!item) return;
  // Mark as viewed server-side and award points
  try {
    const res = await apiCall('markContent', {contentId:id, contentType:type});
    if(res.pointsAwarded) {
      toast(`+${res.pointsAwarded} pts earned!`);
      CURRENT_USER.points = (CURRENT_USER.points||0)+res.pointsAwarded;
      g('hdr-pts').textContent = CURRENT_USER.points+' pts';
      if(!CURRENT_USER.progress) CURRENT_USER.progress={};
      if(type==='video') (CURRENT_USER.progress.videos=CURRENT_USER.progress.videos||[]).push(id);
      if(type==='article') (CURRENT_USER.progress.articles=CURRENT_USER.progress.articles||[]).push(id);
    }
  } catch(_){}
  // Open URL or video
  if(item.url) window.open(item.url, '_blank');
}
async function renderProg() {
  if(!CURRENT_USER) return;
  try {
    const res = await apiGet('me');
    CURRENT_USER = res.user;
  } catch(_){}
  const prog = CURRENT_USER.progress||{};
  const vDone = prog.videos||[];
  const aDone = prog.articles||[];
  const qDone = prog.quizzes||[];
  let html = '';
  CONTENT.videos.forEach(v=>{
    const done = vDone.includes(v.id);
    html += `<div class="prog-item"><div class="prog-icon">ğŸ¬</div><div class="prog-info"><div class="prog-label">${esc(v.title)}</div><div class="prog-status">${done?'+'+v.points+' pts earned':'Not started'}</div></div>${done?'<span class="chip chip-green">Done</span>':'<span class="chip chip-blue">Pending</span>'}</div>`;
  });
  CONTENT.articles.forEach(a=>{
    const done = aDone.includes(a.id);
    html += `<div class="prog-item"><div class="prog-icon">ğŸ“š</div><div class="prog-info"><div class="prog-label">${esc(a.title)}</div><div class="prog-status">${done?'+'+a.points+' pts earned':'Not started'}</div></div>${done?'<span class="chip chip-green">Done</span>':'<span class="chip chip-blue">Pending</span>'}</div>`;
  });
  CONTENT.quizzes.forEach(q=>{
    const done = qDone.includes(q.id);
    html += `<div class="prog-item"><div class="prog-icon">ğŸ§ </div><div class="prog-info"><div class="prog-label">${esc(q.title)}</div><div class="prog-status">${done?'+'+q.points+' pts earned':'Not taken'}</div></div>${done?'<span class="chip chip-green">Done</span>':'<span class="chip chip-blue">Pending</span>'}</div>`;
  });
  g('prog-list').innerHTML = html || '<div class="empty"><span class="empty-icon">ğŸ“Š</span><p>Start learning to track progress!</p></div>';
}
async function renderLB() {
  g('lb-body').innerHTML = '<div class="spinner"></div>';
  try {
    const res = await apiGet('leaderboard', {limit:50});
    const entries = res.entries||[];
    if(!entries.length){ g('lb-body').innerHTML='<div class="empty"><p>No data yet.</p></div>'; return; }
    let rows = entries.map((e,i)=>{
      const isMe = CURRENT_USER && e.userId===CURRENT_USER.id;
      const rankClass = i===0?'lb-rank-1':i===1?'lb-rank-2':i===2?'lb-rank-3':'lb-rank';
      const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
      const rankDisp = i<3 ? medals[i] : `#${i+1}`;
      return `<tr class="${isMe?'lb-me':''}"><td class="${rankClass}">${rankDisp}</td><td>${esc(e.name)}</td><td>${esc(e.institution||'â€”')}</td><td><strong>${e.points||0}</strong> pts</td><td>${e.completed||0}</td></tr>`;
    }).join('');
    g('lb-body').innerHTML = `<table class="lb-table"><thead><tr><th>Rank</th><th>Name</th><th>Institution</th><th>Points</th><th>Completed</th></tr></thead><tbody>${rows}</tbody></table>`;
  } catch(e){
    g('lb-body').innerHTML = `<div class="empty"><p>Could not load leaderboard: ${esc(e.message)}</p></div>`;
  }
}
async function renderCerts() {
  if(!CURRENT_USER) return;
  const cfg = CONTENT.settings||{};
  const certCfg = cfg.certificates||{br:100,si:300,go:500,pl:1000};
  const pts = CURRENT_USER.points||0;
  const tiers = [
    {id:'bronze',label:'Bronze',icon:'ğŸ¥‰',needed:certCfg.br||100},
    {id:'silver',label:'Silver',icon:'ğŸ¥ˆ',needed:certCfg.si||300},
    {id:'gold',  label:'Gold',  icon:'ğŸ¥‡',needed:certCfg.go||500},
    {id:'plat',  label:'Platinum',icon:'ğŸ’',needed:certCfg.pl||1000},
  ];
  g('cert-milestones').innerHTML = tiers.map(t=>{
    const earned = pts>=t.needed;
    return `<div class="cm ${earned?'cm-earned':'cm-locked'}" ${earned?`onclick="showCert('${t.id}')"`:''}><div class="cm-badge">${t.icon}</div><div class="cm-tier">${t.label}</div><div class="cm-pts">${t.needed} pts</div><span class="cm-status">${earned?'âœ“ Earned':'ğŸ”’ Locked'}</span></div>`;
  }).join('');
  const earnedTiers = tiers.filter(t=>pts>=t.needed);
  g('cert-list').innerHTML = earnedTiers.length
    ? earnedTiers.map(t=>`<div class="card" onclick="showCert('${t.id}')"><div class="card-thumb" style="background:linear-gradient(135deg,var(--navy),var(--navy-mid))">${t.icon}</div><div class="card-body"><div class="card-title">${t.label} Certificate</div><div class="card-meta">Click to view & download</div><div class="card-actions"><button class="btn btn-primary btn-sm">View</button></div></div></div>`).join('')
    : `<div class="empty"><span class="empty-icon">ğŸ“</span><p>Keep earning points to unlock certificates!</p></div>`;
}
function showCert(tier) {
  const u = CURRENT_USER;
  const cfg = CONTENT.settings||{};
  const certCfg = cfg.certificates||{};
  const tierMap = {bronze:{label:'Bronze Certificate',icon:'ğŸ¥‰'},silver:{label:'Silver Certificate',icon:'ğŸ¥ˆ'},gold:{label:'Gold Certificate',icon:'ğŸ¥‡'},plat:{label:'Platinum Certificate',icon:'ğŸ’'}};
  const t = tierMap[tier]||tierMap.bronze;
  g('cert-strip').className = `cert-strip ${tier}`;
  g('cert-uname').textContent = u.name;
  g('cert-tier-txt').textContent = `has earned the ${t.label}`;
  g('cert-pts-n').textContent = u.points;
  g('cert-org').textContent = certCfg.org||'Bridge4Change Foundation';
  g('cert-sn').textContent = certCfg.signatoryName||'Programme Director';
  g('cert-st').textContent = certCfg.signatoryTitle||'Bridge4Change Foundation';
  g('cert-issuer').textContent = certCfg.org||'Bridge4Change Foundation';
  g('cert-date').textContent = 'Issued: '+new Date().toLocaleDateString('en-IN',{year:'numeric',month:'long',day:'numeric'});
  g('cert-id').textContent = 'CRT-'+Math.random().toString(36).substr(2,8).toUpperCase();
  g('cert-ov').classList.remove('hidden');
}
function closeCertOv(){ g('cert-ov').classList.add('hidden'); }
function downloadCert(){
  html2canvas(g('cert-print'),{scale:2,useCORS:true}).then(canvas=>{
    const a=document.createElement('a');
    a.download=`B4C-Certificate-${(CURRENT_USER?.name||'student').replace(/\s/g,'-')}.png`;
    a.href=canvas.toDataURL();
    a.click();
  });
}
function renderAbout() {
  const cfg = CONTENT.settings||{};
  g('about-title').textContent = cfg.title||'Bridge4Change';
  g('about-tagline').textContent = cfg.tagline||'Empowering learners';
  g('about-text').textContent = cfg.about||'Bridge4Change Learning Portal connects learners with quality educational content.';
  g('about-contact').innerHTML = esc(cfg.contact||'');
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// QUIZ ENGINE
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function openQuiz(quizId) {
  const quiz = CONTENT.quizzes.find(q=>q.id===quizId);
  if(!quiz) return;
  const prog = CURRENT_USER?.progress||{};
  if((prog.quizzes||[]).includes(quizId) && !quiz.allowRetry){
    toast('You have already completed this quiz!');
    return;
  }
  QZ_STATE = {quiz, qIdx:0, answers:{}, shown:true, quizId};
  renderQuizQ();
  g('qov').classList.remove('hidden');
}
function closeQuiz(){ g('qov').classList.add('hidden'); QZ_STATE.shown=false; }
function renderQuizQ() {
  const {quiz, qIdx, answers} = QZ_STATE;
  const qs = quiz.questions||[];
  const total = qs.length;
  if(qIdx >= total){ renderQuizSubmit(); return; }
  const q = qs[qIdx];
  const pct = Math.round((qIdx/total)*100);
  const qTypeLabelMap = {mcq:'MCQ',multi:'Multi-Select',long:'Long Answer',tf:'True / False'};
  let optsHtml = '';
  if(q.type==='mcq'||q.type==='tf') {
    optsHtml = `<div class="q-opts">
      ${(q.options||[]).map((opt,i)=>`<button class="q-opt ${(answers[q.id]||[]).includes(i)?'sel':''}" onclick="selectOpt(${i})">${esc(opt)}</button>`).join('')}
    </div>`;
  } else if(q.type==='multi') {
    optsHtml = `<div class="multi-note">Select all that apply.</div>
    <div class="q-opts">
      ${(q.options||[]).map((opt,i)=>`<button class="q-opt ${(answers[q.id]||[]).includes(i)?'sel':''}" onclick="selectMultiOpt(${i})">${esc(opt)}</button>`).join('')}
    </div>`;
  } else {
    optsHtml = `<div class="multi-note">Write your answer below.</div>
    <textarea class="long-ans" placeholder="Your answerâ€¦" onchange="answers['${esc(q.id||qIdx)}']=[this.value]">${(answers[q.id]||[''])[0]}</textarea>`;
  }
  g('qm-body').innerHTML = `
    <div class="quiz-modal-hdr">
      <div style="display:flex;align-items:center;gap:.5rem">
        <div class="q-num-badge">${qIdx+1}</div>
        <h3>${esc(quiz.title)}</h3>
      </div>
      <button class="quiz-close" onclick="closeQuiz()">âœ•</button>
    </div>
    <div class="q-info-row"><span>${qIdx+1} of ${total}</span><span class="${q.type?'q-type-badge qt-'+q.type:''}">${qTypeLabelMap[q.type]||q.type}</span></div>
    <div class="q-prog-bar"><div class="q-prog-fill" style="width:${pct}%"></div></div>
    <div class="q-text">${esc(q.text||q.question||'')}</div>
    ${optsHtml}
    <div class="q-nav">
      ${qIdx>0?`<button class="btn btn-secondary btn-sm" onclick="prevQ()">â† Back</button>`:''}
      <button class="btn btn-primary btn-sm" onclick="nextQ()">${qIdx<total-1?'Next â†’':'Review & Submit'}</button>
    </div>`;
}
function selectOpt(i) {
  const q = QZ_STATE.quiz.questions[QZ_STATE.qIdx];
  QZ_STATE.answers[q.id||QZ_STATE.qIdx] = [i];
  document.querySelectorAll('.q-opt').forEach((b,j)=>{b.classList.toggle('sel',j===i)});
}
function selectMultiOpt(i) {
  const q = QZ_STATE.quiz.questions[QZ_STATE.qIdx];
  const key = q.id||QZ_STATE.qIdx;
  if(!QZ_STATE.answers[key]) QZ_STATE.answers[key]=[];
  const idx = QZ_STATE.answers[key].indexOf(i);
  if(idx>=0) QZ_STATE.answers[key].splice(idx,1);
  else QZ_STATE.answers[key].push(i);
  document.querySelectorAll('.q-opt').forEach((b,j)=>{b.classList.toggle('sel',QZ_STATE.answers[key].includes(j))});
}
function nextQ(){ QZ_STATE.qIdx++; renderQuizQ(); }
function prevQ(){ if(QZ_STATE.qIdx>0){QZ_STATE.qIdx--;renderQuizQ();} }
function renderQuizSubmit() {
  g('qm-body').innerHTML = `
    <div class="quiz-modal-hdr">
      <h3>ğŸ“ Ready to Submit: ${esc(QZ_STATE.quiz.title)}</h3>
      <button class="quiz-close" onclick="closeQuiz()">âœ•</button>
    </div>
    <p style="color:var(--muted);font-size:.875rem;margin-bottom:1.2rem">You've answered all questions. Submit now for server-side evaluation.</p>
    <div class="q-nav">
      <button class="btn btn-secondary btn-sm" onclick="prevQ()">â† Review</button>
      <button class="btn btn-primary" onclick="submitQuiz()">Submit Quiz âœ“</button>
    </div>`;
}
async function submitQuiz() {
  const btn = g('qm-body').querySelector('.btn-primary');
  if(btn){ btn.disabled=true; btn.textContent='Evaluatingâ€¦'; }
  try {
    const res = await apiCall('submitQuiz', {
      quizId: QZ_STATE.quizId||QZ_STATE.quiz.id,
      answers: QZ_STATE.answers
    });
    // Update local progress
    if(!CURRENT_USER.progress) CURRENT_USER.progress={};
    if(!(CURRENT_USER.progress.quizzes||[]).includes(QZ_STATE.quizId))
      (CURRENT_USER.progress.quizzes=CURRENT_USER.progress.quizzes||[]).push(QZ_STATE.quizId);
    CURRENT_USER.points = res.totalPoints||CURRENT_USER.points;
    g('hdr-pts').textContent = CURRENT_USER.points+' pts';
    renderQuizResult(res);
  } catch(e) {
    toast('Could not submit quiz: '+e.message, 'err');
    if(btn){btn.disabled=false;btn.textContent='Submit Quiz âœ“';}
  }
}
function renderQuizResult(res) {
  const pct = Math.round(((res.score||0)/(res.total||1))*100);
  const grade = pct>=90?'ğŸŒŸ Excellent!':pct>=70?'ğŸ‘ Good Job!':pct>=50?'ğŸ“š Keep Studying':'ğŸ’ª Keep Trying!';
  g('qm-body').innerHTML = `
    <div class="quiz-modal-hdr">
      <h3>Results: ${esc(QZ_STATE.quiz.title)}</h3>
      <button class="quiz-close" onclick="closeQuiz()">âœ•</button>
    </div>
    <div class="q-score-box">
      <div class="q-score-big">${res.score||0}/${res.total||0}</div>
      <div class="q-score-grade">${grade}</div>
      <div style="color:var(--muted);font-size:.875rem;margin:.5rem 0">You scored ${pct}% correct</div>
      ${res.pointsAwarded?`<span class="q-score-pts">+${res.pointsAwarded} pts awarded!</span>`:''}
    </div>
    <div style="margin-top:1rem">
      ${(res.breakdown||[]).map((q,i)=>`
        <div style="padding:.6rem;border-bottom:1px solid var(--border)">
          <div style="font-size:.8rem;font-weight:700;margin-bottom:.2rem">Q${i+1}: ${esc(q.question)}</div>
          <span class="chip ${q.correct?'chip-green':'chip-red'}">${q.correct?'âœ“ Correct':'âœ— Incorrect'}</span>
          ${!q.correct&&q.explanation?`<div style="font-size:.75rem;color:var(--muted);margin-top:.2rem">${esc(q.explanation)}</div>`:''}
        </div>`).join('')}
    </div>
    <div class="q-nav" style="margin-top:1rem">
      <button class="btn btn-primary" onclick="closeQuiz()">Done</button>
    </div>`;
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADMIN FUNCTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAdmStats() {
  try {
    const res = await apiGet('adminStats');
    if(g('adm-stat-users'))  g('adm-stat-users').textContent  = res.users||0;
    if(g('adm-stat-vids'))   g('adm-stat-vids').textContent   = res.videos||0;
    if(g('adm-stat-arts'))   g('adm-stat-arts').textContent   = res.articles||0;
    if(g('adm-stat-qzs'))    g('adm-stat-qzs').textContent    = res.quizzes||0;
  } catch(_){}
}
async function checkBackendStatus() {
  const el = g('backend-status-info');
  if(!el) return;
  const url = getApiUrl();
  if(!url){
    el.innerHTML = '<div class="alert alert-info">âš ï¸ No API URL set. Paste your Apps Script URL below.</div>';
    return;
  }
  el.innerHTML = '<div class="alert alert-info">ğŸ”„ Testing connectionâ€¦</div>';
  try {
    const res = await apiGet('ping');
    el.innerHTML = `<div class="alert alert-ok">âœ… Backend connected! Sheet: ${esc(res.sheet||'OK')} Â· Uptime: OK</div>`;
  } catch(e) {
    el.innerHTML = `<div class="alert alert-err">âŒ Cannot reach backend: ${esc(e.message)}</div>`;
  }
}
function saveApiUrl(){
  const url = g('adm-api-url').value.trim();
  if(!url){ toast('Enter the Apps Script URL first.','err'); return; }
  localStorage.setItem(LS_API, url);
  toast('API URL saved!');
  checkBackendStatus();
}
async function loadAdmUsers() {
  g('adm-users-loading').style.display='block';
  g('adm-user-table').style.display='none';
  try {
    const res = await apiGet('adminUsers');
    const users = res.users||[];
    g('adm-user-tbody').innerHTML = users.map(u=>`
      <tr>
        <td>${esc(u.name)}</td>
        <td>${esc(u.email)}</td>
        <td>${esc(u.institution||'â€”')}</td>
        <td>${esc(u.cohort||'â€”')}</td>
        <td><strong>${u.points||0}</strong></td>
        <td>${esc(u.createdAt||'â€”')}</td>
        <td><div class="tacts"><button class="btn btn-danger btn-sm" onclick="deleteUser('${esc(u.id)}')">Remove</button></div></td>
      </tr>`).join('') || '<tr><td colspan="7" style="text-align:center;color:var(--muted)">No users yet.</td></tr>';
    g('adm-users-loading').style.display='none';
    g('adm-user-table').style.display='table';
  } catch(e){
    g('adm-users-loading').innerHTML = `<div class="alert alert-err">Error: ${esc(e.message)}</div>`;
  }
}
function deleteUser(id){ openCo('Remove User','Remove this user and all their data?',async()=>{ try{await apiCall('adminDeleteUser',{userId:id});loadAdmUsers();toast('User removed.');}catch(e){toast(e.message,'err');} }); }

async function loadAdmVids() {
  try {
    const res = await apiGet('content');
    CONTENT.videos = res.videos||[];
  } catch(_){}
  const vids = CONTENT.videos;
  g('vf-tb').innerHTML = vids.length ? vids.map(v=>`
    <tr>
      <td>${esc(v.title)}</td>
      <td>${esc(v.category||'â€”')}</td>
      <td>${esc(v.duration||'â€”')}</td>
      <td>${v.points||0}</td>
      <td>${v.active!==false?'<span class="chip chip-green">Active</span>':'<span class="chip chip-red">Hidden</span>'}</td>
      <td><div class="tacts">
        <button class="btn btn-secondary btn-sm" onclick="editVid('${esc(v.id)}')">âœï¸</button>
        <button class="btn btn-danger btn-sm" onclick="deleteVid('${esc(v.id)}')">âœ•</button>
      </div></td>
    </tr>`).join('')
  : '<tr><td colspan="6" style="text-align:center;color:var(--muted)">No videos yet.</td></tr>';
}
function editVid(id){ const v=CONTENT.videos.find(x=>x.id===id);if(!v)return; g('vf-id').value=v.id;g('vf-nm').value=v.title;g('vf-tag').value=v.category||'';g('vf-url').value=v.url||'';g('vf-dur').value=v.duration||'';g('vf-pts').value=v.points||5;g('vf-desc').value=v.description||'';g('vf-active').checked=v.active!==false;g('vf-title').textContent='âœï¸ Edit Video';g('vid-form-card').scrollIntoView({behavior:'smooth'}); }
async function saveVideo(){
  const id=g('vf-id').value;const title=g('vf-nm').value.trim();const url=g('vf-url').value.trim();
  if(!title||!url){toast('Title and URL required.','err');return;}
  try{
    await apiCall('adminSaveContent',{type:'video',id:id||null,title,category:g('vf-tag').value.trim(),url,duration:g('vf-dur').value.trim(),points:parseInt(g('vf-pts').value)||5,description:g('vf-desc').value.trim(),active:g('vf-active').checked});
    toast('Video saved!');clrVid();loadAdmVids();
  }catch(e){toast(e.message,'err');}
}
function deleteVid(id){openCo('Delete Video','Remove this video?',async()=>{try{await apiCall('adminDeleteContent',{type:'video',id});CONTENT.videos=CONTENT.videos.filter(v=>v.id!==id);loadAdmVids();toast('Deleted.');}catch(e){toast(e.message,'err');}});}
function clrVid(){g('vf-id').value='';g('vf-nm').value='';g('vf-tag').value='';g('vf-url').value='';g('vf-dur').value='';g('vf-pts').value='5';g('vf-desc').value='';g('vf-active').checked=true;g('vf-title').textContent='â• Add New Video';}

async function loadAdmArts() {
  try{ const res=await apiGet('content');CONTENT.articles=res.articles||[];}catch(_){}
  g('af-tb').innerHTML = CONTENT.articles.length ? CONTENT.articles.map(a=>`
    <tr>
      <td>${esc(a.title)}</td>
      <td>${esc(a.category||'â€”')}</td>
      <td>${esc(a.readTime||'â€”')}</td>
      <td>${a.points||0}</td>
      <td>${a.active!==false?'<span class="chip chip-green">Active</span>':'<span class="chip chip-red">Hidden</span>'}</td>
      <td><div class="tacts">
        <button class="btn btn-secondary btn-sm" onclick="editArt('${esc(a.id)}')">âœï¸</button>
        <button class="btn btn-danger btn-sm" onclick="deleteArt('${esc(a.id)}')">âœ•</button>
      </div></td>
    </tr>`).join('')
  : '<tr><td colspan="6" style="text-align:center;color:var(--muted)">No articles yet.</td></tr>';
}
function editArt(id){const a=CONTENT.articles.find(x=>x.id===id);if(!a)return;g('af-id').value=a.id;g('af-nm').value=a.title;g('af-tag').value=a.category||'';g('af-url').value=a.url||'';g('af-dur').value=a.readTime||'';g('af-pts').value=a.points||3;g('af-desc').value=a.description||'';g('af-active').checked=a.active!==false;g('af-title').textContent='âœï¸ Edit Article';}
async function saveArticle(){
  const id=g('af-id').value;const title=g('af-nm').value.trim();const url=g('af-url').value.trim();
  if(!title||!url){toast('Title and URL required.','err');return;}
  try{
    await apiCall('adminSaveContent',{type:'article',id:id||null,title,category:g('af-tag').value.trim(),url,readTime:g('af-dur').value.trim(),points:parseInt(g('af-pts').value)||3,description:g('af-desc').value.trim(),active:g('af-active').checked});
    toast('Article saved!');clrArt();loadAdmArts();
  }catch(e){toast(e.message,'err');}
}
function deleteArt(id){openCo('Delete Article','Remove this article?',async()=>{try{await apiCall('adminDeleteContent',{type:'article',id});CONTENT.articles=CONTENT.articles.filter(a=>a.id!==id);loadAdmArts();toast('Deleted.');}catch(e){toast(e.message,'err');}});}
function clrArt(){g('af-id').value='';g('af-nm').value='';g('af-tag').value='';g('af-url').value='';g('af-dur').value='';g('af-pts').value='3';g('af-desc').value='';g('af-active').checked=true;g('af-title').textContent='â• Add New Article';}

// QUIZ ADMIN
let qCnt=0;
async function loadAdmQzs() {
  try{ const res=await apiGet('content');CONTENT.quizzes=res.quizzes||[];}catch(_){}
  g('qf-tb').innerHTML = CONTENT.quizzes.length ? CONTENT.quizzes.map(q=>`
    <tr>
      <td>${esc(q.title)}</td>
      <td>${esc(q.linkedTo||'Standalone')}</td>
      <td>${(q.questions||[]).length}</td>
      <td>${q.points||0}</td>
      <td>${q.allowRetry?'<span class="chip chip-green">Yes</span>':'<span class="chip chip-red">No</span>'}</td>
      <td>${q.active!==false?'<span class="chip chip-green">Active</span>':'<span class="chip chip-red">Hidden</span>'}</td>
      <td><div class="tacts">
        <button class="btn btn-secondary btn-sm" onclick="editQuiz('${esc(q.id)}')">âœï¸</button>
        <button class="btn btn-danger btn-sm" onclick="deleteQuiz('${esc(q.id)}')">âœ•</button>
      </div></td>
    </tr>`).join('')
  : '<tr><td colspan="7" style="text-align:center;color:var(--muted)">No quizzes yet.</td></tr>';
}
function refDrop() {
  const ct = g('qf-ct')?.value;
  const ci = g('qf-ci');
  if(!ci) return;
  if(ct==='video') ci.innerHTML = CONTENT.videos.map(v=>`<option value="${esc(v.id)}">${esc(v.title)}</option>`).join('')||'<option>No videos</option>';
  else if(ct==='article') ci.innerHTML = CONTENT.articles.map(a=>`<option value="${esc(a.id)}">${esc(a.title)}</option>`).join('')||'<option>No articles</option>';
  else ci.innerHTML = '<option value="">â€” None â€”</option>';
}
if(g('qf-ct')) g('qf-ct').addEventListener('change',refDrop);
function addQ(type, btn) {
  document.querySelectorAll('.itab').forEach(b=>b.classList.remove('on')); btn.classList.add('on');
  qCnt++;
  const qId = 'qq-'+qCnt;
  let extra = '';
  if(type==='mcq'||type==='tf') {
    const opts = type==='tf' ? ['True','False'] : ['Option A','Option B','Option C','Option D'];
    extra = opts.map((o,i)=>`
      <div class="fg" style="display:flex;align-items:center;gap:.5rem;margin-bottom:.4rem">
        <input type="radio" name="${qId}-ans" value="${i}" style="width:auto;margin:0;flex-shrink:0">
        <input type="text" placeholder="${o}" id="${qId}-o${i}" style="flex:1" value="${type==='tf'?o:''}">
      </div>`).join('');
    extra += '<p style="font-size:.72rem;color:var(--muted);margin-top:.3rem">â˜ Select the correct answer</p>';
  } else if(type==='multi') {
    extra = [0,1,2,3].map(i=>`
      <div class="fg" style="display:flex;align-items:center;gap:.5rem;margin-bottom:.4rem">
        <input type="checkbox" id="${qId}-c${i}" style="width:auto;margin:0;flex-shrink:0">
        <input type="text" placeholder="Option ${String.fromCharCode(65+i)}" id="${qId}-o${i}" style="flex:1">
      </div>`).join('');
    extra += '<p style="font-size:.72rem;color:var(--muted)">â˜ Tick all correct answers</p>';
  } else {
    extra = '<p style="font-size:.75rem;color:var(--muted);padding:.5rem;background:var(--snow);border-radius:6px">Manually reviewed by admin. Award points if answered.</p>';
  }
  const div = document.createElement('div');
  div.className='adm-card'; div.style.cssText='background:var(--snow);box-shadow:none;border:1.5px solid var(--border);margin-bottom:.8rem';
  div.id=qId;
  div.dataset.type=type;
  div.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.75rem">
      <strong style="font-size:.82rem">Question ${qCnt} Â· <span class="q-type-badge qt-${type}">${type.toUpperCase()}</span></strong>
      <button class="btn btn-danger btn-sm" onclick="this.closest('.adm-card').remove();qCnt--">Remove</button>
    </div>
    <div class="fg"><label>Question Text</label><input id="${qId}-txt" placeholder="Enter questionâ€¦" maxlength="300"></div>
    <div class="fg"><label>Explanation (shown after answer)</label><input id="${qId}-exp" placeholder="Optional explanationâ€¦" maxlength="200"></div>
    ${extra}`;
  const hint = g('qf-qw').querySelector('p');
  if(hint) hint.remove();
  g('qf-qw').appendChild(div);
}
function gatherQuestions() {
  const qs = [];
  g('qf-qw').querySelectorAll('.adm-card[id^="qq-"]').forEach(div=>{
    const qId = div.id;
    const type = div.dataset.type;
    const text = g(qId+'-txt')?.value?.trim()||'';
    const explanation = g(qId+'-exp')?.value?.trim()||'';
    let options=[], correctAnswers=[];
    if(type==='mcq'||type==='tf'){
      for(let i=0;i<4;i++){ const el=g(qId+'-o'+i);if(el)options.push(el.value||'Option '+(i+1)); }
      const sel=div.querySelector(`input[name="${qId}-ans"]:checked`);
      if(sel) correctAnswers=[parseInt(sel.value)];
    } else if(type==='multi'){
      for(let i=0;i<4;i++){ const el=g(qId+'-o'+i);if(el)options.push(el.value||'Option '+(i+1)); }
      for(let i=0;i<4;i++){ const cb=g(qId+'-c'+i);if(cb?.checked)correctAnswers.push(i); }
    }
    if(text) qs.push({id:qId,type,text,options,correctAnswers,explanation});
  });
  return qs;
}
async function saveQuiz(){
  const id=g('qf-id').value;const title=g('qf-nm').value.trim();
  if(!title){toast('Quiz title required.','err');return;}
  const qs=gatherQuestions();
  if(!qs.length){toast('Add at least one question.','err');return;}
  try{
    await apiCall('adminSaveContent',{type:'quiz',id:id||null,title,points:parseInt(g('qf-pt').value)||10,linkedType:g('qf-ct').value,linkedId:g('qf-ci').value,allowRetry:g('qf-re').checked,active:g('qf-active').checked,questions:qs});
    toast('Quiz saved!');clrQz();loadAdmQzs();
  }catch(e){toast(e.message,'err');}
}
function editQuiz(id){ const q=CONTENT.quizzes.find(x=>x.id===id);if(!q)return;g('qf-id').value=q.id;g('qf-nm').value=q.title;g('qf-pt').value=q.points||10;g('qf-re').checked=q.allowRetry||false;g('qf-active').checked=q.active!==false;g('qf-t').textContent='âœï¸ Edit Quiz';toast('Quiz loaded. Edit and save.',); }
function deleteQuiz(id){openCo('Delete Quiz','Remove this quiz?',async()=>{try{await apiCall('adminDeleteContent',{type:'quiz',id});loadAdmQzs();toast('Deleted.');}catch(e){toast(e.message,'err');}});}
function clrQz(){g('qf-id').value='';g('qf-nm').value='';g('qf-pt').value='10';g('qf-re').checked=false;g('qf-active').checked=true;g('qf-qw').innerHTML='<p style="color:var(--muted);font-size:.85rem">Click a button above to add a question.</p>';g('qf-t').textContent='â• Create New Quiz';qCnt=0;}

// PORTAL SETTINGS ADMIN
async function loadPortalInfoForm(){
  try{const res=await apiGet('settings');const s=res.settings||{};g('pi-title').value=s.title||'';g('pi-tagline').value=s.tagline||'';g('pi-about').value=s.about||'';g('pi-contact').value=s.contact||'';g('pi-stat-learners').value=s.stat_learners||500;g('pi-stat-vids').value=s.stat_videos||30;g('pi-stat-arts').value=s.stat_articles||50;}catch(_){}}
async function savePortalInfo(){
  try{
    await apiCall('adminSaveSettings',{title:g('pi-title').value,tagline:g('pi-tagline').value,about:g('pi-about').value,contact:g('pi-contact').value});
    toast('Portal info saved!');
  }catch(e){toast(e.message,'err');}
}
async function savePortalStats(){
  try{
    await apiCall('adminSaveSettings',{stat_learners:g('pi-stat-learners').value,stat_videos:g('pi-stat-vids').value,stat_articles:g('pi-stat-arts').value});
    toast('Stats saved!');
  }catch(e){toast(e.message,'err');}
}
async function loadCertCfgForm(){
  try{const res=await apiGet('settings');const c=(res.settings||{}).certificates||{};g('cert-br').value=c.br||100;g('cert-si').value=c.si||300;g('cert-go').value=c.go||500;g('cert-pl').value=c.pl||1000;g('cert-org').value=c.org||'Bridge4Change Foundation';g('cert-sn').value=c.signatoryName||'';g('cert-st').value=c.signatoryTitle||'';}catch(_){}}
async function saveCertCfg(){
  try{
    await apiCall('adminSaveSettings',{certificates:{br:parseInt(g('cert-br').value)||100,si:parseInt(g('cert-si').value)||300,go:parseInt(g('cert-go').value)||500,pl:parseInt(g('cert-pl').value)||1000,org:g('cert-org').value,signatoryName:g('cert-sn').value,signatoryTitle:g('cert-st').value}});
    toast('Certificate settings saved!');
  }catch(e){toast(e.message,'err');}
}
async function changeAdmPass(){
  const np=g('st-np').value.trim(),cp=g('st-cp').value.trim();
  if(!np){toast('Enter new password.','err');return;}
  if(np!==cp){toast('Passwords do not match.','err');return;}
  if(np.length<6){toast('Min 6 characters.','err');return;}
  try{await apiCall('adminChangePassword',{newPassword:np});g('st-np').value='';g('st-cp').value='';toast('Password updated!');}catch(e){toast(e.message,'err');}
}
function exportAllData(){
  const d={videos:CONTENT.videos,articles:CONTENT.articles,quizzes:CONTENT.quizzes,exportedAt:new Date().toISOString()};
  const a=document.createElement('a');a.href='data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(d,null,2));a.download='b4c-backup-'+new Date().toISOString().split('T')[0]+'.json';a.click();
}
function confirmResetLocal(){openCo('Clear Local Session','This clears your session token. You will be logged out.',()=>{localStorage.removeItem(LS_TOKEN);localStorage.removeItem(LS_USER);location.reload();});}

// CONFIRM OVERLAY
let coCb=null;
function openCo(t,m,cb){g('co-t').textContent=t;g('co-m').textContent=m;coCb=cb;g('cov').classList.remove('hidden');}
function closeCo(){g('cov').classList.add('hidden');coCb=null;}
g('co-ok').onclick=function(){if(coCb)coCb();closeCo();};

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// KEYBOARD SHORTCUTS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.addEventListener('keydown', e=>{
  if(e.key==='Escape'){ g('qov').classList.add('hidden'); g('cert-ov').classList.add('hidden'); closeCo(); }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async function init(){
  // Check for existing session
  const token = localStorage.getItem(LS_TOKEN);
  const cachedUser = localStorage.getItem(LS_USER);
  if(token && cachedUser) {
    try {
      const user = JSON.parse(cachedUser);
      // Verify token with backend
      const apiUrl = getApiUrl();
      if(apiUrl) {
        const res = await apiGet('me');
        await enterPortal(res.user);
        showLoader(false);
        return;
      } else {
        // No API URL - show setup screen
        showLoader(false);
        renderWelcomePage();
        showPg('pg-welcome');
        return;
      }
    } catch(_) {
      localStorage.removeItem(LS_TOKEN);
      localStorage.removeItem(LS_USER);
    }
  }
  // Load public settings before showing welcome
  const apiUrl = getApiUrl();
  if(apiUrl) {
    try {
      const res = await apiGet('settings');
      CONTENT.settings = res.settings||{};
    } catch(_){}
  }
  showLoader(false);
  renderWelcomePage();
  showPg('pg-welcome');
})();
</script>
</body>
</html>
