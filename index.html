<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bridge4Change Learning Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
/* â”€â”€ RESET & BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --green:#1B4332;--green-mid:#2D6A4F;--green-light:#40916C;
  --gold:#F0A500;--gold-light:#FFD166;
  --bg:#F7F5F0;--white:#FFFFFF;
  --text:#1a2a1e;--muted:#5a7464;--border:#d8e4da;
  --red:#dc2626;--ok:#16a34a;
  --shadow:0 4px 24px rgba(27,67,50,.10);
  --shadow-lg:0 8px 40px rgba(27,67,50,.16);
  --r:14px;
}
html{font-family:'Lato',sans-serif;font-size:16px;color:var(--text);background:var(--bg)}
body{min-height:100vh}
input,textarea,select,button{font-family:inherit;font-size:1rem}
input,textarea,select{width:100%;padding:.7rem 1rem;border:1.5px solid var(--border);border-radius:10px;background:#fff;outline:none;transition:.2s}
input:focus,textarea:focus,select:focus{border-color:var(--green-light);box-shadow:0 0 0 3px rgba(64,145,108,.15)}
label{display:block;font-size:.82rem;font-weight:700;color:var(--muted);margin-bottom:.3rem;text-transform:uppercase;letter-spacing:.05em}
.fg{margin-bottom:1rem}
button{cursor:pointer;border:none;border-radius:10px;font-weight:700;transition:.2s}
.btn{padding:.65rem 1.4rem;font-size:.9rem}
.btn.bp{background:linear-gradient(135deg,var(--green),var(--green-mid));color:#fff}
.btn.bp:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(27,67,50,.3)}
.btn.bg_{background:transparent;border:1.5px solid var(--border);color:var(--green)}
.btn.bg_:hover{border-color:var(--green-light);background:rgba(27,67,50,.04)}
.btn.bd{background:transparent;border:1.5px solid #fca5a5;color:var(--red)}
.btn.bd:hover{background:#fef2f2}
.btn.sm{padding:.4rem .9rem;font-size:.8rem}
.btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
h1,h2,h3,h4{font-family:'Playfair Display',serif;line-height:1.2}
a{color:var(--green-light);text-decoration:none}
.hidden{display:none!important}
.alert{padding:.7rem 1rem;border-radius:8px;font-size:.88rem;margin:.5rem 0}
.alert.err{background:#fef2f2;color:#b91c1c;border:1px solid #fca5a5}
.alert.ok{background:#f0fdf4;color:#15803d;border:1px solid #86efac}
.alert.info{background:#eff6ff;color:#1d4ed8;border:1px solid #93c5fd}
.chip{display:inline-block;padding:.2rem .6rem;border-radius:20px;font-size:.72rem;font-weight:700}
.chip.cg{background:#dcfce7;color:#166534}
.chip.cr{background:#fef2f2;color:#b91c1c}
.chip.cb_{background:#eff6ff;color:#1d4ed8}
.spinner{width:28px;height:28px;border:3px solid var(--border);border-top-color:var(--green);border-radius:50%;animation:spin .7s linear infinite;margin:2rem auto}
@keyframes spin{to{transform:rotate(360deg)}}
.empty{text-align:center;padding:3rem 1rem;color:var(--muted)}
.empty .ei{font-size:2.5rem;margin-bottom:.7rem}
.toast{position:fixed;bottom:1.4rem;left:50%;transform:translateX(-50%);background:var(--green);color:#fff;padding:.7rem 1.4rem;border-radius:40px;font-weight:700;font-size:.9rem;z-index:4000;animation:toastIn .3s ease,toastOut .3s ease 2.5s forwards;white-space:nowrap;box-shadow:var(--shadow-lg)}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(12px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes toastOut{to{opacity:0;transform:translateX(-50%) translateY(10px)}}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#hdr{position:sticky;top:0;z-index:200;background:var(--green);color:#fff;display:flex;align-items:center;gap:.8rem;padding:.75rem 1.4rem;box-shadow:0 2px 12px rgba(0,0,0,.18)}
#hdr-logo{height:36px;width:36px;border-radius:50%;object-fit:cover;background:#fff;flex-shrink:0}
#hdr-title{font-family:'Playfair Display',serif;font-size:1.05rem;font-weight:700;color:#fff;flex:1;line-height:1.2}
#hdr-title small{display:block;font-family:'Lato',sans-serif;font-size:.72rem;font-weight:400;opacity:.75}
#hdr-r{display:flex;align-items:center;gap:.6rem}
#hdr-r.show{display:flex}
#hdr-av{width:34px;height:34px;border-radius:50%;background:var(--gold);color:var(--green);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:1rem;flex-shrink:0}
#hdr-nm{font-size:.82rem;font-weight:700;max-width:100px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:#fff}
#hdr-pts{background:rgba(255,255,255,.18);border-radius:20px;padding:.2rem .7rem;font-size:.78rem;font-weight:700;color:var(--gold-light)}
#hdr-out{background:transparent;border:1px solid rgba(255,255,255,.3);color:#fff;padding:.3rem .8rem;font-size:.78rem;border-radius:8px}
#hdr-out:hover{background:rgba(255,255,255,.12)}

/* â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#nav{display:flex;background:#fff;border-bottom:1px solid var(--border);overflow-x:auto;-webkit-overflow-scrolling:touch;position:sticky;top:62px;z-index:190;scrollbar-width:none}
#nav::-webkit-scrollbar{display:none}
.nav-i{flex-shrink:0;padding:.7rem 1rem;font-size:.82rem;font-weight:700;color:var(--muted);border-bottom:3px solid transparent;cursor:pointer;white-space:nowrap;transition:.2s;background:none;border-left:none;border-right:none;border-top:none}
.nav-i:hover{color:var(--green)}
.nav-i.on{color:var(--green);border-bottom-color:var(--gold)}

/* â”€â”€ PAGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pg{display:none}
.pg.on{display:block}
.pw{max-width:960px;margin:0 auto;padding:1.4rem}

/* â”€â”€ WELCOME / ONBOARDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#pg-welcome{min-height:calc(100vh - 62px);display:flex;align-items:center;justify-content:center;background:linear-gradient(160deg,#f0f7f3 0%,var(--bg) 100%)}
.wc-card{background:#fff;border-radius:22px;box-shadow:var(--shadow-lg);padding:2.5rem 2rem;max-width:420px;width:100%;margin:1rem}
.wc-logo{display:block;margin:0 auto 1.2rem;height:64px;width:64px;border-radius:50%;object-fit:cover}
.wc-title{font-family:'Playfair Display',serif;font-size:1.7rem;color:var(--green);text-align:center;margin-bottom:.3rem}
.wc-sub{text-align:center;color:var(--muted);font-size:.9rem;margin-bottom:1.8rem;line-height:1.5}
.wc-card .btn{width:100%;font-size:1rem;padding:.85rem}

/* â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dash-hero{background:linear-gradient(135deg,var(--green) 0%,var(--green-mid) 100%);border-radius:var(--r);padding:1.6rem;color:#fff;margin-bottom:1.2rem;position:relative;overflow:hidden}
.dash-hero::after{content:'';position:absolute;right:-30px;top:-30px;width:160px;height:160px;background:rgba(255,255,255,.06);border-radius:50%}
.dash-hero h2{font-size:1.4rem;margin-bottom:.3rem}
.dash-hero p{opacity:.8;font-size:.9rem}
.dash-hero .pts-big{font-size:2rem;font-weight:900;color:var(--gold-light);margin-top:.5rem}
.stat-row{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;margin-bottom:1.2rem}
.stat-card{background:#fff;border-radius:var(--r);padding:1rem;text-align:center;box-shadow:var(--shadow)}
.stat-card .sv{font-size:1.6rem;font-weight:900;color:var(--green);font-family:'Playfair Display',serif}
.stat-card .sl{font-size:.72rem;color:var(--muted);font-weight:700;text-transform:uppercase;letter-spacing:.04em}
.prog-bar{background:var(--border);border-radius:8px;height:10px;overflow:hidden;margin:.5rem 0}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--green-light),var(--gold));border-radius:8px;transition:width .6s ease}
.section-title{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--green);margin-bottom:.8rem;padding-bottom:.4rem;border-bottom:2px solid var(--border)}

/* â”€â”€ VIDEO / ARTICLE CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.card{background:#fff;border-radius:var(--r);box-shadow:var(--shadow);overflow:hidden;transition:.2s}
.card:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}
.card-thumb{height:130px;background:linear-gradient(135deg,var(--green),var(--green-light));display:flex;align-items:center;justify-content:center;font-size:2.5rem;position:relative}
.card-thumb .card-done{position:absolute;top:.5rem;right:.5rem;background:var(--gold);color:var(--green);width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:900}
.card-body{padding:1rem}
.card-body h4{font-size:.95rem;margin-bottom:.3rem;line-height:1.3}
.card-body .card-meta{font-size:.75rem;color:var(--muted);margin-bottom:.7rem}
.card-body .card-acts{display:flex;gap:.5rem;flex-wrap:wrap}
.card-tag{background:#e8f5e9;color:var(--green);font-size:.7rem;font-weight:700;padding:.15rem .5rem;border-radius:20px;display:inline-block;margin-bottom:.4rem}

/* â”€â”€ QUIZ OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#qov{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:500;display:flex;align-items:center;justify-content:center;padding:1rem}
#qov.hidden{display:none!important}
.qm{background:#fff;border-radius:18px;max-width:600px;width:100%;max-height:90vh;overflow-y:auto;padding:1.5rem}
.qm-hdr{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;gap:.5rem}
.qm-hdr h3{font-size:1rem}
.qm-close{background:none;border:1px solid var(--border);color:var(--muted);width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:1.1rem;cursor:pointer}
.qnum{width:28px;height:28px;background:var(--green);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.72rem;font-weight:900;flex-shrink:0}
.qtype-badge{font-size:.68rem;padding:.18rem .5rem;border-radius:20px;font-weight:700}
.qt-mcq{background:#dcfce7;color:#166534}
.qt-multi{background:#fff7ed;color:#c2410c}
.qt-long{background:#eff6ff;color:#1d4ed8}
.qt-tf{background:#fdf4ff;color:#7e22ce}
.qtxt{font-size:1rem;font-weight:700;line-height:1.5;margin-bottom:1rem;padding:.8rem;background:var(--bg);border-radius:10px}
.qopts{display:flex;flex-direction:column;gap:.5rem}
.qopt{background:#fff;border:2px solid var(--border);border-radius:10px;padding:.75rem 1rem;text-align:left;font-size:.9rem;cursor:pointer;transition:.15s}
.qopt:hover{border-color:var(--green-light);background:#f0f7f3}
.qopt.sel{border-color:var(--green);background:#e8f5e9}
.qopt.cor{border-color:var(--ok);background:#dcfce7!important;font-weight:700}
.qopt.wrong{border-color:var(--red);background:#fef2f2!important}
.long-ans{width:100%;min-height:100px;border:2px solid var(--border);border-radius:10px;padding:.8rem;resize:vertical;font-size:.9rem}
.long-note,.multi-note{font-size:.82rem;color:var(--muted);padding:.6rem .8rem;background:var(--bg);border-radius:8px;margin-bottom:.7rem}
.qfb{padding:.8rem 1rem;border-radius:10px;font-weight:700;font-size:.9rem;margin-top:.7rem}
.qfb.cor{background:#dcfce7;color:#166534;border:1px solid #86efac}
.qfb.wrong{background:#fef2f2;color:#b91c1c;border:1px solid #fca5a5}
.qfb.long{background:#eff6ff;color:#1d4ed8;border:1px solid #93c5fd}
.qinfo{display:flex;justify-content:space-between;font-size:.78rem;color:var(--muted);margin-bottom:.4rem}
.pb-w{background:var(--border);border-radius:8px;height:6px;overflow:hidden;margin-bottom:.8rem}
.pb-f{height:100%;background:linear-gradient(90deg,var(--green-light),var(--gold));border-radius:8px;transition:width .4s ease}
.q-nav{display:flex;gap:.5rem;margin-top:1rem;justify-content:flex-end;flex-wrap:wrap}
.qscore-box{text-align:center;padding:1.5rem;background:var(--bg);border-radius:14px}
.qscore-box .big{font-size:3rem;font-weight:900;font-family:'Playfair Display',serif;color:var(--green)}
.qscore-box .grade{font-size:1.1rem;font-weight:700;margin:.3rem 0;color:var(--gold)}

/* â”€â”€ PROGRESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.prog-item{display:flex;align-items:center;gap:.75rem;padding:.8rem 0;border-bottom:1px solid var(--border)}
.prog-item:last-child{border:none}
.prog-icon{font-size:1.3rem;flex-shrink:0}
.prog-label{flex:1;font-size:.88rem;font-weight:700}
.prog-status{font-size:.78rem;color:var(--muted)}

/* â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.lb-table{width:100%;border-collapse:collapse;font-size:.88rem}
.lb-table th{background:var(--green);color:#fff;padding:.6rem .8rem;text-align:left;font-size:.75rem;text-transform:uppercase;letter-spacing:.04em}
.lb-table td{padding:.6rem .8rem;border-bottom:1px solid var(--border)}
.lb-table tr:last-child td{border:none}
.lb-table tr.me{background:#f0fdf4}
.rank-1 td:first-child::before{content:'ğŸ¥‡ '}
.rank-2 td:first-child::before{content:'ğŸ¥ˆ '}
.rank-3 td:first-child::before{content:'ğŸ¥‰ '}

/* â”€â”€ CERTIFICATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.cert-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;margin-top:1rem}
.cert-card{background:#fff;border-radius:14px;padding:1.2rem;text-align:center;box-shadow:var(--shadow);border-top:4px solid var(--border)}
.cert-card.bronze{border-top-color:#CD7F32}
.cert-card.silver{border-top-color:#A8A9AD}
.cert-card.gold{border-top-color:#F5B800}
.cert-card.plat{border-top-color:#5C6BC0}
.cert-milestones{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:.75rem;margin-bottom:1.2rem}
.cm{background:#fff;border-radius:12px;padding:1rem;text-align:center;border:2px solid var(--border);transition:.2s}
.cm.cm-earned{border-color:var(--gold);background:linear-gradient(135deg,#fffbeb,#fff)}
.cm.cm-locked{opacity:.6}
.cm-badge{font-size:1.8rem}
.cm-tier{font-weight:700;font-size:.88rem;margin:.2rem 0}
.cm-pts{font-size:.75rem;color:var(--muted)}
.cm-status{font-size:.72rem;font-weight:700;display:block;margin-top:.3rem}
.cm.cm-earned .cm-status{color:var(--ok)}

/* â”€â”€ CERTIFICATE OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#cert-ov{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:600;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1rem}
#cert-ov.hidden{display:none!important}
.cert-ov-acts{display:flex;gap:.75rem;margin-top:1rem;flex-wrap:wrap;justify-content:center}
.certificate{background:#fff;width:700px;max-width:100%;border-radius:0;font-family:'Lato',sans-serif;padding:0;overflow:hidden}
.cert-tier-strip{height:10px;width:100%}
.cert-tier-strip.bronze,.cert-tier-strip.bronze+div,.cert-card.bronze .cert-tier-strip{background:#CD7F32}
.cert-tier-strip.silver{background:#A8A9AD}
.cert-tier-strip.gold{background:#F5B800}
.cert-tier-strip.plat{background:linear-gradient(90deg,#5C6BC0,#9C27B0,#5C6BC0)}
.cert-hdr{display:flex;align-items:center;gap:1rem;padding:1.2rem 2rem;border-bottom:1px solid #f0f0f0}
.cert-hdr-logo{height:50px;width:50px;border-radius:50%;object-fit:cover}
.cert-hdr-org{font-weight:900;font-size:1rem;color:#1B4332}
.cert-hdr-sub{font-size:.75rem;color:#5a7464}
.cert-body{padding:1.5rem 2rem;text-align:center}
.cert-tier-badge-wrap{display:flex;align-items:center;justify-content:center;gap:.5rem;margin-bottom.5rem}
.cert-tier-icon{font-size:2rem}
.cert-tier-label{font-size:.9rem;font-weight:900;text-transform:uppercase;letter-spacing:.1em;padding:.2rem .8rem;border-radius:20px;background:#f5f5f5}
.cert-tier-label.bronze{background:#fdf0e0;color:#8B5E1A}
.cert-tier-label.silver{background:#f5f5f5;color:#555}
.cert-tier-label.gold{background:#fffbeb;color:#B87900}
.cert-tier-label.plat{background:#eef0ff;color:#3949AB}
.cert-title-txt{font-family:'Playfair Display',serif;font-size:1.6rem;color:#1B4332;margin:.5rem 0 .2rem;font-weight:900}
.cert-sub-txt{font-size:.82rem;color:#777;margin:.2rem 0}
.cert-divider{display:flex;align-items:center;gap:.5rem;margin:.6rem auto;max-width:300px}
.cert-divider-line{flex:1;height:1px;background:var(--border)}
.cert-divider-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.cert-divider-dot.bronze{background:#CD7F32}.cert-divider-dot.silver{background:#A8A9AD}.cert-divider-dot.gold{background:#F5B800}.cert-divider-dot.plat{background:#5C6BC0}
.cert-name{font-family:'Playfair Display',serif;font-size:1.8rem;color:#1B4332;margin:.4rem 0;font-weight:900}
.cert-name-line{display:block;height:2px;width:200px;margin:.1rem auto .5rem;border-radius:2px}
.cert-name-line.bronze{background:#CD7F32}.cert-name-line.silver{background:#A8A9AD}.cert-name-line.gold{background:#F5B800}.cert-name-line.plat{background:#5C6BC0}
.cert-pts-txt{font-size:.85rem;color:#777;margin:.3rem 0 .2rem}
.cert-pts-pill{display:inline-block;padding:.3rem 1rem;border-radius:20px;font-weight:900;font-size:.95rem}
.cert-pts-pill.bronze{background:#fdf0e0;color:#8B5E1A}
.cert-pts-pill.silver{background:#f5f5f5;color:#555}
.cert-pts-pill.gold{background:#fffbeb;color:#B87900}
.cert-pts-pill.plat{background:#eef0ff;color:#3949AB}
.cert-ftr{padding:1rem 2rem;border-top:1px solid #f0f0f0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
.cert-ftr-issued{font-size:.72rem;color:#999;max-width:380px;line-height:1.4}
.cert-id-pill{font-size:.68rem;background:#f5f5f5;padding:.2rem .6rem;border-radius:20px;color:#999;font-family:monospace}
.cert-meta{display:flex;justify-content:space-between;padding:.5rem 2rem;background:#fafafa;font-size:.68rem;color:#bbb}
@media print{
  #hdr,#nav,.cert-ov-acts{display:none!important}
  #cert-ov{position:static;background:none;padding:0}
  .certificate{width:100%;box-shadow:none}
}

/* â”€â”€ ADMIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#pg-adm-login{min-height:calc(100vh - 62px);display:flex;align-items:center;justify-content:center;background:linear-gradient(160deg,#f0f7f3,var(--bg))}
.adm-login-card{background:#fff;border-radius:18px;box-shadow:var(--shadow-lg);padding:2rem;max-width:380px;width:100%;margin:1rem}
.adm-login-card h2{font-size:1.4rem;color:var(--green);margin-bottom:.3rem;text-align:center}
.adm-login-card p{text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:1.4rem}
#pg-admin{display:none}
#pg-admin.on{display:flex}
.adm-wrap{display:flex;min-height:calc(100vh - 62px);width:100%}
.adm-sb{width:220px;background:var(--green);padding:1rem 0;flex-shrink:0;position:sticky;top:62px;height:calc(100vh - 62px);overflow-y:auto}
.sb-ni{display:flex;align-items:center;gap:.6rem;padding:.65rem 1.2rem;color:rgba(255,255,255,.75);font-size:.85rem;font-weight:700;cursor:pointer;transition:.15s;border-left:3px solid transparent}
.sb-ni:hover{background:rgba(255,255,255,.08);color:#fff}
.sb-ni.on{color:#fff;border-left-color:var(--gold);background:rgba(255,255,255,.1)}
.sb-sect{font-size:.68rem;font-weight:900;text-transform:uppercase;letter-spacing:.1em;color:rgba(255,255,255,.35);padding:.7rem 1.2rem .3rem}
.sb-foot{padding:1rem;margin-top:auto}
.adm-main{flex:1;overflow-y:auto;padding:1.4rem;background:var(--bg)}
.as{display:none}
.as.on{display:block}
.adm-card{background:#fff;border-radius:var(--r);padding:1.2rem;box-shadow:var(--shadow);margin-bottom:1.2rem}
.adm-card h3{font-size:1rem;color:var(--green);margin-bottom:1rem;padding-bottom:.5rem;border-bottom:1px solid var(--border);font-family:'Lato',sans-serif;font-weight:900;text-transform:uppercase;letter-spacing:.06em}
.ov-stats{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:.75rem;margin-bottom:.5rem}
.ov-stat{background:var(--bg);border-radius:10px;padding:.8rem;text-align:center}
.ov-stat .ov-n{font-size:1.5rem;font-weight:900;color:var(--green);font-family:'Playfair Display',serif}
.ov-stat .ov-l{font-size:.72rem;color:var(--muted);font-weight:700}
.tbl{width:100%;border-collapse:collapse;font-size:.84rem}
.tbl th{background:var(--bg);padding:.5rem .7rem;text-align:left;font-size:.72rem;text-transform:uppercase;letter-spacing:.04em;color:var(--muted);font-weight:900}
.tbl td{padding:.5rem .7rem;border-bottom:1px solid var(--border)}
.tbl tr:last-child td{border:none}
.tbl tr:hover td{background:#fafafa}
.tacts{display:flex;gap:.4rem;flex-wrap:wrap}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.75rem}
.qbb{border:1.5px solid var(--border);border-radius:12px;padding:1rem;margin-bottom:.75rem}
.qbb-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom.6rem}
.orow{display:flex;align-items:center;gap:.5rem;margin:.3rem 0}
.orow input[type=radio],.orow input[type=checkbox]{width:18px;min-width:18px;accent-color:var(--green)}
.orow input[type=text]{flex:1}
.ol{font-weight:900;font-size:.85rem;width:18px;flex-shrink:0;color:var(--muted)}
.ohint{font-size:.78rem;color:var(--muted);margin:.3rem 0 .5rem;padding:.5rem;background:var(--bg);border-radius:6px}
.long-note{font-size:.82rem;color:var(--muted);padding:.6rem .8rem;background:var(--bg);border-radius:8px;margin:.4rem 0}
.step-ed{border:1.5px solid var(--border);border-radius:10px;padding:.8rem;margin-bottom:.6rem}
.step-ed-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem}
.step-ed-num{font-size:.75rem;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:.05em}
.iet{display:inline-block;padding:.4rem .8rem;background:var(--bg);border-radius:8px;font-size:.8rem;font-weight:700;color:var(--muted);cursor:pointer;margin:.2rem;border:1.5px solid transparent}
.iet.on{background:var(--green);color:#fff;border-color:var(--green)}
.ie-section{display:none}
.ie-section.on{display:block}

/* â”€â”€ CONFIRM OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#cov{position:fixed;inset:0;background:rgba(0,0,0,.45);z-index:700;display:flex;align-items:center;justify-content:center;padding:1rem}
#cov.hidden{display:none!important}
.co-box{background:#fff;border-radius:16px;padding:1.5rem;max-width:380px;width:100%;box-shadow:var(--shadow-lg)}
.co-box h3{margin-bottom:.5rem;font-size:1.1rem}
.co-box p{color:var(--muted);font-size:.9rem;margin-bottom:1.2rem}
.co-acts{display:flex;gap:.7rem;justify-content:flex-end}

/* â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:680px){
  .stat-row{grid-template-columns:1fr 1fr}
  .form-row{grid-template-columns:1fr}
  .adm-sb{width:190px}
  #hdr-title small{display:none}
  .cert-milestones{grid-template-columns:1fr 1fr}
}
@media(max-width:520px){
  .adm-wrap{flex-direction:column}
  .adm-sb{width:100%;height:auto;position:static;display:flex;flex-wrap:wrap;padding:.4rem}
  .sb-ni{padding:.4rem .7rem;border-left:none;border-bottom:2px solid transparent;font-size:.78rem}
  .sb-ni.on{border-bottom-color:var(--gold);border-left:none}
  .sb-sect{display:none}
  .adm-main{padding:.8rem}
  #pg-admin.on{flex-direction:column}
}
</style>
</head>
<body>

<!-- HEADER -->
<header id="hdr">
  <img id="hdr-logo" src="" alt="B4C" onerror="this.style.display='none'">
  <div id="hdr-title">Bridge4Change<small>Learning Portal</small></div>
  <div id="hdr-r" style="display:none">
    <div id="hdr-av">?</div>
    <span id="hdr-nm"></span>
    <span id="hdr-pts" style="display:none"></span>
    <button id="hdr-out" onclick="logout()">Logout</button>
  </div>
</header>

<!-- NAV (shown when logged in) -->
<nav id="nav" style="display:none">
  <button class="nav-i on" data-pg="pg-dash" onclick="goNav(this,'pg-dash')">ğŸ  Home</button>
  <button class="nav-i" data-pg="pg-vids" onclick="goNav(this,'pg-vids')">ğŸ¬ Videos</button>
  <button class="nav-i" data-pg="pg-arts" onclick="goNav(this,'pg-arts')">ğŸ“š Articles</button>
  <button class="nav-i" data-pg="pg-prog" onclick="goNav(this,'pg-prog')">ğŸ“Š My Progress</button>
  <button class="nav-i" data-pg="pg-lb" onclick="goNav(this,'pg-lb')">ğŸ† Leaderboard</button>
  <button class="nav-i" data-pg="pg-certs" onclick="goNav(this,'pg-certs')">ğŸ“ Certificates</button>
  <button class="nav-i" data-pg="pg-about" onclick="goNav(this,'pg-about')">â„¹ï¸ About</button>
</nav>

<!-- â”€â”€ WELCOME / ONBOARD â”€â”€ -->
<div id="pg-welcome" class="pg on">
  <div class="wc-card">
    <img class="wc-logo" id="wc-logo" src="" alt="B4C" onerror="this.style.display='none'">
    <h1 class="wc-title" id="wc-title">Welcome!</h1>
    <p class="wc-sub" id="wc-sub">Enter your name to start learning. Your progress is saved automatically on this device.</p>
    <div class="fg">
      <label for="wc-name">Your Full Name</label>
      <input id="wc-name" type="text" placeholder="e.g. Priya Sharma" autocomplete="name" maxlength="80">
    </div>
    <div class="fg">
      <label for="wc-inst">Institution / Organisation</label>
      <input id="wc-inst" type="text" placeholder="e.g. IIT Delhi" maxlength="100">
    </div>
    <div class="fg">
      <label for="wc-cohort">Cohort / Batch <span style="font-weight:400;text-transform:none">(optional)</span></label>
      <input id="wc-cohort" type="text" placeholder="e.g. Batch 2025" maxlength="60">
    </div>
    <div id="wc-err" class="alert err hidden"></div>
    <button class="btn bp" onclick="startLearning()">Start Learning â†’</button>
    <div style="margin-top:1rem;text-align:center">
      <button class="btn bg_ sm" onclick="goAdminLogin()">ğŸ›¡ Admin Login</button>
    </div>
  </div>
</div>

<!-- â”€â”€ ADMIN LOGIN â”€â”€ -->
<div id="pg-adm-login" class="pg" style="display:none">
  <div class="adm-login-card">
    <h2>Admin Panel</h2>
    <p>Manage content, quizzes, and settings</p>
    <div class="fg"><label>Admin Password</label><input id="ap" type="password" placeholder="Enter admin password"></div>
    <div id="adm-err" class="alert err hidden"></div>
    <button class="btn bp" style="width:100%" onclick="doAdminLogin()">Login</button>
    <div style="margin-top:.8rem;text-align:center">
      <button class="btn bg_ sm" onclick="showPg('pg-welcome')">â† Back</button>
    </div>
  </div>
</div>

<!-- â”€â”€ STUDENT DASHBOARD â”€â”€ -->
<div id="pg-dash" class="pg" style="display:none">
  <div class="pw">
    <div class="dash-hero">
      <h2 id="dash-hi">Hello! ğŸ‘‹</h2>
      <p id="dash-sub">Continue your learning journey</p>
      <div class="pts-big" id="dash-pts">0 pts</div>
    </div>
    <div class="stat-row">
      <div class="stat-card"><div class="sv" id="ds-v">0</div><div class="sl">Videos</div></div>
      <div class="stat-card"><div class="sv" id="ds-a">0</div><div class="sl">Articles</div></div>
      <div class="stat-card"><div class="sv" id="ds-q">0</div><div class="sl">Quizzes</div></div>
    </div>
    <div style="margin-bottom:1.2rem">
      <div style="display:flex;justify-content:space-between;font-size:.82rem;color:var(--muted);margin-bottom:.3rem">
        <span>Overall completion</span><span id="ds-pct">0%</span>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="ds-bar" style="width:0%"></div></div>
    </div>
    <div class="section-title">ğŸ“Œ Recently Added</div>
    <div id="dash-recent" class="cards"></div>
  </div>
</div>

<!-- â”€â”€ VIDEOS â”€â”€ -->
<div id="pg-vids" class="pg" style="display:none">
  <div class="pw">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
      <h2 style="font-size:1.2rem">ğŸ¬ Videos</h2>
      <input style="max-width:200px;font-size:.85rem;padding:.5rem .8rem" type="text" placeholder="Searchâ€¦" oninput="renVids(this.value)">
    </div>
    <div id="vids-grid" class="cards"></div>
  </div>
</div>

<!-- â”€â”€ ARTICLES â”€â”€ -->
<div id="pg-arts" class="pg" style="display:none">
  <div class="pw">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
      <h2 style="font-size:1.2rem">ğŸ“š Articles</h2>
      <input style="max-width:200px;font-size:.85rem;padding:.5rem .8rem" type="text" placeholder="Searchâ€¦" oninput="renArts(this.value)">
    </div>
    <div id="arts-grid" class="cards"></div>
  </div>
</div>

<!-- â”€â”€ MY PROGRESS â”€â”€ -->
<div id="pg-prog" class="pg" style="display:none">
  <div class="pw">
    <h2 style="font-size:1.2rem;margin-bottom:1rem">ğŸ“Š My Progress</h2>
    <div id="prog-content"></div>
  </div>
</div>

<!-- â”€â”€ LEADERBOARD â”€â”€ -->
<div id="pg-lb" class="pg" style="display:none">
  <div class="pw">
    <h2 style="font-size:1.2rem;margin-bottom:1rem">ğŸ† Leaderboard</h2>
    <div id="lb-wrap"></div>
  </div>
</div>

<!-- â”€â”€ CERTIFICATES â”€â”€ -->
<div id="pg-certs" class="pg" style="display:none">
  <div class="pw">
    <h2 style="font-size:1.2rem;margin-bottom:.5rem">ğŸ“ My Certificates</h2>
    <p style="color:var(--muted);font-size:.88rem;margin-bottom:1.2rem">Earn points to unlock certificate tiers</p>
    <div id="cert-milestones" class="cert-milestones"></div>
    <div id="cert-list"></div>
  </div>
</div>

<!-- â”€â”€ ABOUT â”€â”€ -->
<div id="pg-about" class="pg" style="display:none">
  <div class="pw">
    <div style="background:linear-gradient(135deg,var(--green),var(--green-mid));color:#fff;border-radius:var(--r);padding:2rem;margin-bottom:1.5rem">
      <h1 id="ab-title" style="font-size:1.6rem;margin-bottom:.5rem">Bridge4Change Learning Portal</h1>
      <p id="ab-tagline" style="opacity:.85;font-size:.95rem;line-height:1.5"></p>
    </div>
    <div class="adm-card"><div id="ab-about" style="line-height:1.7"></div></div>
    <div id="ab-contact" style="text-align:center;color:var(--muted);font-size:.85rem;margin-top:1rem;padding:1rem"></div>
  </div>
</div>

<!-- â”€â”€ ADMIN PANEL â”€â”€ -->
<div id="pg-admin" class="pg" style="display:none">
  <div class="adm-wrap">
    <aside class="adm-sb">
      <div class="sb-sect">Overview</div>
      <div class="sb-ni on" data-s="as-ov" onclick="aTab(this,'as-ov')">ğŸ“Š Overview</div>
      <div class="sb-ni" data-s="as-us" onclick="aTab(this,'as-us')">ğŸ‘¥ Students</div>
      <div class="sb-sect">Content</div>
      <div class="sb-ni" data-s="as-vd" onclick="aTab(this,'as-vd')">ğŸ¬ Videos</div>
      <div class="sb-ni" data-s="as-ar" onclick="aTab(this,'as-ar')">ğŸ“š Articles</div>
      <div class="sb-ni" data-s="as-qz" onclick="aTab(this,'as-qz')">ğŸ“ Quizzes</div>
      <div class="sb-sect">Settings</div>
      <div class="sb-ni" data-s="as-pi" onclick="aTab(this,'as-pi')">ğŸ› Portal Info</div>
      <div class="sb-ni" data-s="as-cert" onclick="aTab(this,'as-cert')">ğŸ… Certificates</div>
      <div class="sb-ni" data-s="as-st" onclick="aTab(this,'as-st')">âš™ï¸ Settings</div>
      <div class="sb-foot"><button class="btn bg_" style="width:100%;color:#fff;border-color:rgba(255,255,255,.25)" onclick="admLogout()">Logout</button></div>
    </aside>
    <main class="adm-main">

      <!-- Overview -->
      <div id="as-ov" class="as on">
        <div class="adm-card"><h3>Overview</h3>
          <div class="ov-stats">
            <div class="ov-stat"><div class="ov-n" id="ov-us">0</div><div class="ov-l">Students</div></div>
            <div class="ov-stat"><div class="ov-n" id="ov-vd">0</div><div class="ov-l">Videos</div></div>
            <div class="ov-stat"><div class="ov-n" id="ov-ar">0</div><div class="ov-l">Articles</div></div>
            <div class="ov-stat"><div class="ov-n" id="ov-qz">0</div><div class="ov-l">Quizzes</div></div>
          </div>
        </div>
      </div>

      <!-- Students -->
      <div id="as-us" class="as">
        <div class="adm-card"><h3>All Students</h3>
          <div style="display:flex;gap:.5rem;margin-bottom:.8rem;flex-wrap:wrap">
            <input style="max-width:220px;font-size:.85rem" type="text" placeholder="Searchâ€¦" id="usrch" oninput="renAdmUsers()">
            <button class="btn bg_ sm" onclick="exportStudentsCSV()">ğŸ“¥ Export CSV</button>
          </div>
          <div style="overflow-x:auto"><table class="tbl"><thead><tr><th>Name</th><th>Institution</th><th>Cohort</th><th>Points</th><th>Videos</th><th>Articles</th><th>Quizzes</th></tr></thead><tbody id="u-tb"></tbody></table></div>
        </div>
      </div>

      <!-- Videos -->
      <div id="as-vd" class="as">
        <div class="adm-card">
          <h3>Add / Edit Video</h3>
          <input type="hidden" id="vf-id">
          <div class="form-row">
            <div class="fg"><label>Title *</label><input id="vf-ti" placeholder="Video titleâ€¦"></div>
            <div class="fg"><label>Theme / Category</label><input id="vf-th" placeholder="e.g. Climate Action"></div>
          </div>
          <div class="fg"><label>YouTube / Video URL *</label><input id="vf-ur" type="url" placeholder="https://youtube.com/watch?v=â€¦"></div>
          <div class="form-row">
            <div class="fg"><label>Duration</label><input id="vf-du" placeholder="e.g. 12 min"></div>
            <div class="fg"><label>Description</label><input id="vf-de" placeholder="Brief descriptionâ€¦"></div>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn bp" onclick="saveVid()">ğŸ’¾ Save Video</button>
            <button class="btn bg_ sm" onclick="clrVid()">Clear</button>
          </div>
        </div>
        <div class="adm-card"><h3>All Videos</h3>
          <div style="overflow-x:auto"><table class="tbl"><thead><tr><th>Title</th><th>Theme</th><th>Duration</th><th>Quiz?</th><th>Actions</th></tr></thead><tbody id="vf-tb"></tbody></table></div>
        </div>
      </div>

      <!-- Articles -->
      <div id="as-ar" class="as">
        <div class="adm-card">
          <h3>Add / Edit Article</h3>
          <input type="hidden" id="af-id">
          <div class="form-row">
            <div class="fg"><label>Title *</label><input id="af-ti" placeholder="Article titleâ€¦"></div>
            <div class="fg"><label>Theme / Category</label><input id="af-th" placeholder="e.g. Sustainability"></div>
          </div>
          <div class="fg"><label>Article URL *</label><input id="af-ur" type="url" placeholder="https://â€¦"></div>
          <div class="form-row">
            <div class="fg"><label>Read Time</label><input id="af-du" placeholder="e.g. 8 min read"></div>
            <div class="fg"><label>Description</label><input id="af-de" placeholder="Brief descriptionâ€¦"></div>
          </div>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn bp" onclick="saveArt()">ğŸ’¾ Save Article</button>
            <button class="btn bg_ sm" onclick="clrArt()">Clear</button>
          </div>
        </div>
        <div class="adm-card"><h3>All Articles</h3>
          <div style="overflow-x:auto"><table class="tbl"><thead><tr><th>Title</th><th>Theme</th><th>Read Time</th><th>Quiz?</th><th>Actions</th></tr></thead><tbody id="af-tb"></tbody></table></div>
        </div>
      </div>

      <!-- Quizzes -->
      <div id="as-qz" class="as">
        <div class="adm-card">
          <h3 id="qf-t">Create New Quiz</h3>
          <input type="hidden" id="qf-id">
          <div class="form-row">
            <div class="fg"><label>Quiz Title *</label><input id="qf-nm" placeholder="Quiz nameâ€¦"></div>
            <div class="fg"><label>Points per Question</label><input id="qf-pt" type="number" value="10" min="1"></div>
          </div>
          <div class="form-row">
            <div class="fg"><label>Linked To</label>
              <select id="qf-ct" onchange="refDrop()">
                <option value="standalone">Standalone (no link)</option>
                <option value="video">Video</option>
                <option value="article">Article</option>
              </select>
            </div>
            <div class="fg" id="qf-lw" style="display:none"><label>Select Item</label><select id="qf-ci"></select></div>
          </div>
          <div class="fg" style="display:flex;align-items:center;gap:.5rem">
            <input type="checkbox" id="qf-re" style="width:auto;accent-color:var(--green)">
            <label for="qf-re" style="margin:0;font-size:.88rem;text-transform:none;letter-spacing:0">Allow retakes</label>
          </div>
          <div style="display:flex;gap:.4rem;flex-wrap:wrap;margin-bottom:.8rem">
            <button class="btn bg_ sm" onclick="addQ(null,'mcq')">+ MCQ</button>
            <button class="btn bg_ sm" onclick="addQ(null,'tf')">+ True/False</button>
            <button class="btn bg_ sm" onclick="addQ(null,'multi')">+ Multi-select</button>
            <button class="btn bg_ sm" onclick="addQ(null,'long')">+ Long Answer</button>
          </div>
          <div id="qf-qw"><p class="ohint" style="margin:0">Click one of the buttons above to add a question.</p></div>
          <div style="display:flex;gap:.5rem;margin-top:.8rem;flex-wrap:wrap">
            <button class="btn bp" onclick="saveQuiz()">ğŸ’¾ Save Quiz</button>
            <button class="btn bg_ sm" onclick="clrQz()">Clear</button>
          </div>
        </div>
        <div class="adm-card"><h3>All Quizzes</h3>
          <div style="overflow-x:auto"><table class="tbl"><thead><tr><th>Title</th><th>Linked To</th><th>Questions</th><th>Pts</th><th>Retake</th><th>Actions</th></tr></thead><tbody id="qf-tb"></tbody></table></div>
        </div>
      </div>

      <!-- Portal Info -->
      <div id="as-pi" class="as">
        <div class="adm-card"><h3>Portal Info (About Page)</h3>
          <div class="fg"><label>Portal Title</label><input id="pi-title" placeholder="Bridge4Change Learning Portal"></div>
          <div class="fg"><label>Tagline</label><input id="pi-tagline" placeholder="Short inspiring taglineâ€¦"></div>
          <div class="fg"><label>About Text</label><textarea id="pi-about" rows="4" placeholder="Describe the portalâ€¦"></textarea></div>
          <div class="fg"><label>Contact / Support Text</label><textarea id="pi-contact" rows="2" placeholder="For help, emailâ€¦"></textarea></div>
          <button class="btn bp" onclick="savePortalInfo()">ğŸ’¾ Save Info</button>
        </div>
      </div>

      <!-- Certificates -->
      <div id="as-cert" class="as">
        <div class="adm-card"><h3>Certificate Tier Thresholds</h3>
          <div class="form-row">
            <div class="fg"><label>ğŸ¥‰ Bronze (pts)</label><input id="cert-br" type="number" value="100"></div>
            <div class="fg"><label>ğŸ¥ˆ Silver (pts)</label><input id="cert-si" type="number" value="300"></div>
          </div>
          <div class="form-row">
            <div class="fg"><label>ğŸ¥‡ Gold (pts)</label><input id="cert-go" type="number" value="500"></div>
            <div class="fg"><label>ğŸ’ Platinum (pts)</label><input id="cert-pl" type="number" value="1000"></div>
          </div>
          <div class="fg"><label>Organisation Name (on cert)</label><input id="cert-org" value="Bridge4Change Foundation"></div>
          <div class="form-row">
            <div class="fg"><label>Signatory Name</label><input id="cert-sn" value="Programme Director"></div>
            <div class="fg"><label>Signatory Title</label><input id="cert-st" value="Bridge4Change Foundation"></div>
          </div>
          <button class="btn bp" onclick="saveCertCfg()">ğŸ’¾ Save</button>
          <div style="margin-top:1rem"><button class="btn bg_ sm" onclick="previewSampleCert('gold')">Preview Sample Certificate</button></div>
        </div>
      </div>

      <!-- Settings -->
      <div id="as-st" class="as">
        <div class="adm-card"><h3>Admin Password</h3>
          <p style="font-size:.85rem;color:var(--muted);margin-bottom:1rem">Change the admin panel password. Default is <strong>admin123</strong></p>
          <div class="fg"><label>New Password</label><input id="st-np" type="password" placeholder="New passwordâ€¦"></div>
          <div class="fg"><label>Confirm Password</label><input id="st-cp" type="password" placeholder="Confirmâ€¦"></div>
          <button class="btn bp" onclick="changeAdmPass()">Update Password</button>
        </div>
        <div class="adm-card"><h3>Data Management</h3>
          <p style="font-size:.85rem;color:var(--muted);margin-bottom:1rem">All data is stored in your browser's localStorage. Export to back it up.</p>
          <div style="display:flex;gap:.5rem;flex-wrap:wrap">
            <button class="btn bg_" onclick="exportAllData()">ğŸ“¦ Export All Data (JSON)</button>
            <button class="btn bg_" onclick="importDataClick()">ğŸ“¥ Import Data (JSON)</button>
            <button class="btn bd" onclick="confirmResetAll()">âš ï¸ Reset All Data</button>
          </div>
          <input type="file" id="import-file" style="display:none" accept=".json" onchange="importData(this)">
        </div>
        <div class="adm-card"><h3>Portal Logo</h3>
          <p style="font-size:.85rem;color:var(--muted);margin-bottom:.8rem">Upload a logo image (shown in header and on certificates).</p>
          <input type="file" id="logo-file" accept="image/*" onchange="uploadLogo(this)">
          <div style="margin-top:.8rem" id="logo-preview"></div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- â”€â”€ QUIZ OVERLAY â”€â”€ -->
<div id="qov" class="hidden">
  <div class="qm">
    <div class="qm-hdr">
      <h3 id="qm-t">Quiz</h3>
      <button class="qm-close" onclick="closeQz()">âœ•</button>
    </div>
    <div id="qm-body"></div>
  </div>
</div>

<!-- â”€â”€ CERTIFICATE OVERLAY â”€â”€ -->
<div id="cert-ov" class="hidden">
  <div id="cert-canvas-wrap"></div>
  <div class="cert-ov-acts">
    <button class="btn bp" id="dl-cert-btn" onclick="downloadCert()">â¬‡ï¸ Download PNG</button>
    <button class="btn bg_" style="color:#fff;border-color:rgba(255,255,255,.4)" onclick="printCert()">ğŸ–¨ï¸ Print</button>
    <button class="btn bg_" style="color:#fff;border-color:rgba(255,255,255,.4)" onclick="closeCertOv()">âœ• Close</button>
  </div>
</div>

<!-- â”€â”€ CONFIRM OVERLAY â”€â”€ -->
<div id="cov" class="hidden">
  <div class="co-box">
    <h3 id="co-t"></h3>
    <p id="co-m"></p>
    <div class="co-acts">
      <button class="btn bg_" onclick="closeCo()">Cancel</button>
      <button class="btn bd" id="co-ok">Confirm</button>
    </div>
  </div>
</div>

<script>
// ============================================================
// BRIDGE4CHANGE LEARNING PORTAL v12
// â”€â”€ Zero-login, single HTML file, localStorage-based â”€â”€â”€â”€â”€â”€
// All data stored in browser. No server, no account needed.
// Admin manages content via built-in password-protected panel.
// ============================================================

// â”€â”€ DATA STORE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DB: content (videos, articles, quizzes)
// USERS: array of {name, institution, cohort, points, progress:{vw:[],ar:[]}, attempts:[]}
// CFG: portal config (admin pass, portal info, cert thresholds)
var DB  = {V:[], A:[], Q:[]};
var CFG = {};
var S   = {user:null, isAdmin:false};

var DEFAULT_CFG = {
  admPass:'admin123',
  title:'Bridge4Change Learning Portal',
  tagline:'Empowering changemakers through knowledge, skills & community.',
  about:'The Bridge4Change Learning Portal is a curated digital library of videos, articles, and interactive quizzes focused on social impact, sustainability, climate action, and community development.',
  contact:'For any technical issues, please email support@bridge4change.org.',
  cert:{br:100,si:300,go:500,pl:1000,org:'Bridge4Change Foundation',sn:'Programme Director',st:'Bridge4Change Foundation'},
  logo:''
};

// â”€â”€ STORAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ls(k)    { try{return localStorage.getItem('b4c_'+k);}catch(e){return null;} }
function lsS(k,v) { try{localStorage.setItem('b4c_'+k, typeof v==='string'?v:JSON.stringify(v));}catch(e){} }
function lsR(k)   { try{localStorage.removeItem('b4c_'+k);}catch(e){} }
function sj(s,d)  { try{return JSON.parse(s||'null')||d;}catch(e){return d;} }

// â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function boot(){
  DB.V  = sj(ls('videos'), []);
  DB.A  = sj(ls('articles'), []);
  DB.Q  = sj(ls('quizzes'), []);
  CFG   = sj(ls('cfg'), Object.assign({},DEFAULT_CFG));
  if (!CFG.cert) CFG.cert = DEFAULT_CFG.cert;
  if (!CFG.admPass) CFG.admPass = DEFAULT_CFG.admPass;

  // Apply logo
  applyLogo(CFG.logo||'');

  // Admin session
  if (ls('sess_adm')==='1') { enterAdmin(); return; }

  // User session
  var u = sj(ls('sess_user'), null);
  if (u && u.name) {
    S.user = u;
    enterStudent();
    return;
  }
  showPg('pg-welcome');
})();

function applyLogo(src) {
  var imgs = document.querySelectorAll('#hdr-logo,#wc-logo,.cert-hdr-logo');
  imgs.forEach(function(img){ if(src){img.src=src;img.style.display='';}else{img.src='';} });
  g('wc-title').textContent = CFG.title||DEFAULT_CFG.title;
  g('wc-sub').textContent = CFG.tagline||DEFAULT_CFG.tagline;
}

// â”€â”€ PAGE ROUTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPg(id) {
  document.querySelectorAll('.pg').forEach(function(p){p.style.display='none';p.classList.remove('on');});
  var el = g(id); if(!el) return;
  if(id==='pg-admin'){ el.style.display='flex'; }
  else if(id==='pg-welcome'||id==='pg-adm-login'){ el.style.display='flex'; }
  else{ el.style.display='block'; }
  el.classList.add('on');
}

function goNav(btn, pgId) {
  document.querySelectorAll('.nav-i').forEach(function(b){b.classList.remove('on');});
  btn.classList.add('on');
  showPg(pgId);
  if(pgId==='pg-dash') renDash();
  if(pgId==='pg-vids') renVids();
  if(pgId==='pg-arts') renArts();
  if(pgId==='pg-prog') renProg();
  if(pgId==='pg-lb')   renLb();
  if(pgId==='pg-certs') renCerts();
  if(pgId==='pg-about') renAbout();
}

// â”€â”€ WELCOME / START â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startLearning() {
  var name   = g('wc-name').value.trim();
  var inst   = g('wc-inst').value.trim();
  var cohort = g('wc-cohort').value.trim() || 'Not specified';
  var err    = g('wc-err');
  if (!name)  { showErr(err,'Please enter your name.'); return; }
  if (!inst)  { showErr(err,'Please enter your institution.'); return; }

  // Get or create this user from local users list
  var users = sj(ls('users'), []);
  var user = users.find(function(u){ return u.name.toLowerCase()===name.toLowerCase()&&u.institution.toLowerCase()===inst.toLowerCase(); });
  if (!user) {
    user = {id:'u'+Date.now(), name:name, institution:inst, cohort:cohort, points:0, progress:{vw:[],ar:[]}, attempts:[], joinedAt:new Date().toISOString()};
    users.push(user);
    lsS('users', users);
  }
  S.user = user;
  lsS('sess_user', user);
  enterStudent();
}

function enterStudent() {
  g('hdr-av').textContent = (S.user.name||'?')[0].toUpperCase();
  g('hdr-nm').textContent = S.user.name;
  g('hdr-pts').textContent = (S.user.points||0)+' pts';
  g('hdr-pts').style.display = 'inline';
  g('hdr-r').style.display = 'flex';
  g('nav').style.display = 'flex';
  showPg('pg-dash');
  renDash();
}

function logout() {
  if(!confirm('Leave? Your progress is saved.')) return;
  S.user=null; S.isAdmin=false;
  lsR('sess_user'); lsR('sess_adm');
  g('hdr-r').style.display='none';
  g('nav').style.display='none';
  showPg('pg-welcome');
}

// â”€â”€ SAVE USER BACK (updates points, progress) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveUser() {
  var users = sj(ls('users'), []);
  var idx = users.findIndex(function(u){ return u.id===S.user.id; });
  if (idx>=0) users[idx] = S.user;
  else users.push(S.user);
  lsS('users', users);
  lsS('sess_user', S.user);
  // Update header pts
  g('hdr-pts').textContent = (S.user.points||0)+' pts';
}

// â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renDash() {
  var u=S.user; if(!u) return;
  g('dash-hi').textContent = 'Hello, '+u.name.split(' ')[0]+'! ğŸ‘‹';
  g('dash-pts').textContent = (u.points||0)+' pts';
  var vw=(u.progress&&u.progress.vw)||[], ar=(u.progress&&u.progress.ar)||[];
  var qDone = (u.attempts||[]).length;
  var total = DB.V.length+DB.A.length;
  var done  = vw.length+ar.length;
  var pct   = total>0?Math.round(done/total*100):0;
  g('ds-v').textContent=vw.length+'/'+DB.V.length;
  g('ds-a').textContent=ar.length+'/'+DB.A.length;
  g('ds-q').textContent=qDone;
  g('ds-pct').textContent=pct+'%';
  g('ds-bar').style.width=pct+'%';
  // Recently added (last 4 items)
  var recent = DB.V.concat(DB.A).slice(-4).reverse();
  g('dash-recent').innerHTML = recent.length
    ? recent.map(function(item){ return cardHtml(item, item.type||'video'); }).join('')
    : '<div class="empty"><div class="ei">ğŸ“­</div><p>No content yet. Check back soon!</p></div>';
}

// â”€â”€ VIDEO CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cardHtml(item, type) {
  var u=S.user, prog=u&&u.progress;
  var done=(type==='video'?(prog&&prog.vw||[]):(prog&&prog.ar||[])).indexOf(String(item.id))>=0;
  var icon=type==='video'?'ğŸ¬':'ğŸ“–';
  var qids=DB.Q.filter(function(q){ return q.ci===item.id; }).map(function(q){return q.id;});
  var hasQ=qids.length>0;
  var allQDone=hasQ&&qids.every(function(qid){ return (u.attempts||[]).some(function(a){return a.qid===qid;}); });
  return '<div class="card">'+
    '<div class="card-thumb" style="background:linear-gradient(135deg,'+(type==='video'?'#1B4332,#40916C':'#1a237e,#3949AB')+')">'+
      icon+(done?'<div class="card-done">âœ“</div>':'')+
    '</div>'+
    '<div class="card-body">'+
      (item.theme?'<span class="card-tag">'+esc(item.theme)+'</span>':'')+
      '<h4>'+esc(item.title)+'</h4>'+
      '<div class="card-meta">'+(item.duration?'â± '+esc(item.duration):'')+(item.description?' â€¢ '+esc(item.description.substring(0,60))+(item.description.length>60?'â€¦':''):'')+'</div>'+
      '<div class="card-acts">'+
        (type==='video'
          ?'<a class="btn bp sm" href="'+esc(item.url)+'" target="_blank" rel="noopener" onclick="markV(\''+item.id+'\')">â–¶ Watch</a>'
          :'<a class="btn bp sm" href="'+esc(item.url)+'" target="_blank" rel="noopener" onclick="markA(\''+item.id+'\')">ğŸ“– Read</a>')+
        (!done?'<button class="btn bg_ sm" onclick="markDone(\''+item.id+'\',\''+type+'\')">âœ“ Mark Done</button>':
                '<span class="chip cg">âœ“ Done</span>')+
        (hasQ&&!allQDone?'<button class="btn sm" style="background:var(--gold);color:var(--green)" onclick="openFirstQ(\''+item.id+'\')">ğŸ“ Quiz</button>':'')+
        (allQDone?'<span class="chip cg">ğŸ“ Quiz Done</span>':'')+
      '</div>'+
    '</div>'+
  '</div>';
}

function renVids(q) {
  var items=DB.V.filter(function(v){ return !q||(v.title||'').toLowerCase().indexOf(q.toLowerCase())>=0; });
  g('vids-grid').innerHTML = items.length
    ? items.map(function(v){ return cardHtml(v,'video'); }).join('')
    : '<div class="empty"><div class="ei">ğŸ¬</div><p>'+(DB.V.length?'No results.':'No videos added yet.')+'</p></div>';
}

function renArts(q) {
  var items=DB.A.filter(function(a){ return !q||(a.title||'').toLowerCase().indexOf(q.toLowerCase())>=0; });
  g('arts-grid').innerHTML = items.length
    ? items.map(function(a){ return cardHtml(a,'article'); }).join('')
    : '<div class="empty"><div class="ei">ğŸ“š</div><p>'+(DB.A.length?'No results.':'No articles added yet.')+'</p></div>';
}

function markV(id) { markDone(id,'video'); }
function markA(id) { markDone(id,'article'); }

function markDone(id, type) {
  var u=S.user; if(!u) return;
  if(!u.progress) u.progress={vw:[],ar:[]};
  var list = type==='video'?u.progress.vw:u.progress.ar;
  if(list.indexOf(String(id))>=0) return;
  list.push(String(id));
  u.points=(u.points||0)+5;
  saveUser();
  toast((type==='video'?'ğŸ¬':'ğŸ“–')+' +5 pts! Great job!');
  renVids(); renArts(); renDash();
  checkTierCerts();
}

function openFirstQ(contentId) {
  var q=DB.Q.find(function(q){ return q.ci===contentId; });
  if(q) startQz(q.id);
}

// â”€â”€ PROGRESS PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renProg() {
  var u=S.user; if(!u) return;
  var vw=(u.progress&&u.progress.vw)||[], ar=(u.progress&&u.progress.ar)||[];
  var html='<div class="adm-card" style="margin-bottom:1rem"><h3 style="font-family:Lato;font-weight:900;font-size:.9rem;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:1rem">Videos</h3>';
  if(!DB.V.length) html+='<p style="color:var(--muted);font-size:.88rem">No videos yet.</p>';
  DB.V.forEach(function(v){
    var done=vw.indexOf(String(v.id))>=0;
    html+='<div class="prog-item"><div class="prog-icon">'+(done?'âœ…':'ğŸ¬')+'</div>'+
      '<div class="prog-label">'+esc(v.title)+'</div>'+
      '<div class="prog-status">'+(done?'<span class="chip cg">Done +5pts</span>':'<span class="chip cr">Pending</span>')+'</div></div>';
  });
  html+='</div><div class="adm-card"><h3 style="font-family:Lato;font-weight:900;font-size:.9rem;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:1rem">Articles</h3>';
  if(!DB.A.length) html+='<p style="color:var(--muted);font-size:.88rem">No articles yet.</p>';
  DB.A.forEach(function(a){
    var done=ar.indexOf(String(a.id))>=0;
    html+='<div class="prog-item"><div class="prog-icon">'+(done?'âœ…':'ğŸ“–')+'</div>'+
      '<div class="prog-label">'+esc(a.title)+'</div>'+
      '<div class="prog-status">'+(done?'<span class="chip cg">Done +5pts</span>':'<span class="chip cr">Pending</span>')+'</div></div>';
  });
  html+='</div>';
  if(u.attempts&&u.attempts.length){
    html+='<div class="adm-card"><h3 style="font-family:Lato;font-weight:900;font-size:.9rem;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:1rem">Quiz Attempts</h3>';
    u.attempts.forEach(function(a){
      html+='<div class="prog-item"><div class="prog-icon">ğŸ“</div>'+
        '<div class="prog-label">'+esc(a.qt)+'</div>'+
        '<div class="prog-status">'+a.sc+'/'+a.tot+' â€” <strong>+'+a.pe+' pts</strong></div></div>';
    });
    html+='</div>';
  }
  g('prog-content').innerHTML=html;
}

// â”€â”€ LEADERBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renLb() {
  var users = sj(ls('users'), []).slice().sort(function(a,b){return (b.points||0)-(a.points||0);});
  var html='<div style="overflow-x:auto"><table class="lb-table"><thead><tr><th>#</th><th>Name</th><th>Institution</th><th>Points</th></tr></thead><tbody>';
  if(!users.length){
    html+='<tr><td colspan="4" style="text-align:center;padding:2rem;color:var(--muted)">No learners yet. Share the portal!</td></tr>';
  }
  users.forEach(function(u,i){
    var isMe=(S.user&&u.id===S.user.id);
    html+='<tr class="'+(isMe?'me ':'')+'rank-'+(i+1)+'">'+'<td>'+(i+1)+'</td><td>'+(isMe?'<strong>':'')+esc(u.name)+(isMe?'</strong>':'')+' '+(isMe?'<span class="chip cg" style="font-size:.65rem">You</span>':'')+'</td><td>'+esc(u.institution||'â€“')+'</td><td><strong>'+(u.points||0)+'</strong></td></tr>';
  });
  html+='</tbody></table></div>';
  g('lb-wrap').innerHTML=html;
}

// â”€â”€ CERTIFICATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var TIERS=[
  {id:'bronze',label:'Bronze',icon:'ğŸ¥‰',minPts:function(){return parseInt(CFG.cert&&CFG.cert.br)||100;},cls:'bronze'},
  {id:'silver',label:'Silver',icon:'ğŸ¥ˆ',minPts:function(){return parseInt(CFG.cert&&CFG.cert.si)||300;},cls:'silver'},
  {id:'gold',  label:'Gold',  icon:'ğŸ¥‡',minPts:function(){return parseInt(CFG.cert&&CFG.cert.go)||500;},cls:'gold'},
  {id:'plat',  label:'Platinum',icon:'ğŸ’',minPts:function(){return parseInt(CFG.cert&&CFG.cert.pl)||1000;},cls:'plat'}
];

function checkTierCerts() {
  var u=S.user; if(!u) return;
  var pts=u.points||0;
  var issued=u.certs||[];
  TIERS.forEach(function(t){
    if(pts>=t.minPts()&&issued.indexOf(t.id)<0){
      if(!u.certs)u.certs=[];
      u.certs.push(t.id);
      saveUser();
      showTierToast(t);
    }
  });
}

function showTierToast(t) {
  var el=document.createElement('div');
  el.style.cssText='position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%);background:#fff;border:2.5px solid var(--gold);border-radius:14px;padding:1rem 1.5rem;z-index:3000;box-shadow:var(--shadow-lg);text-align:center;min-width:260px';
  el.innerHTML='<div style="font-size:2rem">'+t.icon+'</div><div style="font-weight:900;color:var(--green);margin:.2rem 0">'+t.label+' Certificate Unlocked!</div><div style="font-size:.8rem;color:var(--muted);margin-bottom:.7rem">You earned the '+t.label+' tier!</div><button onclick="showCertificate(\''+t.id+'\');this.closest(\'div\').remove()" style="background:var(--green);color:#fff;border:none;padding:.4rem 1rem;border-radius:8px;font-size:.82rem;cursor:pointer;font-weight:700">View Certificate</button>';
  document.body.appendChild(el);
  setTimeout(function(){if(el.parentNode)el.remove();},8000);
}

function renCerts() {
  var u=S.user; if(!u) return;
  var pts=u.points||0, issued=u.certs||[];
  // Milestones
  g('cert-milestones').innerHTML=TIERS.map(function(t){
    var earned=issued.indexOf(t.id)>=0||pts>=t.minPts();
    return '<div class="cm '+(earned?'cm-earned':'cm-locked')+'" '+(earned?'onclick="showCertificate(\''+t.id+'\');return false" style="cursor:pointer"':'')+'>'+
      '<div class="cm-badge">'+t.icon+'</div>'+
      '<div class="cm-tier">'+t.label+'</div>'+
      '<div class="cm-pts">'+t.minPts()+'+ pts</div>'+
      '<span class="cm-status">'+(earned?'âœ“ Unlocked':'ğŸ”’ '+t.minPts()+' pts needed')+'</span>'+
    '</div>';
  }).join('');
  // List
  if(!issued.length){
    g('cert-list').innerHTML='<div class="empty"><div class="ei">ğŸ“</div><p>Earn <strong>'+TIERS[0].minPts()+'+ points</strong> to unlock your first certificate!</p></div>';
    return;
  }
  g('cert-list').innerHTML='<div class="cert-grid">'+TIERS.filter(function(t){return issued.indexOf(t.id)>=0;}).map(function(t){
    return '<div class="cert-card '+t.cls+'">'+
      '<div style="font-size:2rem">'+t.icon+'</div>'+
      '<div style="font-weight:900;margin:.3rem 0">'+t.label+' Certificate</div>'+
      '<button class="btn bp sm" style="margin-top:.5rem" onclick="showCertificate(\''+t.id+'\')">ğŸ… View &amp; Download</button>'+
    '</div>';
  }).join('')+'</div>';
}

function showCertificate(tierId) {
  var t=TIERS.find(function(x){return x.id===tierId;});
  if(!t) return;
  var u=S.user||{}, cfg=CFG.cert||DEFAULT_CFG.cert;
  var pts=u.points||0;
  var date=new Date().toLocaleDateString('en-GB',{day:'numeric',month:'long',year:'numeric'});
  var certId='B4C-'+tierId.toUpperCase()+'-'+new Date().getFullYear()+'-'+(u.name||'').toUpperCase().replace(/\s+/g,'').substring(0,6);
  var cls=t.cls;
  var logoSrc=CFG.logo||'';
  var html=
    '<div class="certificate">'+
      '<div class="cert-tier-strip '+cls+'"></div>'+
      '<div class="cert-hdr">'+
        (logoSrc?'<img class="cert-hdr-logo" src="'+logoSrc+'" alt="Logo">':'')+
        '<div><div class="cert-hdr-org">'+esc(cfg.org||'Bridge4Change Foundation')+'</div><div class="cert-hdr-sub">Learning &amp; Development</div></div>'+
      '</div>'+
      '<div class="cert-body">'+
        '<div class="cert-tier-badge-wrap"><div class="cert-tier-icon">'+t.icon+'</div><span class="cert-tier-label '+cls+'">'+t.label+' Certificate</span></div>'+
        '<div class="cert-title-txt">Certificate of Achievement</div>'+
        '<div class="cert-sub-txt">This is to certify that</div>'+
        '<div class="cert-divider"><div class="cert-divider-line '+cls+'"></div><div class="cert-divider-dot '+cls+'"></div><div class="cert-divider-line '+cls+'"></div></div>'+
        '<div class="cert-name">'+esc(u.name||'Learner')+'</div>'+
        '<span class="cert-name-line '+cls+'"></span>'+
        '<div class="cert-pts-txt">has earned <span class="cert-pts-pill '+cls+'">'+pts+' Points</span></div>'+
        '<div class="cert-sub-txt" style="margin-top:.4rem">Date: '+date+'</div>'+
      '</div>'+
      '<div class="cert-ftr">'+
        '<div class="cert-ftr-issued">'+esc(cfg.sn||'Programme Director')+', '+esc(cfg.st||cfg.org||'Bridge4Change')+'</div>'+
        '<div class="cert-id-pill">'+certId+'</div>'+
      '</div>'+
      '<div class="cert-tier-strip '+cls+'"></div>'+
    '</div>';
  g('cert-canvas-wrap').innerHTML=html;
  g('cert-ov').classList.remove('hidden');
  document.body.style.overflow='hidden';
}

function previewSampleCert(tier) {
  var orig=S.user;
  S.user={name:'Sample Learner',points:TIERS.find(function(t){return t.id===tier;}).minPts(),certs:[tier]};
  showCertificate(tier);
  S.user=orig;
}

function closeCertOv(){ g('cert-ov').classList.add('hidden'); document.body.style.overflow=''; }
function printCert(){ window.print(); }
function downloadCert(){
  var wrap=g('cert-canvas-wrap'), cert=wrap.querySelector('.certificate'); if(!cert)return;
  var btn=g('dl-cert-btn'), orig=btn.textContent;
  btn.textContent='â³ Generatingâ€¦'; btn.disabled=true;
  var name=(S.user&&S.user.name||'Learner').replace(/[^a-zA-Z0-9 ]/g,'').trim().replace(/\s+/g,'-');
  html2canvas(cert,{scale:3,useCORS:true,backgroundColor:'#fff',logging:false}).then(function(canvas){
    var a=document.createElement('a'); a.download='B4C-Certificate-'+name+'.png'; a.href=canvas.toDataURL('image/png',1); a.click();
    btn.textContent='âœ“ Downloaded!'; btn.disabled=false; setTimeout(function(){btn.textContent=orig;},2500);
  }).catch(function(){btn.textContent='âœ— Failed â€” try Print'; btn.disabled=false; setTimeout(function(){btn.textContent=orig;},3000);});
}

// â”€â”€ ABOUT PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renAbout() {
  g('ab-title').textContent   = CFG.title   || DEFAULT_CFG.title;
  g('ab-tagline').textContent = CFG.tagline || DEFAULT_CFG.tagline;
  g('ab-about').textContent   = CFG.about   || DEFAULT_CFG.about;
  g('ab-contact').textContent = CFG.contact || DEFAULT_CFG.contact;
}

// â”€â”€ QUIZ ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var QS={qz:null,cur:0,ans:[],sel:null,multiSel:[]};

function startQz(qid) {
  var qz=DB.Q.find(function(q){return q.id===qid;}); if(!qz)return;
  var u=S.user;
  var done=(u.attempts||[]).some(function(a){return a.qid===qid;});
  if(done&&!qz.retry){alreadyDone(qz);return;}
  QS.qz=qz;QS.cur=0;QS.ans=[];QS.sel=null;QS.multiSel=[];
  g('qm-t').textContent=qz.title;
  g('qov').classList.remove('hidden');
  renQz();
}

function renQz(){
  var qz=QS.qz,q=qz.qs[QS.cur];
  var type=q.type||'mcq';
  var pct=Math.round(QS.cur/qz.qs.length*100);
  var badge={mcq:'<span class="qtype-badge qt-mcq">Single Answer</span>',multi:'<span class="qtype-badge qt-multi">Multiple Answers</span>',long:'<span class="qtype-badge qt-long">Long Answer</span>',tf:'<span class="qtype-badge qt-tf">True / False</span>'}[type]||'';
  var body='<div class="qinfo"><span>Q'+(QS.cur+1)+' of '+qz.qs.length+'</span><span>'+qz.pts+' pts each</span></div>'+
    '<div class="pb-w"><div class="pb-f" style="width:'+pct+'%"></div></div>'+
    '<div style="display:flex;align-items:center;gap:.5rem;margin:.5rem 0 .3rem">'+
      '<div class="qnum">Q'+(QS.cur+1)+'</div>'+badge+'</div>'+
    '<div class="qtxt">'+esc(q.q)+'</div>';
  if(type==='mcq'||type==='tf'){
    var opts=type==='tf'?['âœ… True','âŒ False']:q.opts;
    body+='<div class="qopts">'+opts.map(function(o,i){
      return '<button class="qopt" onclick="pickMcq('+i+')"><span style="font-weight:700;color:var(--muted);margin-right:.5rem">'+['A','B','C','D'][i]+'.</span>'+esc(o)+'</button>';
    }).join('')+'</div>';
  } else if(type==='multi'){
    body+='<div class="multi-note">â˜‘ï¸ Select ALL correct answers, then click Submit</div>'+
      '<div class="qopts">'+q.opts.map(function(o,i){
        return '<button class="qopt" onclick="pickMulti('+i+',this)"><span style="font-weight:700;color:var(--muted);margin-right:.5rem">'+['A','B','C','D'][i]+'.</span>'+esc(o)+'</button>';
      }).join('')+'</div>';
  } else {
    body+='<div class="long-note">âœï¸ Open-ended question. Full points for attempting.</div>'+
      '<textarea class="long-ans" id="la-inp" placeholder="Type your answer hereâ€¦" oninput="onLong()"></textarea>';
  }
  body+='<div id="qfb" style="display:none"></div>'+
    '<div class="q-nav" id="qnav">'+
      (type==='multi'?'<button class="btn bg_ sm" id="sub-multi" onclick="submitMulti()" disabled>Submit Answer</button>':'')+
      (type==='long'?'<button class="btn bg_ sm" id="sub-long" onclick="submitLong()" disabled>Submit Answer</button>':'')+
    '</div>';
  g('qm-body').innerHTML=body;
}

function pickMcq(i){
  if(document.getElementById('qfb').style.display!=='none')return; // already answered
  QS.sel=i;
  document.querySelectorAll('.qopt').forEach(function(b,idx){b.classList.toggle('sel',idx===i);});
  // Auto-submit
  var qz=QS.qz,q=qz.qs[QS.cur],type=q.type||'mcq';
  var correct=(type==='tf'?q.cor:q.cor)===i;
  showFeedback(correct,i,q);
}

function pickMulti(i,btn){
  btn.classList.toggle('sel');
  var sel=Array.from(document.querySelectorAll('.qopt.sel')).map(function(_,idx){ return idx; });
  QS.multiSel=[];
  document.querySelectorAll('.qopt').forEach(function(b,idx){if(b.classList.contains('sel'))QS.multiSel.push(idx);});
  var subBtn=g('sub-multi'); if(subBtn)subBtn.disabled=QS.multiSel.length===0;
}

function submitMulti(){
  var q=QS.qz.qs[QS.cur];
  var correct=arrEq(QS.multiSel.sort(),q.cors.sort());
  showFeedback(correct,QS.multiSel,q);
}

function onLong(){ var btn=g('sub-long'); if(btn)btn.disabled=!(g('la-inp').value.trim()); }
function submitLong(){
  var ans=g('la-inp').value.trim(); if(!ans)return;
  QS.ans.push({type:'long',ans:ans,pts:QS.qz.pts});
  // Long answer: auto-award full points
  showFeedbackEl(true,'âœï¸ Thank you! Full points awarded for attempting.',true);
}

function showFeedback(correct,sel,q){
  var pts=correct?QS.qz.pts:0;
  QS.ans.push({type:q.type||'mcq',sel:sel,correct:correct,pts:pts});
  // Highlight options
  document.querySelectorAll('.qopt').forEach(function(b,idx){
    b.disabled=true;
    if(Array.isArray(sel)?sel.indexOf(idx)>=0:idx===sel) b.classList.add(correct?'cor':'wrong');
    if((q.type==='mcq'||q.type==='tf')&&idx===q.cor) b.classList.add('cor');
    if(q.type==='multi'&&q.cors.indexOf(idx)>=0) b.classList.add('cor');
  });
  showFeedbackEl(correct,correct?'âœ… Correct! +'+pts+' pts':'âŒ Incorrect. The correct answer is highlighted.');
}

function showFeedbackEl(correct,msg,isLong){
  var fb=g('qfb');
  fb.style.display='block';
  fb.className='qfb '+(isLong?'long':correct?'cor':'wrong');
  fb.textContent=msg;
  var nav=g('qnav');
  var isLast=QS.cur>=QS.qz.qs.length-1;
  nav.innerHTML='<button class="btn bp sm" onclick="'+(isLast?'finishQz()':'nextQ()'+'">'+(isLast?'Finish Quiz â†’':'Next â†’')+'</button>');
}

function nextQ(){QS.cur++;renQz();}

function finishQz(){
  var total=QS.qz.qs.length;
  var score=QS.ans.filter(function(a){return a.correct!==false;}).length;
  var earned=QS.ans.reduce(function(sum,a){return sum+(a.pts||0);},0);
  var u=S.user;
  if(!u.attempts)u.attempts=[];
  u.attempts.push({qid:QS.qz.id,qt:QS.qz.title,sc:score,tot:total,pe:earned,date:new Date().toISOString()});
  u.points=(u.points||0)+earned;
  saveUser();
  checkTierCerts();
  // Show result
  var pct=Math.round(score/total*100);
  var grade=pct>=80?'Excellent!':pct>=60?'Good work!':'Keep practising!';
  g('qm-body').innerHTML='<div class="qscore-box">'+
    '<div class="big">'+score+'/'+total+'</div>'+
    '<div class="grade">'+grade+'</div>'+
    '<p style="font-size:.9rem;color:var(--muted);margin-bottom:.5rem">+'+earned+' points earned</p>'+
    '<p style="font-size:.82rem;color:var(--muted)">Total: '+(u.points)+' pts</p>'+
  '</div>'+
  '<div style="display:flex;gap:.5rem;justify-content:center;margin-top:1rem">'+
    '<button class="btn bp" onclick="closeQz()">Done âœ“</button>'+
    (QS.qz.retry?'<button class="btn bg_" onclick="startQz(\''+QS.qz.id+'\')">Retry</button>':'')+
  '</div>';
  g('hdr-pts').textContent=(u.points)+'pts'; renDash();
}

function alreadyDone(qz){
  var attempt=(S.user.attempts||[]).find(function(a){return a.qid===qz.id;});
  g('qm-body').innerHTML='<div class="qscore-box">'+
    '<div class="big">'+esc(qz.title)+'</div>'+
    '<p style="color:var(--muted);margin-top:.5rem">You already completed this quiz</p>'+
    (attempt?'<p style="margin-top:.3rem">Score: '+attempt.sc+'/'+attempt.tot+' | +'+attempt.pe+' pts</p>':'')+
  '</div>'+
  '<div style="margin-top:1rem;text-align:center"><button class="btn bp" onclick="closeQz()">Close</button></div>';
  g('qov').classList.remove('hidden');
}

function closeQz(){ g('qov').classList.add('hidden'); renVids(); renArts(); renDash(); }
function arrEq(a,b){ return a.length===b.length&&a.every(function(v,i){return v===b[i];}); }

// â”€â”€ ADMIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function goAdminLogin(){ g('nav').style.display='none'; g('hdr-r').style.display='none'; showPg('pg-adm-login'); g('ap').value=''; }

function doAdminLogin(){
  var p=g('ap').value.trim();
  if(p===(CFG.admPass||DEFAULT_CFG.admPass)){
    lsS('sess_adm','1');
    enterAdmin();
  } else {
    showErr(g('adm-err'),'Incorrect password. Default: admin123');
  }
}

function enterAdmin(){
  S.isAdmin=true; S.user=null;
  g('hdr-r').style.display='none';
  g('nav').style.display='none';
  showPg('pg-admin');
  renAdmOv(); renAdmUsers(); renAdmVids(); renAdmArts(); renAdmQzs();
  // Populate settings
  loadPortalInfoForm(); loadCertCfgForm();
}

function admLogout(){
  if(!confirm('Logout from admin?'))return;
  S.isAdmin=false; lsR('sess_adm');
  showPg('pg-welcome');
}

function aTab(el, sec){
  document.querySelectorAll('.sb-ni').forEach(function(n){n.classList.remove('on');});
  document.querySelectorAll('.as').forEach(function(s){s.classList.remove('on');});
  el.classList.add('on');
  g(sec).classList.add('on');
}

function renAdmOv(){
  var users=sj(ls('users'),[]);
  g('ov-us').textContent=users.length;
  g('ov-vd').textContent=DB.V.length;
  g('ov-ar').textContent=DB.A.length;
  g('ov-qz').textContent=DB.Q.length;
}

// â”€â”€ ADMIN: STUDENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renAdmUsers(){
  var q=(g('usrch').value||'').toLowerCase();
  var users=sj(ls('users'),[]).filter(function(u){
    return !q||(u.name||'').toLowerCase().indexOf(q)>=0||(u.institution||'').toLowerCase().indexOf(q)>=0;
  });
  g('u-tb').innerHTML=users.length
    ? users.map(function(u){
        var vw=(u.progress&&u.progress.vw||[]).length;
        var ar=(u.progress&&u.progress.ar||[]).length;
        var qz=(u.attempts||[]).length;
        return '<tr><td>'+esc(u.name)+'</td><td>'+esc(u.institution||'â€“')+'</td><td>'+esc(u.cohort||'â€“')+'</td><td><strong>'+(u.points||0)+'</strong></td><td>'+vw+'</td><td>'+ar+'</td><td>'+qz+'</td></tr>';
      }).join('')
    : '<tr><td colspan="7" style="text-align:center;color:var(--muted);padding:1.5rem">No students yet.</td></tr>';
}

function exportStudentsCSV(){
  var users=sj(ls('users'),[]);
  var rows=[['Name','Institution','Cohort','Points','Videos Watched','Articles Read','Quizzes Done','Joined']];
  users.forEach(function(u){
    rows.push([u.name,u.institution||'',u.cohort||'',u.points||0,(u.progress&&u.progress.vw||[]).length,(u.progress&&u.progress.ar||[]).length,(u.attempts||[]).length,u.joinedAt||'']);
  });
  var csv=rows.map(function(r){return r.map(function(c){return '"'+String(c).replace(/"/g,'""')+'"';}).join(',');}).join('\n');
  var a=document.createElement('a'); a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv); a.download='students.csv'; a.click();
}

// â”€â”€ ADMIN: VIDEOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveVid(){
  var id=g('vf-id').value.trim()||('v-'+Date.now());
  var ti=g('vf-ti').value.trim(), th=g('vf-th').value.trim();
  var ur=g('vf-ur').value.trim(), du=g('vf-du').value.trim(), de=g('vf-de').value.trim();
  if(!ti){alert('Title required.');return;} if(!ur){alert('URL required.');return;}
  var item={id:id,type:'video',title:ti,theme:th,url:ur,duration:du,description:de};
  var idx=DB.V.findIndex(function(v){return v.id===id;});
  if(idx>=0)DB.V[idx]=item; else DB.V.push(item);
  lsS('videos',DB.V); clrVid(); renAdmVids(); renAdmOv(); toast('Video saved!');
}
function editVid(id){ var v=DB.V.find(function(x){return x.id===id;}); if(!v)return; g('vf-id').value=v.id;g('vf-ti').value=v.title;g('vf-th').value=v.theme||'';g('vf-ur').value=v.url||'';g('vf-du').value=v.duration||'';g('vf-de').value=v.description||''; g('vf-ti').scrollIntoView({behavior:'smooth',block:'center'}); }
function delVid(id){ openCo('Delete Video','Remove this video?',function(){ DB.V=DB.V.filter(function(v){return v.id!==id;}); lsS('videos',DB.V); renAdmVids(); renAdmOv(); toast('Deleted.'); }); }
function clrVid(){ g('vf-id').value='';['vf-ti','vf-th','vf-ur','vf-du','vf-de'].forEach(function(x){g(x).value='';}); }
function renAdmVids(){
  g('vf-tb').innerHTML=DB.V.length
    ? DB.V.map(function(v){ var hq=DB.Q.some(function(q){return q.ci===v.id;}); return '<tr><td>'+esc(v.title)+'</td><td>'+esc(v.theme||'â€“')+'</td><td>'+esc(v.duration||'â€“')+'</td><td>'+(hq?'<span class="chip cg">Yes</span>':'<span class="chip cr">No</span>')+'</td><td><div class="tacts"><button class="btn bg_ sm" onclick="editVid(\''+esc(v.id)+'\')">âœï¸ Edit</button><button class="btn bd sm" onclick="delVid(\''+esc(v.id)+'\')">Delete</button></div></td></tr>'; }).join('')
    : '<tr><td colspan="5" style="text-align:center;color:var(--muted)">No videos yet.</td></tr>';
}

// â”€â”€ ADMIN: ARTICLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveArt(){
  var id=g('af-id').value.trim()||('a-'+Date.now());
  var ti=g('af-ti').value.trim(), th=g('af-th').value.trim();
  var ur=g('af-ur').value.trim(), du=g('af-du').value.trim(), de=g('af-de').value.trim();
  if(!ti){alert('Title required.');return;} if(!ur){alert('URL required.');return;}
  var item={id:id,type:'article',title:ti,theme:th,url:ur,duration:du,description:de};
  var idx=DB.A.findIndex(function(a){return a.id===id;}); if(idx>=0)DB.A[idx]=item; else DB.A.push(item);
  lsS('articles',DB.A); clrArt(); renAdmArts(); renAdmOv(); toast('Article saved!');
}
function editArt(id){ var a=DB.A.find(function(x){return x.id===id;}); if(!a)return; g('af-id').value=a.id;g('af-ti').value=a.title;g('af-th').value=a.theme||'';g('af-ur').value=a.url||'';g('af-du').value=a.duration||'';g('af-de').value=a.description||''; g('af-ti').scrollIntoView({behavior:'smooth',block:'center'}); }
function delArt(id){ openCo('Delete Article','Remove this article?',function(){ DB.A=DB.A.filter(function(a){return a.id!==id;}); lsS('articles',DB.A); renAdmArts(); renAdmOv(); toast('Deleted.'); }); }
function clrArt(){ g('af-id').value='';['af-ti','af-th','af-ur','af-du','af-de'].forEach(function(x){g(x).value='';}); }
function renAdmArts(){
  g('af-tb').innerHTML=DB.A.length
    ? DB.A.map(function(a){ var hq=DB.Q.some(function(q){return q.ci===a.id;}); return '<tr><td>'+esc(a.title)+'</td><td>'+esc(a.theme||'â€“')+'</td><td>'+esc(a.duration||'â€“')+'</td><td>'+(hq?'<span class="chip cg">Yes</span>':'<span class="chip cr">No</span>')+'</td><td><div class="tacts"><button class="btn bg_ sm" onclick="editArt(\''+esc(a.id)+'\')">âœï¸ Edit</button><button class="btn bd sm" onclick="delArt(\''+esc(a.id)+'\')">Delete</button></div></td></tr>'; }).join('')
    : '<tr><td colspan="5" style="text-align:center;color:var(--muted)">No articles yet.</td></tr>';
}

// â”€â”€ ADMIN: QUIZZES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var qCnt=0;
function refDrop(){
  var ct=g('qf-ct').value,lw=g('qf-lw'),sel=g('qf-ci');
  if(ct==='standalone'){lw.style.display='none';return;} lw.style.display='';
  var items=ct==='video'?DB.V:DB.A;
  sel.innerHTML=items.length?items.map(function(x){return '<option value="'+esc(x.id)+'">'+esc(x.title)+'</option>';}).join(''):'<option value="">No '+ct+'s added yet</option>';
}
function addQ(qd,forcedType){
  qCnt++;
  var n=qCnt,type=forcedType||(qd&&qd.type)||'mcq',L=['A','B','C','D'];
  var badges={mcq:'<span class="qtype-badge qt-mcq">Single Answer</span>',multi:'<span class="qtype-badge qt-multi">Multiple Answers</span>',long:'<span class="qtype-badge qt-long">Long Answer</span>',tf:'<span class="qtype-badge qt-tf">True / False</span>'};
  var opts='';
  if(type==='mcq'){
    opts='<div class="fg"><label>Options â€” click â—‹ to mark correct</label>';
    for(var i=0;i<4;i++){var v=(qd&&qd.opts&&qd.opts[i])||'',c=(qd&&qd.cor===i)?'checked':'';opts+='<div class="orow"><input type="radio" name="qr-'+n+'" value="'+i+'" '+c+'><span class="ol">'+L[i]+'.</span><input type="text" id="op-'+n+'-'+i+'" value="'+esc(v)+'" placeholder="Option '+L[i]+'â€¦"></div>';}
    opts+='</div>';
  } else if(type==='tf'){
    var tc=(qd&&qd.cor===0)?'checked':'',fc=(qd&&qd.cor===1)?'checked':'';
    opts='<div class="fg"><label>Correct Answer</label><div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:.3rem"><label style="display:flex;align-items:center;gap:.5rem;padding:.7rem;border:2px solid var(--border);border-radius:10px;cursor:pointer"><input type="radio" name="qr-'+n+'" value="0" '+tc+' style="width:auto;accent-color:var(--green)"> âœ… True</label><label style="display:flex;align-items:center;gap:.5rem;padding:.7rem;border:2px solid var(--border);border-radius:10px;cursor:pointer"><input type="radio" name="qr-'+n+'" value="1" '+fc+' style="width:auto;accent-color:var(--red)"> âŒ False</label></div></div>';
  } else if(type==='multi'){
    var cors=Array.isArray(qd&&qd.cors)?qd.cors:[];
    opts='<div class="fg"><label>Options â€” tick ALL correct</label>';
    for(var i=0;i<4;i++){var v=(qd&&qd.opts&&qd.opts[i])||'',c=(cors.indexOf(i)>=0)?'checked':'';opts+='<div class="orow"><input type="checkbox" name="qr-'+n+'" value="'+i+'" '+c+'><span class="ol">'+L[i]+'.</span><input type="text" id="op-'+n+'-'+i+'" value="'+esc(v)+'" placeholder="Option '+L[i]+'â€¦"></div>';}
    opts+='</div>';
  } else { opts='<div class="long-note">Students type a free-text response. Full points for attempting.</div>'; }
  var div=document.createElement('div'); div.className='qbb'; div.id='qb-'+n;
  div.innerHTML='<div class="qbb-hdr" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.6rem"><div style="display:flex;gap:.4rem;align-items:center"><strong style="color:var(--green)">Q'+n+'</strong>'+(badges[type]||'')+'</div><button type="button" class="btn bd sm" onclick="rmQ('+n+')">Remove</button></div>'+
    '<input type="hidden" id="qtype-'+n+'" value="'+type+'">'+
    '<div class="fg"><label>Question *</label><textarea id="qt-'+n+'" rows="2" placeholder="Type your questionâ€¦">'+(qd&&qd.q?esc(qd.q):'')+'</textarea></div>'+opts;
  g('qf-qw').appendChild(div);
}
function rmQ(n){var el=g('qb-'+n);if(el)el.remove();}
function saveQuiz(){
  var id=g('qf-id').value||('qz-'+Date.now());
  var ti=g('qf-nm').value.trim(),pts=parseInt(g('qf-pt').value)||10;
  var ct=g('qf-ct').value,ci=ct==='standalone'?'0':g('qf-ci').value;
  var retry=g('qf-re').checked;
  if(!ti){alert('Quiz title required.');return;}
  var blocks=document.querySelectorAll('.qbb'),qs=[],err=null;
  for(var bi=0;bi<blocks.length;bi++){
    if(err)break;
    var n=blocks[bi].id.replace('qb-','');
    var type=(g('qtype-'+n)||{value:'mcq'}).value,qt=(g('qt-'+n)||{value:''}).value.trim();
    if(!qt){err='Q'+(bi+1)+': Enter the question text.';break;}
    if(type==='long'){qs.push({type:'long',q:qt});}
    else if(type==='tf'){
      var ce=document.querySelector('input[name="qr-'+n+'"]:checked');
      if(!ce){err='Q'+(bi+1)+': Select True or False.';break;}
      qs.push({type:'tf',q:qt,cor:parseInt(ce.value)});
    } else if(type==='mcq'){
      var opts=[];for(var oi=0;oi<4;oi++){var oe=g('op-'+n+'-'+oi);opts.push(oe?oe.value.trim():'');}
      if(opts.some(function(o){return !o;})){err='Q'+(bi+1)+': Fill all options.';break;}
      var ce=document.querySelector('input[name="qr-'+n+'"]:checked');
      if(!ce){err='Q'+(bi+1)+': Select the correct answer.';break;}
      qs.push({type:'mcq',q:qt,opts:opts,cor:parseInt(ce.value)});
    } else if(type==='multi'){
      var opts=[];for(var oi=0;oi<4;oi++){var oe=g('op-'+n+'-'+oi);opts.push(oe?oe.value.trim():'');}
      if(opts.some(function(o){return !o;})){err='Q'+(bi+1)+': Fill all options.';break;}
      var ces=document.querySelectorAll('input[name="qr-'+n+'"]:checked');
      if(!ces.length){err='Q'+(bi+1)+': Tick at least one correct answer.';break;}
      var cors=[];ces.forEach(function(e){cors.push(parseInt(e.value));});
      qs.push({type:'multi',q:qt,opts:opts,cors:cors});
    }
  }
  if(err){alert(err);return;}
  if(!qs.length){alert('Add at least one question.');return;}
  var qobj={id:id,title:ti,ct:ct,ci:ci,pts:pts,retry:retry,qs:qs};
  var ei=DB.Q.findIndex(function(q){return q.id===id;});
  if(ei>=0)DB.Q[ei]=qobj; else DB.Q.push(qobj);
  lsS('quizzes',DB.Q); clrQz(); renAdmQzs(); toast('Quiz saved!');
}
function editQuiz(id){
  var q=DB.Q.find(function(x){return x.id===id;}); if(!q)return;
  g('qf-id').value=q.id;g('qf-nm').value=q.title;g('qf-pt').value=q.pts;
  g('qf-ct').value=q.ct;g('qf-re').checked=q.retry; refDrop();
  if(q.ct!=='standalone'){ var sel=g('qf-ci'); for(var i=0;i<sel.options.length;i++){if(sel.options[i].value===q.ci){sel.selectedIndex=i;break;}} }
  g('qf-qw').innerHTML=''; qCnt=0;
  (q.qs||[]).forEach(function(qd){addQ(qd,qd.type||'mcq');});
  g('qf-t').textContent='âœï¸ Edit Quiz';
  document.querySelector('[data-s="as-qz"]').click();
  g('qf-nm').scrollIntoView({behavior:'smooth',block:'center'});
}
function delQuiz(id){ openCo('Delete Quiz','Remove this quiz?',function(){ DB.Q=DB.Q.filter(function(q){return q.id!==id;}); lsS('quizzes',DB.Q); renAdmQzs(); toast('Deleted.'); }); }
function clrQz(){ g('qf-id').value='';g('qf-nm').value='';g('qf-pt').value='10';g('qf-re').checked=false;g('qf-qw').innerHTML='<p class="ohint" style="margin:0">Click a button above to add a question.</p>';g('qf-t').textContent='Create New Quiz';qCnt=0;refDrop(); }
function renAdmQzs(){
  g('qf-tb').innerHTML=DB.Q.length
    ? DB.Q.map(function(q){
        var lk='Standalone';
        if(q.ct==='video'){var v=DB.V.find(function(x){return x.id===q.ci;});lk=v?esc(v.title.substring(0,24)):'Unknown';}
        if(q.ct==='article'){var a=DB.A.find(function(x){return x.id===q.ci;});lk=a?esc(a.title.substring(0,24)):'Unknown';}
        return '<tr><td>'+esc(q.title)+'</td><td>'+lk+'</td><td>'+q.qs.length+'</td><td>'+q.pts+'</td><td>'+(q.retry?'<span class="chip cg">Yes</span>':'<span class="chip cr">No</span>')+'</td><td><div class="tacts"><button class="btn bg_ sm" onclick="editQuiz(\''+esc(q.id)+'\')">âœï¸ Edit</button><button class="btn bd sm" onclick="delQuiz(\''+esc(q.id)+'\')">Delete</button></div></td></tr>';
      }).join('')
    : '<tr><td colspan="6" style="text-align:center;color:var(--muted)">No quizzes yet.</td></tr>';
}

// â”€â”€ ADMIN: PORTAL INFO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadPortalInfoForm(){
  g('pi-title').value=CFG.title||'';
  g('pi-tagline').value=CFG.tagline||'';
  g('pi-about').value=CFG.about||'';
  g('pi-contact').value=CFG.contact||'';
}
function savePortalInfo(){
  CFG.title=g('pi-title').value.trim()||DEFAULT_CFG.title;
  CFG.tagline=g('pi-tagline').value.trim()||DEFAULT_CFG.tagline;
  CFG.about=g('pi-about').value.trim()||DEFAULT_CFG.about;
  CFG.contact=g('pi-contact').value.trim()||DEFAULT_CFG.contact;
  lsS('cfg',CFG); applyLogo(CFG.logo||''); toast('Portal info saved!');
}

// â”€â”€ ADMIN: CERTIFICATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function loadCertCfgForm(){
  var c=CFG.cert||DEFAULT_CFG.cert;
  g('cert-br').value=c.br||100; g('cert-si').value=c.si||300;
  g('cert-go').value=c.go||500; g('cert-pl').value=c.pl||1000;
  g('cert-org').value=c.org||'Bridge4Change Foundation';
  g('cert-sn').value=c.sn||'Programme Director';
  g('cert-st').value=c.st||'Bridge4Change Foundation';
}
function saveCertCfg(){
  if(!CFG.cert)CFG.cert={};
  CFG.cert.br=parseInt(g('cert-br').value)||100;
  CFG.cert.si=parseInt(g('cert-si').value)||300;
  CFG.cert.go=parseInt(g('cert-go').value)||500;
  CFG.cert.pl=parseInt(g('cert-pl').value)||1000;
  CFG.cert.org=g('cert-org').value.trim();
  CFG.cert.sn=g('cert-sn').value.trim();
  CFG.cert.st=g('cert-st').value.trim();
  lsS('cfg',CFG); toast('Certificate settings saved!');
}

// â”€â”€ ADMIN: SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function changeAdmPass(){
  var np=g('st-np').value.trim(),cp=g('st-cp').value.trim();
  if(!np){alert('Enter a new password.');return;}
  if(np!==cp){alert('Passwords do not match.');return;}
  if(np.length<4){alert('Password must be at least 4 characters.');return;}
  CFG.admPass=np; lsS('cfg',CFG); g('st-np').value='';g('st-cp').value='';
  toast('Password updated!');
}

function exportAllData(){
  var data={videos:DB.V,articles:DB.A,quizzes:DB.Q,users:sj(ls('users'),[]),cfg:CFG,exportedAt:new Date().toISOString()};
  var a=document.createElement('a'); a.href='data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(data,null,2)); a.download='b4c-portal-backup-'+new Date().toISOString().split('T')[0]+'.json'; a.click();
}

function importDataClick(){ g('import-file').click(); }
function importData(input){
  var f=input.files[0]; if(!f)return;
  var r=new FileReader();
  r.onload=function(e){
    try{
      var d=JSON.parse(e.target.result);
      if(d.videos){DB.V=d.videos;lsS('videos',DB.V);}
      if(d.articles){DB.A=d.articles;lsS('articles',DB.A);}
      if(d.quizzes){DB.Q=d.quizzes;lsS('quizzes',DB.Q);}
      if(d.users){lsS('users',d.users);}
      if(d.cfg){CFG=d.cfg;lsS('cfg',CFG);}
      toast('Data imported! Refreshingâ€¦');
      setTimeout(function(){location.reload();},1500);
    }catch(e){alert('Invalid file. Please use a valid backup JSON.');}
  };
  r.readAsText(f);
}

function confirmResetAll(){
  openCo('Reset All Data','âš ï¸ This will delete ALL students, content, and quizzes. This cannot be undone!',function(){
    ['videos','articles','quizzes','users','cfg','sess_adm','sess_user'].forEach(function(k){lsR(k);});
    toast('All data cleared. Refreshingâ€¦');
    setTimeout(function(){location.reload();},1500);
  });
}

function uploadLogo(input){
  var f=input.files[0]; if(!f)return;
  var r=new FileReader();
  r.onload=function(e){
    CFG.logo=e.target.result; lsS('cfg',CFG); applyLogo(CFG.logo);
    g('logo-preview').innerHTML='<img src="'+CFG.logo+'" style="height:50px;width:50px;border-radius:50%;object-fit:cover;margin-top:.5rem">';
    toast('Logo saved!');
  };
  r.readAsDataURL(f);
}

// â”€â”€ CONFIRM OVERLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var coCb=null;
function openCo(t,m,cb){g('co-t').textContent=t;g('co-m').textContent=m;coCb=cb;g('cov').classList.remove('hidden');}
function closeCo(){g('cov').classList.add('hidden');coCb=null;}
document.getElementById('co-ok').onclick=function(){if(coCb)coCb();closeCo();};

// Allow pressing Enter on welcome form
document.getElementById('wc-cohort').addEventListener('keydown',function(e){if(e.key==='Enter')startLearning();});
document.getElementById('ap').addEventListener('keydown',function(e){if(e.key==='Enter')doAdminLogin();});

// â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function g(id){return document.getElementById(id);}
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function showErr(el,msg){el.textContent=msg;el.classList.remove('hidden');setTimeout(function(){el.classList.add('hidden');},5000);}
function toast(msg){var t=document.createElement('div');t.className='toast';t.textContent=msg;document.body.appendChild(t);setTimeout(function(){if(t.parentNode)t.remove();},3000);}
</script>
</body>
</html>
